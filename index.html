// Navigation component for T&J Field Services
const Navigation = {
    items: [
        { id: 'dashboard', label: 'Dashboard', icon: 'home' },
        { id: 'estimates', label: 'Estimates', icon: 'calculator' },
        { id: 'customers', label: 'Customers', icon: 'users' },
        { id: 'projects', label: 'Projects', icon: 'briefcase' },
        { id: 'inventory', label: 'Inventory', icon: 'package' },
        { id: 'schedule', label: 'Schedule', icon: 'calendar' },
        { id: 'reports', label: 'Reports', icon: 'bar-chart' }
    ],
    
    render() {
        const navElement = document.getElementById('navigation');
        navElement.innerHTML = `
            <nav class="bg-white shadow-md">
                <div class="container mx-auto px-4">
                    <div class="flex space-x-8 overflow-x-auto">
                        ${this.items.map(item => `
                            <button 
                                onclick="navigateTo('${item.id}')" 
                                class="nav-link px-4 py-3 text-gray-700 hover:text-blue-600 border-b-2 border-transparent hover:border-blue-600 whitespace-nowrap"
                                data-page="${item.id}"
                            >
                                <i data-lucide="${item.icon}" class="inline w-4 h-4 mr-2"></i>
                                ${item.label}
                            </button>
                        `).join('')}
                    </div>
                </div>
            </nav>
        `;
    },
    
    setActive(pageId) {
        // Remove active class from all nav links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active');
        });
        
        // Add active class to current page
        const activeLink = document.querySelector(`[data-page="${pageId}"]`);
        if (activeLink) {
            activeLink.classList.add('active');
        }
    }// Dashboard page for T&J Field Services
const Dashboard = {
    render() {
        const content = document.getElementById('content');
        content.innerHTML = `
            <div class="fade-in">
                <h2 class="text-3xl font-bold mb-6 text-gray-800">Business Dashboard</h2>
                
                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    ${this.renderMetricCard('estimates', 'Total Estimates', 'file-text', 'blue')}
                    ${this.renderMetricCard('customers', 'Active Customers', 'users', 'green')}
                    ${this.renderMetricCard('projects', 'Active Projects', 'briefcase', 'orange')}
                    ${this.renderMetricCard('revenue', 'Monthly Revenue', 'dollar-sign', 'purple')}
                </div>

                <!-- Quick Actions -->
                ${this.renderQuickActions()}

                <!-- Recent Activity & Tasks -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                    ${this.renderRecentActivity()}
                    ${this.renderUpcomingTasks()}
                </div>

                <!-- Quick Stats -->
                ${this.renderQuickStats()}
            </div>
        `;
        
        this.updateMetrics();
        this.loadRecentActivity();
        this.loadUpcomingTasks();
    },
    
    renderMetricCard(type, title, icon, color) {
        return `
            <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow">
                <div class="flex items-center">
                    <i data-lucide="${icon}" class="w-8 h-8 text-${color}-600 mr-3"></i>
                    <div>
                        <h3 class="text-lg font-semibold">${title}</h3>
                        <p class="text-2xl font-bold text-${color}-600" id="${type}Count">0</p>
                        <p class="text-sm text-gray-500" id="${type}Detail">Loading...</p>
                    </div>
                </div>
            </div>
        `;
    },
    
    renderQuickActions() {
        const actions = [
            { id: 'estimates', title: 'New Estimate', subtitle: 'Create project estimate', icon: 'calculator', color: 'blue' },
            { id: 'customers', title: 'Add Customer', subtitle: 'New customer record', icon: 'user-plus', color: 'green' },
            { id: 'projects', title: 'New Project', subtitle: 'Start new project', icon: 'plus-circle', color: 'orange' },
            { id: 'schedule', title: 'Schedule Job', subtitle: 'Book appointment', icon: 'calendar-plus', color: 'purple' }
        ];
        
        return `
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4">Quick Actions</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    ${actions.map(action => `
                        <button onclick="navigateTo('${action.id}')" class="bg-${action.color}-600 text-white p-4 rounded-lg hover:bg-${action.color}-700 transition-colors template-btn">
                            <i data-lucide="${action.icon}" class="w-6 h-6 mx-auto mb-2"></i>
                            <div class="font-semibold">${action.title}</div>
                            <div class="text-sm opacity-80">${action.subtitle}</div>
                        </button>
                    `).join('')}
                </div>
            </div>
        `;
    },
    
    renderRecentActivity() {
        return `
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Recent Activity</h3>
                    <button onclick="Dashboard.refreshActivity()" class="text-blue-600 hover:text-blue-800">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    </button>
                </div>
                <div id="recentActivity" class="space-y-3">
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="activity" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                        <p>Loading activity...</p>
                    </div>
                </div>
            </div>
        `;
    },
    
    renderUpcomingTasks() {
        return `
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Upcoming Tasks</h3>
                    <button onclick="Dashboard.addQuickTask()" class="text-blue-600 hover:text-blue-800">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                    </button>
                </div>
                <div id="upcomingTasks" class="space-y-3">
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="check-square" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                        <p>Loading tasks...</p>
                    </div>
                </div>
            </div>
        `;
    },
    
    renderQuickStats() {
        return `
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="bg-blue-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-blue-600" id="avgEstimate">$0</div>
                    <div class="text-sm text-blue-800">Avg Estimate</div>
                </div>
                <div class="bg-green-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-green-600" id="conversionRate">0%</div>
                    <div class="text-sm text-green-800">Conversion Rate</div>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-orange-600" id="avgDays">0</div>
                    <div class="text-sm text-orange-800">Avg Project Days</div>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg text-center">
                    <div class="text-2xl font-bold text-purple-600">98%</div>
                    <div class="text-sm text-purple-800">Customer Rating</div>
                </div>
            </div>
        `;
    },
    
    updateMetrics() {
        // Update estimates
        const estimatesCount = document.getElementById('estimatesCount');
        const estimatesDetail = document.getElementById('estimatesDetail');
        if (estimatesCount) {
            estimatesCount.textContent = Data.estimates.length;
            const totalValue = Data.estimates.reduce((sum, est) => sum + (parseFloat(est.total) || 0), 0);
            estimatesDetail.textContent = Data.formatCurrency(totalValue) + ' total value';
        }
        
        // Update customers
        const customersCount = document.getElementById('customersCount');
        const customersDetail = document.getElementById('customersDetail');
        if (customersCount) {
            customersCount.textContent = Data.customers.length;
            customersDetail.textContent = 'Active customers';
        }
        
        // Update projects
        const projectsCount = document.getElementById('projectsCount');
        const projectsDetail = document.getElementById('projectsDetail');
        if (projectsCount) {
            const activeProjects = Data.projects.filter(p => p.status === 'in-progress');
            projectsCount.textContent = activeProjects.length;
            projectsDetail.textContent = 'In progress';
        }
        
        // Update revenue
        const revenueCount = document.getElementById('revenueCount');
        const revenueDetail = document.getElementById('revenueDetail');
        if (revenueCount) {
            const completedProjects = Data.projects.filter(p => p.status === 'completed');
            const revenue = completedProjects.reduce((sum, proj) => sum + (parseFloat(proj.value) || 0), 0);
            revenueCount.textContent = Data.formatCurrency(revenue);
            revenueDetail.textContent = 'Total completed';
        }
        
        // Update quick stats
        this.updateQuickStats();
    },
    
    updateQuickStats() {
        // Average estimate
        const avgEstimate = document.getElementById('avgEstimate');
        if (avgEstimate && Data.estimates.length > 0) {
            const avg = Data.estimates.reduce((sum, est) => sum + (parseFloat(est.total) || 0), 0) / Data.estimates.length;
            avgEstimate.textContent = Data.formatCurrency(avg);
        }
        
        // Conversion rate
        const conversionRate = document.getElementById('conversionRate');
        if (conversionRate && Data.estimates.length > 0) {
            const approved = Data.estimates.filter(est => est.status === 'approved').length;
            const rate = (approved / Data.estimates.length * 100).toFixed(1);
            conversionRate.textContent = rate + '%';
        }
    },
    
    loadRecentActivity() {
        const container = document.getElementById('recentActivity');
        if (!container) return;
        
        const activities = [];
        
        // Recent estimates
        Data.estimates.slice(-3).forEach(est => {
            activities.push({
                title: `New estimate for ${est.customerName}`,
                subtitle: Data.formatCurrency(est.total),
                time: est.dateCreated,
                icon: 'calculator',
                color: 'blue'
            });
        });
        
        // Recent customers
        Data.customers.slice(-2).forEach(customer => {
            activities.push({
                title: `New customer: ${customer.name}`,
                subtitle: customer.phone,
                time: customer.dateAdded,
                icon: 'user-plus',
                color: 'green'
            });
        });
        
        activities.sort((a, b) => new Date(b.time) - new Date(a.time));
        
        if (activities.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-8">
                    <i data-lucide="activity" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                    <p>No recent activity</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = activities.slice(0, 5).map(activity => `
            <div class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-colors">
                <div class="w-8 h-8 bg-${activity.color}-100 rounded-full flex items-center justify-center mr-3">
                    <i data-lucide="${activity.icon}" class="w-4 h-4 text-${activity.color}-600"></i>
                </div>
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900">${activity.title}</p>
                    <p class="text-xs text-gray-500">${activity.subtitle}</p>
                </div>
                <div class="text-xs text-gray-400">
                    ${this.getTimeAgo(activity.time)}
                </div>
            </div>
        `).join('');
    },
    
    loadUpcomingTasks() {
        const container = document.getElementById('upcomingTasks');
        if (!container) return;
        
        const tasks = Data.load('tasks') || [];
        
        if (tasks.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-8">
                    <i data-lucide="check-square" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                    <p>No upcoming tasks</p>
                    <button onclick="Dashboard.addQuickTask()" class="mt-2 text-blue-600 hover:text-blue-800 text-sm">
                        Add a task
                    </button>
                </div>
            `;
            return;
        }
        
        container.innerHTML = tasks.slice(0, 5).map(task => `
            <div class="flex items-center p-3 hover:bg-gray-50 rounded-lg transition-colors">
                <input type="checkbox" ${task.completed ? 'checked' : ''} 
                       onchange="Dashboard.toggleTask('${task.id}')" 
                       class="mr-3">
                <div class="flex-1">
                    <p class="text-sm font-medium text-gray-900 ${task.completed ? 'line-through' : ''}">${task.title}</p>
                    <p class="text-xs text-gray-500">${Data.formatDate(task.dueDate)}</p>
                </div>
            </div>
        `).join('');
    },
    
    getTimeAgo(timestamp) {
        const now = new Date();
        const time = new Date(timestamp);
        const diff = now - time;
        
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);
        
        if (minutes < 60) return `${minutes}m ago`;
        if (hours < 24) return `${hours}h ago`;
        return `${days}d ago`;
    },
    
    refreshActivity() {
        this.loadRecentActivity();
        UI.showAlert('Activity refreshed', 'info');
    },
    
    addQuickTask() {
        const taskTitle = prompt('Enter task title:');
        if (taskTitle) {
            const tasks = Data.load('tasks') || [];
            tasks.push({
                id: Data.generateId(),
                title: taskTitle,
                dueDate: new Date(Date.now() + 86400000).toISOString(),
                completed: false,
                dateCreated: new Date().toISOString()
            });
            Data.save('tasks', tasks);
            this.loadUpcomingTasks();
            UI.showAlert('Task added successfully!');
        }
    },
    
    toggleTask(taskId) {
        const tasks = Data.load('tasks') || [];
        const task = tasks.find(t => t.id === taskId);
        if (task) {
            task.completed = !task.completed;
            Data.save('tasks', tasks);
            this.loadUpcomingTasks();
        }
    }
};// Estimates list component for T&J Field Services
const EstimatesList = {
    render() {
        return `
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Recent Estimates</h3>
                    <button onclick="EstimatesList.export()" class="text-blue-600 hover:text-blue-800">
                        <i data-lucide="download" class="w-4 h-4"></i>
                    </button>
                </div>
                
                <div class="mb-4">
                    <input type="text" id="estimateSearch" placeholder="Search estimates..." 
                           onkeyup="EstimatesList.search()" class="form-input">
                </div>
                
                <div id="estimatesList" class="space-y-3">
                    <div class="text-center text-gray-500 py-8">
                        <i data-lucide="calculator" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                        <p>Loading estimates...</p>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        const container = document.getElementById('estimatesList');
        if (!container) return;
        
        if (Data.estimates.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-8">
                    <i data-lucide="calculator" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                    <p>No estimates yet</p>
                    <p class="text-sm">Create your first estimate above</p>
                </div>
            `;
            return;
        }
        
        const estimates = Data.estimates.slice().reverse(); // Show newest first
        container.innerHTML = estimates.map(estimate => this.renderEstimateCard(estimate)).join('');
        lucide.createIcons();
    },
    
    renderEstimateCard(estimate) {
        const statusColors = {
            pending: 'yellow',
            approved: 'green',
            rejected: 'red',
            expired: 'gray'
        };
        
        const statusColor = statusColors[estimate.status] || 'gray';
        
        return `
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h4 class="font-semibold text-lg">${estimate.customerName}</h4>
                        <p class="text-sm text-gray-600">${estimate.projectType} â€¢ ${estimate.duration || 'Duration TBD'}</p>
                        <p class="text-sm text-gray-500 mt-1">${estimate.description}</p>
                        <div class="flex items-center mt-2">
                            <span class="inline-block w-2 h-2 bg-${statusColor}-400 rounded-full mr-2"></span>
                            <span class="text-sm text-${statusColor}-600 capitalize">${estimate.status}</span>
                            <span class="text-sm text-gray-400 ml-4">${Data.formatDate(estimate.dateCreated)}</span>
                        </div>
                    </div>
                    <div class="text-right ml-4">
                        <div class="text-xl font-bold text-green-600">${Data.formatCurrency(estimate.total)}</div>
                        <div class="flex space-x-2 mt-2">
                            <button onclick="EstimatesList.view('${estimate.id}')" 
                                    class="text-blue-600 hover:text-blue-800 text-sm">
                                <i data-lucide="eye" class="w-4 h-4"></i>
                            </button>
                            <button onclick="Estimates.editEstimate('${estimate.id}')" 
                                    class="text-green-600 hover:text-green-800 text-sm">
                                <i data-lucide="edit" class="w-4 h-4"></i>
                            </button>
                            <button onclick="EstimatesList.generatePDF('${estimate.id}')" 
                                    class="text-purple-600 hover:text-purple-800 text-sm">
                                <i data-lucide="file-text" class="w-4 h-4"></i>
                            </button>
                            <button onclick="Estimates.deleteEstimate('${estimate.id}')" 
                                    class="text-red-600 hover:text-red-800 text-sm">
                                <i data-lucide="trash-2" class="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    search() {
        const query = document.getElementById('estimateSearch').value.toLowerCase();
        const filtered = Data.estimates.filter(estimate => 
            estimate.customerName.toLowerCase().includes(query) ||
            estimate.projectType.toLowerCase().includes(query) ||
            estimate.description.toLowerCase().includes(query)
        );
        
        const container = document.getElementById('estimatesList');
        if (filtered.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-8">
                    <p>No estimates found matching "${query}"</p>
                </div>
            `;
        } else {
            container.innerHTML = filtered.map(estimate => this.renderEstimateCard(estimate)).join('');
            lucide.createIcons();
        }
    },
    
    view(id) {
        const estimate = Data.estimates.find(e => e.id === id);
        if (estimate) {
            UI.showModal(`Estimate Details - ${estimate.customerName}`, `
                <div class="space-y-4">
                    <div><strong>Project:</strong> ${estimate.projectType}</div>
                    <div><strong>Duration:</strong> ${estimate.duration}</div>
                    <div><strong>Description:</strong> ${estimate.description}</div>
                    <div><strong>Total:</strong> ${Data.formatCurrency(estimate.total)}</div>
                    <div><strong>Status:</strong> ${estimate.status}</div>
                    <div><strong>Created:</strong> ${Data.formatDate(estimate.dateCreated)}</div>
                </div>
            `, [
                { text: 'Close', type: 'secondary', onclick: 'this.closest(".fixed").remove()' }
            ]);
        }
    },
    
    generatePDF(id) {
        const estimate = Data.estimates.find(e => e.id === id);
        if (estimate) {
            // Simple PDF generation (you'd want to enhance this)
            UI.showAlert('PDF generation feature coming soon!', 'info');
        }
    },
    
    export() {
        const data = Data.estimates.map(est => ({
            customer: est.customerName,
            project: est.projectType,
            total: est.total,
            status: est.status,
            date: est.dateCreated
        }));
        
        const csv = [
            'Customer,Project,Total,Status,Date',
            ...data.map(row => `${row.customer},${row.project},${row.total},${row.status},${row.date}`)
        ].join('\n');
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'estimates.csv';
        a.click();
        URL.revokeObjectURL(url);
        
        UI.showAlert('Estimates exported successfully!');
    }
};// Customer form component for T&J Field Services
const CustomerForm = {
    render() {
        return `
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Add New Customer</h3>
                    <button onclick="Customers.cancelEdit()" id="cancelEdit" class="text-gray-400 hover:text-gray-600 hidden">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                </div>
                
                <form id="customerForm" onsubmit="Customers.saveCustomer(event)">
                    ${this.renderBasicInfo()}
                    ${this.renderContactInfo()}
                    ${this.renderAddressInfo()}
                    ${this.renderAdditionalInfo()}
                    ${this.renderActions()}
                </form>
            </div>
        `;
    },
    
    renderBasicInfo() {
        return `
            <!-- Basic Information -->
            <div class="mb-6">
                <h4 class="font-medium text-gray-900 mb-3">Basic Information</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                        <input type="text" id="customerFullName" required class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Company (Optional)</label>
                        <input type="text" id="customerCompany" class="form-input">
                    </div>
                </div>
            </div>
        `;
    },
    
    renderContactInfo() {
        return `
            <!-- Contact Information -->
            <div class="mb-6">
                <h4 class="font-medium text-gray-900 mb-3">Contact Information</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Primary Phone *</label>
                        <input type="tel" id="customerPrimaryPhone" required class="form-input">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Secondary Phone</label>
                        <input type="tel" id="customerSecondaryPhone" class="form-input">
                    </div>
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                    <input type="email" id="customerEmailAddress" class="form-input">
                </div>
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Preferred Contact Method</label>
                    <select id="preferredContact" class="form-select">
                        <option value="phone">Phone</option>
                        <option value="email">Email</option>
                        <option value="text">Text Message</option>
                        <option value="any">Any Method</option>
                    </select>
                </div>
            </div>
        `;
    },
    
    renderAddressInfo() {
        return `
            <!-- Address Information -->
            <div class="mb-6">
                <h4 class="font-medium text-gray-900 mb-3">Address Information</h4>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
                    <input type="text" id="customerStreetAddress" class="form-input">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                        <input type="text" id="customerCity" class="form-input" value="Delmar">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                        <select id="customerState" class="form-select">
                            <option value="MD" selected>Maryland</option>
                            <option value="DE">Delaware</option>
                            <option value="VA">Virginia</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                        <input type="text" id="customerZip" class="form-input" value="21875">
                    </div>
                </div>
            </div>
        `;
    },
    
    renderAdditionalInfo() {
        return `
            <!-- Additional Information -->
            <div class="mb-6">
                <h4 class="font-medium text-gray-900 mb-3">Additional Information</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Source</label>
                        <select id="customerSource" class="form-select">
                            <option value="">How did they find us?</option>
                            <option value="referral">Referral</option>
                            <option value="google">Google Search</option>
                            <option value="facebook">Facebook</option>
                            <option value="nextdoor">Nextdoor</option>
                            <option value="yard-sign">Yard Sign</option>
                            <option value="repeat">Repeat Customer</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Customer Type</label>
                        <select id="customerType" class="form-select">
                            <option value="residential">Residential</option>
                            <option value="commercial">Commercial</option>
                            <option value="property-manager">Property Manager</option>
                        </select>
                    </div>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
                    <textarea id="customerNotes" rows="3" class="form-textarea" 
                              placeholder="Any special notes about this customer..."></textarea>
                </div>
            </div>
        `;
    },
    
    renderActions() {
        return `
            <!-- Actions -->
            <div class="flex space-x-4">
                <button type="submit" class="btn-primary flex-1">
                    <i data-lucide="user-plus" class="inline w-4 h-4 mr-2"></i>
                    Add Customer
                </button>
                <button type="button" onclick="CustomerForm.clear()" class="btn-secondary">
                    Clear
                </button>
            </div>
        `;
    },
    
    collectData() {
        return {
            name: document.getElementById('customerFullName').value,
            company: document.getElementById('customerCompany').value,
            primaryPhone: document.getElementById('customerPrimaryPhone').value,
            secondaryPhone: document.getElementById('customerSecondaryPhone').value,
            email: document.getElementById('customerEmailAddress').value,
            preferredContact: document.getElementById('preferredContact').value,
            address: this.getFullAddress(),
            streetAddress: document.getElementById('customerStreetAddress').value,
            city: document.getElementById('customerCity').value,
            state: document.getElementById('customerState').value,
            zip: document.getElementById('customerZip').value,
            source: document.getElementById('customerSource').value,
            type: document.getElementById('customerType').value,
            notes: document.getElementById('customerNotes').value
        };
    },
    
    getFullAddress() {
        const street = document.getElementById('customerStreetAddress').value;
        const city = document.getElementById('customerCity').value;
        const state = document.getElementById('customerState').value;
        const zip = document.getElementById('customerZip').value;
        
        return [street, city, state, zip].filter(part => part.trim()).join(', ');
    },
    
    loadData(customer) {
        document.getElementById('customerFullName').value = customer.name || '';
        document.getElementById('customerCompany').value = customer.company || '';
        document.getElementById('customerPrimaryPhone').value = customer.primaryPhone || '';
        document.getElementById('customerSecondaryPhone').value = customer.secondaryPhone || '';
        document.getElementById('customerEmailAddress').value = customer.email || '';
        document.getElementById('preferredContact').value = customer.preferredContact || 'phone';
        document.getElementById('customerStreetAddress').value = customer.streetAddress || '';
        document.getElementById('customerCity').value = customer.city || 'Delmar';
        document.getElementById('customerState').value = customer.state || 'MD';
        document.getElementById('customerZip').value = customer.zip || '21875';
        document.getElementById('customerSource').value = customer.source || '';
        document.getElementById('customerType').value = customer.type || 'residential';
        document.getElementById('customerNotes').value = customer.notes || '';
        
        // Show cancel button
        document.getElementById('cancelEdit').classList.remove('hidden');
    },
    
    clear() {
        UI.clearForm(document.getElementById('customerForm'));
        
        // Reset defaults
        document.getElementById('customerCity').value = 'Delmar';
        document.getElementById('customerState').value = 'MD';
        document.getElementById('customerZip').value = '21875';
        document.getElementById('preferredContact').value = 'phone';
        document.getElementById('customerType').value = 'residential';
        
        // Hide cancel button
        document.getElementById('cancelEdit').classList.add('hidden');
    }
};// Customers export component for T&J Field Services
const CustomersExport = {
    export() {
        const data = Data.customers.map(customer => ({
            name: customer.name,
            company: customer.company || '',
            phone: customer.primaryPhone,
            email: customer.email || '',
            address: customer.address || '',
            type: customer.type || 'residential',
            dateAdded: customer.dateAdded
        }));
        
        const csv = [
            'Name,Company,Phone,Email,Address,Type,Date Added',
            ...data.map(row => `"${row.name}","${row.company}","${row.phone}","${row.email}","${row.address}","${row.type}","${row.dateAdded}"`)
        ].join('\n');
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'customers.csv';
        a.click();
        URL.revokeObjectURL(url);
        
        UI.showAlert('Customers exported successfully!');
    },
    
    exportToVCF(id) {
        const customer = Data.customers.find(c => c.id === id);
        if (customer) {
            const vcf = [
                'BEGIN:VCARD',
                'VERSION:3.0',
                `FN:${customer.name}`,
                `TEL:${customer.primaryPhone}`,
                customer.email ? `EMAIL:${customer.email}` : '',
                customer.address ? `ADR:;;${customer.address};;;` : '',
                'END:VCARD'
            ].filter(line => line).join('\n');
            
            const blob = new Blob([vcf], { type: 'text/vcard' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${customer.name.replace(/\s+/g, '_')}.vcf`;
            a.click();
            URL.revokeObjectURL(url);
            
            UI.showAlert('Contact exported to VCF!');
        }
    }
};// Projects filter component for T&J Field Services
const ProjectsFilter = {
    render() {
        return `
            <!-- Search and Filters -->
            <div class="mb-4 space-y-3">
                <input type="text" id="projectSearch" placeholder="Search projects..." 
                       onkeyup="ProjectsList.search()" class="form-input">
                
                <div class="flex flex-wrap gap-2">
                    <button onclick="ProjectsList.filter('all')" 
                            class="filter-btn active" data-filter="all">All</button>
                    <button onclick="ProjectsList.filter('active')" 
                            class="filter-btn" data-filter="active">Active</button>
                    <button onclick="ProjectsList.filter('pending')" 
                            class="filter-btn" data-filter="pending">Pending</button>
                    <button onclick="ProjectsList.filter('completed')" 
                            class="filter-btn" data-filter="completed">Completed</button>
                    <button onclick="ProjectsList.filter('high-priority')" 
                            class="filter-btn" data-filter="high-priority">High Priority</button>
                </div>
            </div>
        `;
    }
};// Projects export component for T&J Field Services
const ProjectsExport = {
    export() {
        const data = Data.projects.map(project => ({
            name: project.name,
            customer: project.customerName,
            type: project.type,
            status: project.status,
            priority: project.priority,
            value: project.value || 0,
            startDate: project.startDate || '',
            endDate: project.endDate || '',
            duration: project.duration || '',
            address: project.address || '',
            dateCreated: project.dateCreated
        }));
        
        const csv = [
            'Project Name,Customer,Type,Status,Priority,Value,Start Date,End Date,Duration,Address,Date Created',
            ...data.map(row => `"${row.name}","${row.customer}","${row.type}","${row.status}","${row.priority}","${row.value}","${row.startDate}","${row.endDate}","${row.duration}","${row.address}","${row.dateCreated}"`)
        ].join('\n');
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'projects.csv';
        a.click();
        URL.revokeObjectURL(url);
        
        UI.showAlert('Projects exported successfully!');
    },
    
    exportByStatus(status) {
        const filteredProjects = Data.projects.filter(p => p.status === status);
        
        if (filteredProjects.length === 0) {
            UI.showAlert(`No ${status} projects to export`, 'info');
            return;
        }
        
        const data = filteredProjects.map(project => ({
            name: project.name,
            customer: project.customerName,
            type: project.type,
            value: project.value || 0,
            startDate: project.startDate || '',
            endDate: project.endDate || '',
            dateCreated: project.dateCreated
        }));
        
        const csv = [
            'Project Name,Customer,Type,Value,Start Date,End Date,Date Created',
            ...data.map(row => `"${row.name}","${row.customer}","${row.type}","${row.value}","${row.startDate}","${row.endDate}","${row.dateCreated}"`)
        ].join('\n');
        
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${status}_projects.csv`;
        a.click();
        URL.revokeObjectURL(url);
        
        UI.showAlert(`${status} projects exported successfully!`);
    },
    
    exportProjectSummary() {
        const summary = {
            totalProjects: Data.projects.length,
            activeProjects: Data.projects.filter(p => p.status === 'in-progress').length,
            completedProjects: Data.projects.filter(p => p.status === 'completed').length,
            pendingProjects: Data.projects.filter(p => p.status === 'pending').length,
            totalValue: Data.projects.reduce((sum, p) => sum + (p.value || 0), 0),
            averageValue: Data.projects.length > 0 ? 
                (Data.projects.reduce((sum, p) => sum + (p.value || 0), 0) / Data.projects.length) : 0
        };
        
        const summaryText = [
            'T&J FIELD SERVICES - PROJECT SUMMARY',
            '=====================================',
            '',
            `Total Projects: ${summary.totalProjects}`,
            `Active Projects: ${summary.activeProjects}`,
            `Completed Projects: ${summary.completedProjects}`,
            `Pending Projects: ${summary.pendingProjects}`,
            '',
            `Total Project Value: ${Data.formatCurrency(summary.totalValue)}`,
            `Average Project Value: ${Data.formatCurrency(summary.averageValue)}`,
            '',
            `Report Generated: ${new Date().toLocaleDateString()}`,
            '',
            'PROJECT BREAKDOWN BY TYPE:',
            '-------------------------'
        ];
        
        // Add project type breakdown
        const typeBreakdown = {};
        Data.projects.forEach(project => {
            typeBreakdown[project.type] = (typeBreakdown[project.type] || 0) + 1;
        });
        
        Object.entries(typeBreakdown).forEach(([type, count]) => {
            summaryText.push(`${type}: ${count} projects`);
        });
        
        const blob = new Blob([summaryText.join('\n')], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'project_summary.txt';
        a.click();
        URL.revokeObjectURL(url);
        
        UI.showAlert('Project summary exported!');
    }
};// Calendar sidebar component for T&J Field Services
const CalendarSidebar = {
    render() {
        return `
            <!-- Quick Add Event -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h4 class="font-semibold mb-3">Quick Add Event</h4>
                ${EventForm.renderQuick()}
            </div>
            
            <!-- Today's Schedule -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h4 class="font-semibold mb-3">Today's Schedule</h4>
                <div id="todaySchedule">
                    <div class="text-center text-gray-500 py-4">
                        <i data-lucide="calendar-x" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                        <p class="text-sm">No events today</p>
                    </div>
                </div>
            </div>
            
            <!-- Upcoming Events -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h4 class="font-semibold mb-3">Upcoming Events</h4>
                <div id="upcomingEvents">
                    <div class="text-center text-gray-500 py-4">
                        <i data-lucide="clock" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                        <p class="text-sm">Loading...</p>
                    </div>
                </div>
            </div>
            
            <!-- Project Deadlines -->
            <div class="bg-white rounded-lg shadow-md p-4">
                <h4 class="font-semibold mb-3">Project Deadlines</h4>
                <div id="projectDeadlines">
                    <div class="text-center text-gray-500 py-4">
                        <i data-lucide="alert-circle" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                        <p class="text-sm">Loading...</p>
                    </div>
                </div>
            </div>
        `;
    },
    
    loadUpcoming() {
        const container = document.getElementById('upcomingEvents');
        if (!container) return;
        
        Data.events = Data.events || [];
        
        const today = new Date();
        const upcoming = Data.events
            .filter(event => new Date(event.start) > today)
            .sort((a, b) => new Date(a.start) - new Date(b.start))
            .slice(0, 5);
        
        if (upcoming.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-4">
                    <i data-lucide="calendar-x" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                    <p class="text-sm">No upcoming events</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = upcoming.map(event => this.renderEventItem(event)).join('');
        
        // Load today's schedule
        this.loadTodaySchedule();
        
        // Load project deadlines
        this.loadProjectDeadlines();
    },
    
    loadTodaySchedule() {
        const container = document.getElementById('todaySchedule');
        if (!container) return;
        
        const today = new Date().toDateString();
        const todayEvents = Data.events.filter(event => 
            new Date(event.start).toDateString() === today
        ).sort((a, b) => new Date(a.start) - new Date(b.start));
        
        if (todayEvents.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-4">
                    <i data-lucide="calendar-x" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                    <p class="text-sm">No events today</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = todayEvents.map(event => this.renderEventItem(event, true)).join('');
    },
    
    loadDayEvents(dateStr) {
        const container = document.getElementById('todaySchedule');
        if (!container) return;
        
        const selectedDate = new Date(dateStr).toDateString();
        const dayEvents = Data.events.filter(event => 
            new Date(event.start).toDateString() === selectedDate
        ).sort((a, b) => new Date(a.start) - new Date(b.start));
        
        // Update header
        const header = container.parentElement.querySelector('h4');
        if (header) {
            const dateObj = new Date(dateStr);
            header.textContent = `${dateObj.toLocaleDateString('en-US', { 
                weekday: 'long', 
                month: 'short', 
                day: 'numeric' 
            })} Schedule`;
        }
        
        if (dayEvents.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-4">
                    <i data-lucide="calendar-x" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                    <p class="text-sm">No events this day</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = dayEvents.map(event => this.renderEventItem(event, true)).join('');
    },
    
    loadProjectDeadlines() {
        const container = document.getElementById('projectDeadlines');
        if (!container) return;
        
        const today = new Date();
        const upcoming = Data.projects
            .filter(project => project.endDate && new Date(project.endDate) > today)
            .sort((a, b) => new Date(a.endDate) - new Date(b.endDate))
            .slice(0, 5);
        
        if (upcoming.length === 0) {
            container.innerHTML = `
                <div class="text-center text-gray-500 py-4">
                    <i data-lucide="check-circle" class="w-8 h-8 mx-auto mb-2 text-gray-300"></i>
                    <p class="text-sm">No upcoming deadlines</p>
                </div>
            `;
            return;
        }
        
        container.innerHTML = upcoming.map(project => this.renderDeadlineItem(project)).join('');
    },
    
    renderEventItem(event, showTime = false) {
        const eventDate = new Date(event.start);
        const colors = {
            'appointment': 'blue',
            'project': 'green',
            'estimate': 'orange',
            'personal': 'purple'
        };
        
        const color = colors[event.type] || 'gray';
        
        return `
            <div class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer"
                 onclick="EventActions.viewEvent('${event.id}')">
                <div class="w-3 h-3 bg-${color}-400 rounded-full flex-shrink-0"></div>
                <div class="flex-1 min-w-0">
                    <div class="text-sm font-medium truncate">${event.title}</div>
                    <div class="text-xs text-gray-500">
                        ${showTime ? eventDate.toLocaleTimeString('en-US', { 
                            hour: 'numeric', 
                            minute: '2-digit' 
                        }) : eventDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric' 
                        })}
                    </div>
                </div>
            </div>
        `;
    },
    
    renderDeadlineItem(project) {
        const endDate = new Date(project.endDate);
        const today = new Date();
        const daysUntil = Math.ceil((endDate - today) / (1000 * 60 * 60 * 24));
        
        let urgencyColor = 'gray';
        if (daysUntil <= 3) urgencyColor = 'red';
        else if (daysUntil <= 7) urgencyColor = 'orange';
        else if (daysUntil <= 14) urgencyColor = 'yellow';
        
        return `
            <div class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer"
                 onclick="ProjectActions.viewDetails('${project.id}')">
                <div class="w-3 h-3 bg-${urgencyColor}-400 rounded-full flex-shrink-0"></div>
                <div class="flex-1 min-w-0">
                    <div class="text-sm font-medium truncate">${project.name}</div>
                    <div class="text-xs text-gray-500">
                        Due ${endDate.toLocaleDateString('en-US', { 
                            month: 'short', 
                            day: 'numeric' 
                        })} (${daysUntil} days)
                    </div>
                </div>
            </div>
        `;
    }
};// Calendar utility functions for T&J Field Services
const CalendarUtils = {
    formatICSDate(date, allDay = false) {
        if (allDay) {
            return date.toISOString().split('T')[0].replace(/-/g, '');
        } else {
            return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
        }
    },
    
    getPriorityNumber(priority) {
        const priorities = {
            'low': '9',
            'medium': '5', 
            'high': '3',
            'urgent': '1'
        };
        return priorities[priority] || '5';
    },
    
    generateICSContent() {
        let icsContent = [
            'BEGIN:VCALENDAR',
            'VERSION:2.0',
            'PRODID:-//T&J Field Services//Calendar//EN',
            'CALSCALE:GREGORIAN',
            'METHOD:PUBLISH'
        ];
        
        Data.events.forEach(event => {
            icsContent.push(...this.createICSEvent(event));
        });
        
        icsContent.push('END:VCALENDAR');
        return icsContent.join('\r\n');
    },
    
    createICSEvent(event) {
        const startDate = new Date(event.start);
        const endDate = new Date(event.end);
        
        return [
            'BEGIN:VEVENT',
            `UID:${event.id}@tjfieldservices.com`,
            `DTSTART:${this.formatICSDate(startDate, event.allDay)}`,
            `DTEND:${this.formatICSDate(endDate, event.allDay)}`,
            `SUMMARY:${event.title}`,
            ...(event.description ? [`DESCRIPTION:${event.description.replace(/\n/g, '\\n')}`] : []),
            ...(event.location ? [`LOCATION:${event.location}`] : []),
            `CATEGORIES:${event.type.toUpperCase()}`,
            `PRIORITY:${this.getPriorityNumber(event.priority)}`,
            `CREATED:${this.formatICSDate(new Date(event.dateCreated))}`,
            'END:VEVENT'
        ];
    },
    
    isEventInDateRange(event, startDate, endDate) {
        const eventDate = new Date(event.start);
        return eventDate >= startDate && eventDate <= endDate;
    },
    
    getEventsForDateRange(startDate, endDate) {
        return Data.events.filter(event => 
            this.isEventInDateRange(event, startDate, endDate)
        ).sort((a, b) => new Date(a.start) - new Date(b.start));
    }
};// Event actions component for T&J Field Services
const EventActions = {
    viewEvent(id) {
        const event = Data.events.find(e => e.id === id);
        if (event) {
            const customer = event.customerId ? Data.customers.find(c => c.id === event.customerId) : null;
            const project = event.projectId ? Data.projects.find(p => p.id === event.projectId) : null;
            
            const startDate = new Date(event.start);
            const endDate = new Date(event.end);
            
            UI.showModal(`Event Details - ${event.title}`, `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div><strong>Type:</strong> ${event.type || 'Not specified'}</div>
                        <div><strong>Priority:</strong> ${event.priority || 'Medium'}</div>
                    </div>
                    
                    ${event.description ? `
                        <div><strong>Description:</strong><br>${event.description}</div>
                    ` : ''}
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div><strong>Start:</strong> ${this.formatDateTime(startDate, event.allDay)}</div>
                        <div><strong>End:</strong> ${this.formatDateTime(endDate, event.allDay)}</div>
                    </div>
                    
                    ${event.location ? `
                        <div><strong>Location:</strong><br>${event.location}</div>
                    ` : ''}
                    
                    ${customer ? `
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-2">Customer Information</h4>
                            <div><strong>Name:</strong> ${customer.name}</div>
                            <div><strong>Phone:</strong> <a href="tel:${customer.primaryPhone}" class="text-blue-600">${customer.primaryPhone}</a></div>
                            ${customer.email ? `<div><strong>Email:</strong> <a href="mailto:${customer.email}" class="text-blue-600">${customer.email}</a></div>` : ''}
                        </div>
                    ` : ''}
                    
                    ${project ? `
                        <div class="border-t pt-4">
                            <h4 class="font-semibold mb-2">Related Project</h4>
                            <div><strong>Project:</strong> ${project.name}</div>
                            <div><strong>Status:</strong> ${project.status}</div>
                            <div><strong>Value:</strong> ${Data.formatCurrency(project.value || 0)}</div>
                        </div>
                    ` : ''}
                    
                    ${this.renderReminders(event)}
                    
                    <div class="text-sm text-gray-500 border-t pt-4">
                        Created: ${Data.formatDate(event.dateCreated)}
                    </div>
                </div>
            `, [
                { text: 'Edit Event', type: 'primary', onclick: `EventActions.editEvent('${event.id}'); this.closest('.fixed').remove();` },
                { text: 'Delete Event', type: 'danger', onclick: `EventActions.deleteEvent('${event.id}'); this.closest('.fixed').remove();` },
                { text: 'Close', type: 'secondary', onclick: 'this.closest(".fixed").remove()' }
            ]);
        }
    },
    
    editEvent(id) {
        const event = Data.events.find(e => e.id === id);
        if (event) {
            UI.showModal('Edit Event', EventForm.renderFull(), [
                { text: 'Update Event', type: 'primary', onclick: 'EventForm.saveFullEvent()' },
                { text: 'Cancel', type: 'secondary', onclick: 'this.closest(".fixed").remove()' }
            ]);
            
            // Load event data into form
            setTimeout(() => {
                EventForm.loadEventData(event);
            }, 100);
        }
    },
    
    deleteEvent(id) {
        const event = Data.events.find(e => e.id === id);
        if (event && confirm(`Are you sure you want to delete "${event.title}"?`)) {
            if (Calendar.deleteEvent(id)) {
                UI.showAlert('Event deleted successfully!');
            }
        }
    },
    
    markComplete(id) {
        const event = Data.events.find(e => e.id === id);
        if (event) {
            event.completed = true;
            event.completedDate = new Date().toISOString();
            Data.save('events', Data.events);
            
            CalendarView.load();
            CalendarSidebar.loadUpcoming();
            UI.showAlert('Event marked as completed!');
        }
    },
    
    reschedule(id) {
        const event = Data.events.find(e => e.id === id);
        if (event) {
            UI.showModal(`Reschedule - ${event.title}`, `
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">New Date</label>
                            <input type="date" id="rescheduleDate" class="form-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">New Time</label>
                            <input type="time" id="rescheduleTime" class="form-input" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Reason for Reschedule</label>
                        <textarea id="rescheduleReason" rows="3" class="form-textarea" 
                                  placeholder="Optional reason for rescheduling..."></textarea>
                    </div>
                </div>
            `, [
                { text: 'Reschedule', type: 'primary', onclick: `EventActions.saveReschedule('${id}')` },
                { text: 'Cancel', type: 'secondary', onclick: 'this.closest(".fixed").remove()' }
            ]);
            
            // Set current values
            const currentDate = new Date(event.start);
            document.getElementById('rescheduleDate').value = currentDate.toISOString().split('T')[0];
            document.getElementById('rescheduleTime').value = currentDate.toTimeString().slice(0, 5);
        }
    },
    
    saveReschedule(id) {
        const newDate = document.getElementById('rescheduleDate').value;
        const newTime = document.getElementById('rescheduleTime').value;
        const reason = document.getElementById('rescheduleReason').value;
        
        if (!newDate || !newTime) {
            UI.showAlert('Please select a new date and time', 'error');
            return;
        }
        
        const event = Data.events.find(e => e.id === id);
        if (event) {
            const oldStart = new Date(event.start);
            const duration = new Date(event.end) - oldStart;
            
            event.start = `${newDate}T${newTime}`;
            event.end = new Date(new Date(event.start).getTime() + duration).toISOString();
            
            if (reason) {
                event.rescheduleHistory = event.rescheduleHistory || [];
                event.rescheduleHistory.push({
                    oldDate: oldStart.toISOString(),
                    newDate: event.start,
                    reason: reason,
                    date: new Date().toISOString()
                });
            }
            
            Data.save('events', Data.events);
            
            CalendarView.load();
            CalendarSidebar.loadUpcoming();
            UI.showAlert('Event rescheduled successfully!');
            
            document.querySelector('.fixed').remove();
        }
    },
    
    duplicate(id) {
        const event = Data.events.find(e => e.id === id);
        if (event) {
            const duplicatedEvent = {
                ...event,
                id: Date.now().toString(),
                title: `${event.title} (Copy)`,
                dateCreated: new Date().toISOString()
            };
            
            delete duplicatedEvent.completed;
            delete duplicatedEvent.completedDate;
            
            Calendar.addEvent(duplicatedEvent);
            UI.showAlert('Event duplicated successfully!');
        }
    },
    
    createRecurring(id) {
        const event = Data.events.find(e => e.id === id);
        if (event) {
            UI.showModal(`Create Recurring Event - ${event.title}`, `
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Repeat</label>
                        <select id="recurringType" class="form-select">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Occurrences</label>
                        <input type="number" id="recurringCount" min="1" max="52" value="4" class="form-input">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">End Date (Optional)</label>
                        <input type="date" id="recurringEndDate" class="form-input">
                    </div>
                </div>
            `, [
                { text: 'Create Series', type: 'primary', onclick: `EventActions.saveRecurring('${id}')` },
                { text: 'Cancel', type: 'secondary', onclick: 'this.closest(".fixed").remove()' }
            ]);
        }
    },
    
    saveRecurring(id) {
        const event = Data.events.find(e => e.id === id);
        const type = document.getElementById('recurringType').value;
        const count = parseInt(document.getElementById('recurringCount').value);
        const endDate = document.getElementById('recurringEndDate').value;
        
        if (event && count > 0) {
            const startDate = new Date(event.start);
            const duration = new Date(event.end) - startDate;
            
            for (let i = 1; i <= count; i++) {
                let nextDate = new Date(startDate);
                
                switch(type) {
                    case 'daily':
                        nextDate.setDate(nextDate.getDate() + i);
                        break;
                    case 'weekly':
                        nextDate.setDate(nextDate.getDate() + (i * 7));
                        break;
                    case 'monthly':
                        nextDate.setMonth(nextDate.getMonth() + i);
                        break;
                }
                
                if (endDate && nextDate > new Date(endDate)) break;
                
                const recurringEvent = {
                    ...event,
                    id: `${event.id}_${i}`,
                    start: nextDate.toISOString(),
                    end: new Date(nextDate.getTime() + duration).toISOString(),
                    title: `${event.title} (${i + 1})`,
                    dateCreated: new Date().toISOString(),
                    parentEventId: event.id
                };
                
                Calendar.addEvent(recurringEvent);
            }
            
            UI.showAlert(`Created ${count} recurring events!`);
            document.querySelector('.fixed').remove();
        }
    },
    
    formatDateTime(date, allDay) {
        if (allDay) {
            return date.toLocaleDateString('en-US', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        } else {
            return date.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit'
            });
        }
    },
    
    renderReminders(event) {
        if (!event.emailReminder && !event.smsReminder) return '';
        
        return `
            <div class="border-t pt-4">
                <h4 class="font-semibold mb-2">Reminders</h4>
                ${event.emailReminder ? `<div>Email: ${event.emailReminder} minutes before</div>` : ''}
                ${event.smsReminder ? `<div>SMS: ${event.smsReminder} minutes before</div>` : ''}
            </div>
        `;
    }
};// Reports display component for T&J Field Services
const ReportsDisplay = {
    render() {
        return `
            <div class="bg-white rounded-lg shadow-md p-6" id="reportDisplay">
                ${this.showWelcome()}
            </div>
        `;
    },
    
    showWelcome() {
        return `
            <div class="text-center py-12">
                <i data-lucide="bar-chart-3" class="w-16 h-16 text-gray-300 mx-auto mb-4"></i>
                <h3 class="text-xl font-semibold text-gray-600 mb-2">Select a Report</h3>
                <p class="text-gray-500">Choose a report from the list to view detailed analytics</p>
            </div>
        `;
    },
    
    showFinancialReport() {
        const metrics = ReportsStats.getMetrics();
        const data = Reports.getFilteredData();
        
        document.getElementById('reportDisplay').innerHTML = `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-2xl font-bold">Financial Summary</h3>
                    <span class="text-sm text-gray-500">
                        ${Reports.dateRange.start.toLocaleDateString()} - ${Reports.dateRange.end.toLocaleDateString()}
                    </span>
                </div>
                
                <!-- Revenue Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800">Total Revenue</h4>
                        <p class="text-2xl font-bold text-green-600">${Data.formatCurrency(metrics.totalRevenue)}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800">Average Project Value</h4>
                        <p class="text-2xl font-bold text-blue-600">${Data.formatCurrency(metrics.averageProjectValue)}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800">Projects Completed</h4>
                        <p class="text-2xl font-bold text-purple-600">${metrics.completedProjects}</p>
                    </div>
                </div>
                
                <!-- Revenue by Project Type -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Revenue by Project Type</h4>
                    ${this.renderRevenueByType(data.projects)}
                </div>
                
                <!-- Monthly Breakdown -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Monthly Revenue Trend</h4>
                    ${this.renderMonthlyTrend(data.projects)}
                </div>
            </div>
        `;
        
        lucide.createIcons();
    },
    
    showProjectsReport() {
        const metrics = ReportsStats.getMetrics();
        const data = Reports.getFilteredData();
        
        document.getElementById('reportDisplay').innerHTML = `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-2xl font-bold">Project Analysis</h3>
                    <span class="text-sm text-gray-500">
                        ${Reports.dateRange.start.toLocaleDateString()} - ${Reports.dateRange.end.toLocaleDateString()}
                    </span>
                </div>
                
                <!-- Project Status Overview -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-yellow-50 p-4 rounded-lg text-center">
                        <h4 class="font-semibold text-yellow-800">Pending</h4>
                        <p class="text-2xl font-bold text-yellow-600">${metrics.pendingProjects}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <h4 class="font-semibold text-blue-800">In Progress</h4>
                        <p class="text-2xl font-bold text-blue-600">${metrics.activeProjects}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <h4 class="font-semibold text-green-800">Completed</h4>
                        <p class="text-2xl font-bold text-green-600">${metrics.completedProjects}</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <h4 class="font-semibold text-gray-800">Total</h4>
                        <p class="text-2xl font-bold text-gray-600">${metrics.totalProjects}</p>
                    </div>
                </div>
                
                <!-- Completion Rate -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-semibold mb-4">Completion Rate</h4>
                    <div class="flex items-center space-x-4">
                        <div class="flex-1 bg-gray-200 rounded-full h-4">
                            <div class="bg-green-600 h-4 rounded-full transition-all duration-300" 
                                 style="width: ${metrics.completionRate}%"></div>
                        </div>
                        <span class="text-lg font-bold text-green-600">${Math.round(metrics.completionRate)}%</span>
                    </div>
                </div>
                
                <!-- Project Types -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Projects by Type</h4>
                    ${this.renderProjectsByType(data.projects)}
                </div>
            </div>
        `;
        
        lucide.createIcons();
    },
    
    showCustomersReport() {
        const data = Reports.getFilteredData();
        
        document.getElementById('reportDisplay').innerHTML = `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-2xl font-bold">Customer Report</h3>
                    <span class="text-sm text-gray-500">
                        ${Reports.dateRange.start.toLocaleDateString()} - ${Reports.dateRange.end.toLocaleDateString()}
                    </span>
                </div>
                
                <!-- Customer Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800">New Customers</h4>
                        <p class="text-2xl font-bold text-purple-600">${data.customers.length}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800">Total Customers</h4>
                        <p class="text-2xl font-bold text-blue-600">${Data.customers.length}</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800">Repeat Customers</h4>
                        <p class="text-2xl font-bold text-green-600">${this.getRepeatCustomers()}</p>
                    </div>
                </div>
                
                <!-- Top Customers -->
                <div>
                    <h4 class="text-lg font-semibold mb-4">Top Customers by Project Value</h4>
                    ${this.renderTopCustomers()}
                </div>
            </div>
        `;
        
        lucide.createIcons();
    },
    
    renderRevenueByType(projects) {
        const typeRevenue = {};
        projects.forEach(project => {
            typeRevenue[project.type] = (typeRevenue[project.type] || 0) + (project.value || 0);
        });
        
        return `
            <div class="space-y-2">
                ${Object.entries(typeRevenue).map(([type, revenue]) => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <span class="font-medium">${type}</span>
                        <span class="text-green-600 font-bold">${Data.formatCurrency(revenue)}</span>
                    </div>
                `).join('')}
            </div>
        `;
    },
    
    renderProjectsByType(projects) {
        const typeCount = {};
        projects.forEach(project => {
            typeCount[project.type] = (typeCount[project.type] || 0) + 1;
        });
        
        return `
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                ${Object.entries(typeCount).map(([type, count]) => `
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <h5 class="font-medium text-gray-800">${type}</h5>
                        <p class="text-xl font-bold text-blue-600">${count}</p>
                    </div>
                `).join('')}
            </div>
        `;
    },
    
    getRepeatCustomers() {
        const customerProjectCount = {};
        Data.projects.forEach(project => {
            customerProjectCount[project.customerId] = (customerProjectCount[project.customerId] || 0) + 1;
        });
        
        return Object.values(customerProjectCount).filter(count => count > 1).length;
    },
    
    renderTopCustomers() {
        const customerRevenue = {};
        Data.projects.forEach(project => {
            customerRevenue[project.customerId] = (customerRevenue[project.customerId] || 0) + (project.value || 0);
        });
        
        const topCustomers = Object.entries(customerRevenue)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 5)
            .map(([customerId, revenue]) => {
                const customer = Data.customers.find(c => c.id === customerId);
                return { customer: customer?.name || 'Unknown', revenue };
            });
        
        return `
            <div class="space-y-2">
                ${topCustomers.map((item, index) => `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                        <div class="flex items-center space-x-3">
                            <span class="w-6 h-6 bg-blue-100 text-blue-800 rounded-full flex items-center justify-center text-sm font-bold">
                                ${index + 1}
                            </span>
                            <span class="font-medium">${item.customer}</span>
                        </div>
                        <span class="text-green-600 font-bold">${Data.formatCurrency(item.revenue)}</span>
                    </div>
                `).join('')}
            </div>
        `;
    }
};// Custom report builder for T&J Field Services
const ReportsCustom = {
    showBuilder() {
        UI.showModal('Custom Report Builder', this.renderBuilder(), [
            { text: 'Generate Report', type: 'primary', onclick: 'ReportsCustom.generateCustomReport()' },
            { text: 'Cancel', type: 'secondary', onclick: 'this.closest(".fixed").remove()' }
        ]);
    },
    
    renderBuilder() {
        return `
            <div class="space-y-6">
                <!-- Report Type -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Report Type</label>
                    <select id="customReportType" class="form-select">
                        <option value="summary">Summary Report</option>
                        <option value="detailed">Detailed Analysis</option>
                        <option value="comparison">Comparison Report</option>
                    </select>
                </div>
                
                <!-- Data Sources -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Include Data From</label>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="includeProjects" checked class="form-checkbox">
                            <span class="ml-2">Projects</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeCustomers" checked class="form-checkbox">
                            <span class="ml-2">Customers</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="includeSchedule" class="form-checkbox">
                            <span class="ml-2">Schedule/Events</span>
                        </label>
                    </div>
                </div>
                
                <!-- Metrics -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Metrics to Include</label>
                    <div class="grid grid-cols-2 gap-2">
                        <label class="flex items-center">
                            <input type="checkbox" id="metricRevenue" checked class="form-checkbox">
                            <span class="ml-2">Revenue</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="metricProjects" checked class="form-checkbox">
                            <span class="ml-2">Project Count</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="metricCompletion" class="form-checkbox">
                            <span class="ml-2">Completion Rate</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" id="metricCustomers" class="form-checkbox">
                            <span class="ml-2">Customer Growth</span>
                        </label>
                    </div>
                </div>
                
                <!-- Grouping -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Group Data By</label>
                    <select id="customGroupBy" class="form-select">
                        <option value="none">No Grouping</option>
                        <option value="month">Month</option>
                        <option value="quarter">Quarter</option>
                        <option value="type">Project Type</option>
                        <option value="status">Project Status</option>
                        <option value="customer">Customer</option>
                    </select>
                </div>
                
                <!-- Filters -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Filters</label>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Project Status</label>
                            <select id="filterStatus" class="form-select text-sm">
                                <option value="">All Statuses</option>
                                <option value="pending">Pending</option>
                                <option value="in-progress">In Progress</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Project Type</label>
                            <select id="filterType" class="form-select text-sm">
                                <option value="">All Types</option>
                                <option value="deck">Deck Building</option>
                                <option value="remodeling">Remodeling</option>
                                <option value="handyman">Handyman</option>
                                <option value="renovation">Renovation</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-gray-500 mb-1">Minimum Project Value</label>
                            <input type="number" id="filterMinValue" placeholder="0" class="form-input text-sm">
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    generateCustomReport() {
        const config = this.collectConfig();
        const data = this.getFilteredData(config);
        const reportContent = this.buildCustomReport(config, data);
        
        document.getElementById('reportDisplay').innerHTML = reportContent;
        document.querySelector('.fixed').remove();
        
        // Update current report
        Reports.currentReport = 'custom';
        
        // Update active report in list
        document.querySelectorAll('.report-item').forEach(item => {
            item.classList.remove('active');
        });
        
        lucide.createIcons();
        UI.showAlert('Custom report generated successfully!');
    },
    
    collectConfig() {
        return {
            type: document.getElementById('customReportType').value,
            includeProjects: document.getElementById('includeProjects').checked,
            includeCustomers: document.getElementById('includeCustomers').checked,
            includeSchedule: document.getElementById('includeSchedule').checked,
            metrics: {
                revenue: document.getElementById('metricRevenue').checked,
                projects: document.getElementById('metricProjects').checked,
                completion: document.getElementById('metricCompletion').checked,
                customers: document.getElementById('metricCustomers').checked
            },
            groupBy: document.getElementById('customGroupBy').value,
            filters: {
                status: document.getElementById('filterStatus').value,
                type: document.getElementById('filterType').value,
                minValue: parseFloat(document.getElementById('filterMinValue').value) || 0
            }
        };
    },
    
    getFilteredData(config) {
        const baseData = Reports.getFilteredData();
        
        // Apply additional filters
        let projects = baseData.projects;
        
        if (config.filters.status) {
            projects = projects.filter(p => p.status === config.filters.status);
        }
        
        if (config.filters.type) {
            projects = projects.filter(p => p.type === config.filters.type);
        }
        
        if (config.filters.minValue > 0) {
            projects = projects.filter(p => (p.value || 0) >= config.filters.minValue);
        }
        
        return {
            ...baseData,
            projects: projects
        };
    },
    
    buildCustomReport(config, data) {
        const title = this.getCustomReportTitle(config);
        
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-2xl font-bold">${title}</h3>
                    <span class="text-sm text-gray-500">
                        ${Reports.dateRange.start.toLocaleDateString()} - ${Reports.dateRange.end.toLocaleDateString()}
                    </span>
                </div>
                
                ${config.metrics.revenue || config.metrics.projects || config.metrics.completion || config.metrics.customers ? 
                    this.renderCustomMetrics(config, data) : ''}
                
                ${config.includeProjects ? this.renderProjectsSection(config, data) : ''}
                
                ${config.includeCustomers ? this.renderCustomersSection(config, data) : ''}
                
                ${config.includeSchedule ? this.renderScheduleSection(config, data) : ''}
                
                ${config.groupBy !== 'none' ? this.renderGroupedData(config, data) : ''}
            </div>
        `;
    },
    
    getCustomReportTitle(config) {
        const typeNames = {
            'summary': 'Custom Summary Report',
            'detailed': 'Custom Detailed Analysis',
            'comparison': 'Custom Comparison Report'
        };
        return typeNames[config.type] || 'Custom Report';
    },
    
    renderCustomMetrics(config, data) {
        const metrics = [];
        
        if (config.metrics.revenue) {
            const totalRevenue = data.projects.reduce((sum, p) => sum + (p.value || 0), 0);
            metrics.push({ label: 'Total Revenue', value: Data.formatCurrency(totalRevenue), color: 'green' });
        }
        
        if (config.metrics.projects) {
            metrics.push({ label: 'Total Projects', value: data.projects.length, color: 'blue' });
        }
        
        if (config.metrics.completion) {
            const completed = data.projects.filter(p => p.status === 'completed').length;
            const rate = data.projects.length > 0 ? Math.round((completed / data.projects.length) * 100) : 0;
            metrics.push({ label: 'Completion Rate', value: `${rate}%`, color: 'purple' });
        }
        
        if (config.metrics.customers) {
            metrics.push({ label: 'New Customers', value: data.customers.length, color: 'orange' });
        }
        
        return `
            <div class="grid grid-cols-1 md:grid-cols-${Math.min(metrics.length, 4)} gap-6">
                ${metrics.map(metric => `
                    <div class="bg-${metric.color}-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-${metric.color}-800">${metric.label}</h4>
                        <p class="text-2xl font-bold text-${metric.color}-600">${metric.value}</p>
                    </div>
                `).join('')}
            </div>
        `;
    },
    
    renderProjectsSection(config, data) {
        return `
            <div class="bg-white border rounded-lg p-6">
                <h4 class="text-lg font-semibold mb-4">Projects Overview</h4>
                <div class="space-y-2">
                    ${data.projects.slice(0, 10).map(project => `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                            <div>
                                <div class="font-medium">${project.name}</div>
                                <div class="text-sm text-gray-500">${project.type} â€¢ ${project.status}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-green-600">${Data.formatCurrency(project.value || 0)}</div>
                                <div class="text-sm text-gray-500">${Data.formatDate(project.dateCreated)}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ${data.projects.length > 10 ? `<p class="text-sm text-gray-500 mt-4">... and ${data.projects.length - 10} more projects</p>` : ''}
            </div>
        `;
    },
    
    renderCustomersSection(config, data) {
        return `
            <div class="bg-white border rounded-lg p-6">
                <h4 class="text-lg font-semibold mb-4">Customers Overview</h4>
                <div class="space-y-2">
                    ${data.customers.slice(0, 5).map(customer => `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded">
                            <div>
                                <div class="font-medium">${customer.name}</div>
                                <div class="text-sm text-gray-500">${customer.email || customer.primaryPhone}</div>
                            </div>
                            <div class="text-sm text-gray-500">${Data.formatDate(customer.dateCreated)}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    },
    
    renderScheduleSection(config, data) {
        return `
            <div class="bg-white border rounded-lg p-6">
                <h4 class="text-lg font-semibold mb-4">Schedule Overview</h4>
                <div class="text-center py-4 text-gray-500">
                    <p>Schedule data would be displayed here</p>
                    <p class="text-sm">${data.events ? data.events.length : 0} events in selected period</p>
                </div>
            </div>
        `;
    },
    
    renderGroupedData(config, data) {
        return `
            <div class="bg-white border rounded-lg p-6">
                <h4 class="text-lg font-semibold mb-4">Data Grouped by ${config.groupBy}</h4>
                <div class="text-center py-4 text-gray-500">
                    <p>Grouped analysis would be displayed here</p>
                </div>
            </div>
        `;
    }
};// General settings component for T&J Field Services
const SettingsGeneral = {
    render() {
        return `
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold">General Settings</h3>
                    <button onclick="SettingsGeneral.save()" class="btn-primary">
                        <i data-lucide="save" class="inline w-4 h-4 mr-2"></i>
                        Save Changes
                    </button>
                </div>
                
                <div class="space-y-8">
                    <!-- Company Information -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Company Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Company Name</label>
                                <input type="text" id="companyName" class="form-input" 
                                       placeholder="T&J Field Services">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Time Zone</label>
                                <select id="timezone" class="form-select">
                                    <option value="America/New_York">Eastern Time (ET)</option>
                                    <option value="America/Chicago">Central Time (CT)</option>
                                    <option value="America/Denver">Mountain Time (MT)</option>
                                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Date & Time Format -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Date & Time Format</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date Format</label>
                                <select id="dateFormat" class="form-select">
                                    <option value="MM/DD/YYYY">MM/DD/YYYY (12/31/2024)</option>
                                    <option value="DD/MM/YYYY">DD/MM/YYYY (31/12/2024)</option>
                                    <option value="YYYY-MM-DD">YYYY-MM-DD (2024-12-31)</option>
                                    <option value="MMM DD, YYYY">MMM DD, YYYY (Dec 31, 2024)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Time Format</label>
                                <select id="timeFormat" class="form-select">
                                    <option value="12">12-hour (2:30 PM)</option>
                                    <option value="24">24-hour (14:30)</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Currency</label>
                                <select id="currency" class="form-select">
                                    <option value="USD">USD ($)</option>
                                    <option value="CAD">CAD (C$)</option>
                                    <option value="EUR">EUR (â‚¬)</option>
                                    <option value="GBP">GBP (Â£)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Language & Region -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Language & Region</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                <select id="language" class="form-select">
                                    <option value="en">English</option>
                                    <option value="es">Spanish</option>
                                    <option value="fr">French</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Theme</label>
                                <select id="theme" class="form-select">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                    <option value="auto">Auto (System)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Interface Preferences -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Interface Preferences</h4>
                        <div class="space-y-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="sidebarCollapsed" class="form-checkbox">
                                <span class="ml-3">Start with sidebar collapsed</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="showWelcomeMessage" class="form-checkbox">
                                <span class="ml-3">Show welcome message on dashboard</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="enableAnimations" class="form-checkbox">
                                <span class="ml-3">Enable page animations</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Preview -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="text-lg font-medium mb-3">Preview</h4>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between">
                                <span>Current Date:</span>
                                <span id="previewDate" class="font-mono"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Current Time:</span>
                                <span id="previewTime" class="font-mono"></span>
                            </div>
                            <div class="flex justify-between">
                                <span>Sample Amount:</span>
                                <span id="previewCurrency" class="font-mono"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        // Load current settings into form
        document.getElementById('companyName').value = Settings.getSetting('companyName', 'T&J Field Services');
        document.getElementById('timezone').value = Settings.getSetting('timezone', 'America/New_York');
        document.getElementById('dateFormat').value = Settings.getSetting('dateFormat', 'MM/DD/YYYY');
        document.getElementById('timeFormat').value = Settings.getSetting('timeFormat', '12');
        document.getElementById('currency').value = Settings.getSetting('currency', 'USD');
        document.getElementById('language').value = Settings.getSetting('language', 'en');
        document.getElementById('theme').value = Settings.getSetting('theme', 'light');
        document.getElementById('sidebarCollapsed').checked = Settings.getSetting('sidebarCollapsed', false);
        document.getElementById('showWelcomeMessage').checked = Settings.getSetting('showWelcomeMessage', true);
        document.getElementById('enableAnimations').checked = Settings.getSetting('enableAnimations', true);
        
        // Add event listeners for preview updates
        ['dateFormat', 'timeFormat', 'currency'].forEach(id => {
            document.getElementById(id).addEventListener('change', this.updatePreview.bind(this));
        });
        
        this.updatePreview();
    },
    
    updatePreview() {
        const dateFormat = document.getElementById('dateFormat').value;
        const timeFormat = document.getElementById('timeFormat').value;
        const currency = document.getElementById('currency').value;
        
        const now = new Date();
        
        // Update date preview
        let dateStr = '';
        switch(dateFormat) {
            case 'MM/DD/YYYY':
                dateStr = now.toLocaleDateString('en-US');
                break;
            case 'DD/MM/YYYY':
                dateStr = now.toLocaleDateString('en-GB');
                break;
            case 'YYYY-MM-DD':
                dateStr = now.toISOString().split('T')[0];
                break;
            case 'MMM DD, YYYY':
                dateStr = now.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'short', 
                    day: 'numeric' 
                });
                break;
        }
        document.getElementById('previewDate').textContent = dateStr;
        
        // Update time preview
        const timeStr = timeFormat === '12' ? 
            now.toLocaleTimeString('en-US', { hour12: true }) :
            now.toLocaleTimeString('en-US', { hour12: false });
        document.getElementById('previewTime').textContent = timeStr;
        
        // Update currency preview
        const currencySymbols = {
            'USD': '$',
            'CAD': 'C$',
            'EUR': 'â‚¬',
            'GBP': 'Â£'
        };
        document.getElementById('previewCurrency').textContent = `${currencySymbols[currency]}1,234.56`;
    },
    
    save() {
        // Collect all form values
        const formData = {
            companyName: document.getElementById('companyName').value,
            timezone: document.getElementById('timezone').value,
            dateFormat: document.getElementById('dateFormat').value,
            timeFormat: document.getElementById('timeFormat').value,
            currency: document.getElementById('currency').value,
            language: document.getElementById('language').value,
            theme: document.getElementById('theme').value,
            sidebarCollapsed: document.getElementById('sidebarCollapsed').checked,
            showWelcomeMessage: document.getElementById('showWelcomeMessage').checked,
            enableAnimations: document.getElementById('enableAnimations').checked
        };
        
        // Update settings
        Object.keys(formData).forEach(key => {
            Settings.updateSetting(key, formData[key]);
        });
        
        // Apply theme change immediately if needed
        if (formData.theme !== Settings.getSetting('theme')) {
            this.applyTheme(formData.theme);
        }
        
        UI.showAlert('General settings saved successfully!', 'success');
    },
    
    applyTheme(theme) {
        // Theme application logic would go here
        // For now, just store the preference
        document.documentElement.setAttribute('data-theme', theme);
    }
};id: tj-settings-business
name: T&J Settings Business
type: code.js
content: |-
// Business settings component for T&J Field Services
const SettingsBusiness = {
    render() {
        return `
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold">Business Information</h3>
                    <button onclick="SettingsBusiness.save()" class="btn-primary">
                        <i data-lucide="save" class="inline w-4 h-4 mr-2"></i>
                        Save Changes
                    </button>
                </div>
                
                <div class="space-y-8">
                    <!-- Basic Business Info -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Basic Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Business Name</label>
                                <input type="text" id="businessName" class="form-input" 
                                       placeholder="T&J Field Services">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Business Type</label>
                                <select id="businessType" class="form-select">
                                    <option value="contractor">General Contractor</option>
                                    <option value="remodeling">Remodeling Company</option>
                                    <option value="handyman">Handyman Services</option>
                                    <option value="specialty">Specialty Contractor</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Business Description</label>
                            <textarea id="businessDescription" rows="3" class="form-textarea" 
                                      placeholder="Professional remodeling, deck building, and handyman services in Delmar, Maryland"></textarea>
                        </div>
                    </div>
                    
                    <!-- Contact Information -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Contact Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Primary Phone</label>
                                <input type="tel" id="businessPhone" class="form-input" 
                                       placeholder="(555) 123-4567">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Secondary Phone</label>
                                <input type="tel" id="businessPhone2" class="form-input" 
                                       placeholder="(555) 123-4568">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Business Email</label>
                                <input type="email" id="businessEmail" class="form-input" 
                                       placeholder="info@tjfieldservices.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Website</label>
                                <input type="url" id="businessWebsite" class="form-input" 
                                       placeholder="https://www.tjfieldservices.com">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Address Information -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Business Address</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
                                <input type="text" id="businessStreet" class="form-input" 
                                       placeholder="123 Main Street">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                    <input type="text" id="businessCity" class="form-input" 
                                           placeholder="Delmar">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                                    <input type="text" id="businessState" class="form-input" 
                                           placeholder="Maryland">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                                    <input type="text" id="businessZip" class="form-input" 
                                           placeholder="21875">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Service Areas -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Service Areas</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Primary Service Radius (miles)</label>
                                <input type="number" id="serviceRadius" class="form-input" 
                                       placeholder="25" min="1" max="100">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Service Areas (one per line)</label>
                                <textarea id="serviceAreas" rows="4" class="form-textarea" 
                                          placeholder="Delmar, MD&#10;Salisbury, MD&#10;Ocean City, MD&#10;Berlin, MD"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Licensing & Insurance -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Licensing & Insurance</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">License Number</label>
                                <input type="text" id="licenseNumber" class="form-input" 
                                       placeholder="MD-CONTRACTOR-123456">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">License Expiration</label>
                                <input type="date" id="licenseExpiration" class="form-input">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Insurance Company</label>
                                <input type="text" id="insuranceCompany" class="form-input" 
                                       placeholder="ABC Insurance Co.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Policy Number</label>
                                <input type="text" id="insurancePolicy" class="form-input" 
                                       placeholder="POL-123456789">
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Insurance Coverage Amount</label>
                            <select id="insuranceCoverage" class="form-select">
                                <option value="500000">$500,000</option>
                                <option value="1000000">$1,000,000</option>
                                <option value="2000000">$2,000,000</option>
                                <option value="5000000">$5,000,000</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Business Hours -->
                    <div>
                        <h4 class="text-lg font-medium mb-4">Business Hours</h4>
                        <div class="space-y-3">
                            ${this.renderBusinessHours()}
                        </div>
                    </div>
                    
                    <!-- Social Media -->
// Business address component for T&J Field Services
const BusinessAddress = {
    render() {
        return `
            <!-- Address Information -->
            <div>
                <h4 class="text-lg font-medium mb-4">Business Address</h4>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Street Address</label>
                        <input type="text" id="businessStreet" class="form-input" 
                               placeholder="123 Main Street">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                            <input type="text" id="businessCity" class="form-input" 
                                   placeholder="Delmar">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                            <select id="businessState" class="form-select">
                                <option value="">Select State</option>
                                ${this.renderStateOptions()}
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                            <input type="text" id="businessZip" class="form-input" 
                                   placeholder="21875">
                        </div>
                    </div>
                </div>
                
                <!-- Mailing Address -->
                <div class="mt-6">
                    <div class="flex items-center justify-between mb-4">
                        <h5 class="text-md font-medium">Mailing Address</h5>
                        <label class="flex items-center">
                            <input type="checkbox" id="sameAsBusinessAddress" class="form-checkbox" 
                                   onchange="BusinessAddress.toggleMailingAddress()">
                            <span class="ml-2 text-sm">Same as business address</span>
                        </label>
                    </div>
                    
                    <div id="mailingAddressFields" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Mailing Street Address</label>
                            <input type="text" id="mailingStreet" class="form-input" 
                                   placeholder="P.O. Box 123">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">City</label>
                                <input type="text" id="mailingCity" class="form-input" 
                                       placeholder="Delmar">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">State</label>
                                <select id="mailingState" class="form-select">
                                    <option value="">Select State</option>
                                    ${this.renderStateOptions()}
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ZIP Code</label>
                                <input type="text" id="mailingZip" class="form-input" 
                                       placeholder="21875">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    renderStateOptions() {
        const states = [
            'AL', 'AK', 'AZ', 'AR', 'CA', 'CO', 'CT', 'DE', 'FL', 'GA',
            'HI', 'ID', 'IL', 'IN', 'IA', 'KS', 'KY', 'LA', 'ME', 'MD',
            'MA', 'MI', 'MN', 'MS', 'MO', 'MT', 'NE', 'NV', 'NH', 'NJ',
            'NM', 'NY', 'NC', 'ND', 'OH', 'OK', 'OR', 'PA', 'RI', 'SC',
            'SD', 'TN', 'TX', 'UT', 'VT', 'VA', 'WA', 'WV', 'WI', 'WY'
        ];
        
        return states.map(state => `<option value="${state}">${state}</option>`).join('');
    },
    
    toggleMailingAddress() {
        const sameAddress = document.getElementById('sameAsBusinessAddress').checked;
        const mailingFields = document.getElementById('mailingAddressFields');
        
        if (sameAddress) {
            mailingFields.style.display = 'none';
            // Copy business address to mailing address
            document.getElementById('mailingStreet').value = document.getElementById('businessStreet').value;
            document.getElementById('mailingCity').value = document.getElementById('businessCity').value;
            document.getElementById('mailingState').value = document.getElementById('businessState').value;
            document.getElementById('mailingZip').value = document.getElementById('businessZip').value;
        } else {
            mailingFields.style.display = 'block';
        }
    },
    
    load() {
        document.getElementById('businessStreet').value = Settings.getSetting('businessStreet', '');
        document.getElementById('businessCity').value = Settings.getSetting('businessCity', 'Delmar');
        document.getElementById('businessState').value = Settings.getSetting('businessState', 'MD');
        document.getElementById('businessZip').value = Settings.getSetting('businessZip', '21875');
        
        document.getElementById('mailingStreet').value = Settings.getSetting('mailingStreet', '');
        document.getElementById('mailingCity').value = Settings.getSetting('mailingCity', '');
        document.getElementById('mailingState').value = Settings.getSetting('mailingState', '');
        document.getElementById('mailingZip').value = Settings.getSetting('mailingZip', '');
        
        const sameAddress = Settings.getSetting('sameAsBusinessAddress', true);
        document.getElementById('sameAsBusinessAddress').checked = sameAddress;
        this.toggleMailingAddress();
    },
    
    collect() {
        return {
            businessStreet: document.getElementById('businessStreet').value,
            businessCity: document.getElementById('businessCity').value,
            businessState: document.getElementById('businessState').value,
            businessZip: document.getElementById('businessZip').value,
            mailingStreet: document.getElementById('mailingStreet').value,
            mailingCity: document.getElementById('mailingCity').value,
            mailingState: document.getElementById('mailingState').value,
            mailingZip: document.getElementById('mailingZip').value,
            sameAsBusinessAddress: document.getElementById('sameAsBusinessAddress').checked
        };
    }
};id: tj-business-license
name: T&J Business License Component
type: code.js
content: |-
// Business license component for T&J Field Services
const BusinessLicense = {
    render() {
        return `
            <!-- Licensing & Insurance -->
            <div>
                <h4 class="text-lg font-medium mb-4">Licensing & Insurance</h4>
                
                <!-- License Information -->
                <div class="mb-6">
                    <h5 class="text-md font-medium mb-3">License Information</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">License Number</label>
                            <input type="text" id="licenseNumber" class="form-input" 
                                   placeholder="MD-CONTRACTOR-123456">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">License Type</label>
                            <select id="licenseType" class="form-select">
                                <option value="general">General Contractor</option>
                                <option value="specialty">Specialty Contractor</option>
                                <option value="handyman">Handyman License</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">License Expiration</label>
                            <input type="date" id="licenseExpiration" class="form-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Issuing State</label>
                            <select id="licenseState" class="form-select">
                                <option value="MD">Maryland</option>
                                <option value="DE">Delaware</option>
                                <option value="VA">Virginia</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Insurance Information -->
                <div class="mb-6">
                    <h5 class="text-md font-medium mb-3">Insurance Information</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Insurance Company</label>
                            <input type="text" id="insuranceCompany" class="form-input" 
                                   placeholder="ABC Insurance Co.">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Policy Number</label>
                            <input type="text" id="insurancePolicy" class="form-input" 
                                   placeholder="POL-123456789">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Coverage Amount</label>
                            <select id="insuranceCoverage" class="form-select">
                                <option value="500000">$500,000</option>
                                <option value="1000000">$1,000,000</option>
                                <option value="2000000">$2,000,000</option>
                                <option value="5000000">$5,000,000</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Policy Expiration</label>
                            <input type="date" id="insuranceExpiration" class="form-input">
                        </div>
                    </div>
                </div>
                
                <!-- Bonding Information -->
                <div class="mb-6">
                    <h5 class="text-md font-medium mb-3">Bonding Information</h5>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="flex items-center">
                                <input type="checkbox" id="isBonded" class="form-checkbox">
                                <span class="ml-3">Business is bonded</span>
                            </label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bond Amount</label>
                            <input type="number" id="bondAmount" class="form-input" 
                                   placeholder="50000">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bonding Company</label>
                            <input type="text" id="bondingCompany" class="form-input" 
                                   placeholder="XYZ Bonding Co.">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bond Expiration</label>
                            <input type="date" id="bondExpiration" class="form-input">
                        </div>
                    </div>
                </div>
                
                <!-- Certifications -->
                <div>
                    <h5 class="text-md font-medium mb-3">Professional Certifications</h5>
                    <div class="space-y-3">
                        <div id="certificationsList">
                            <!-- Certifications will be loaded here -->
                        </div>
                        <button type="button" onclick="BusinessLicense.addCertification()" 
                                class="btn-secondary text-sm">
                            <i data-lucide="plus" class="inline w-4 h-4 mr-2"></i>
                            Add Certification
                        </button>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        document.getElementById('licenseNumber').value = Settings.getSetting('licenseNumber', '');
        document.getElementById('licenseType').value = Settings.getSetting('licenseType', 'general');
        document.getElementById('licenseExpiration').value = Settings.getSetting('licenseExpiration', '');
        document.getElementById('licenseState').value = Settings.getSetting('licenseState', 'MD');
        
        document.getElementById('insuranceCompany').value = Settings.getSetting('insuranceCompany', '');
        document.getElementById('insurancePolicy').value = Settings.getSetting('insurancePolicy', '');
        document.getElementById('insuranceCoverage').value = Settings.getSetting('insuranceCoverage', '1000000');
        document.getElementById('insuranceExpiration').value = Settings.getSetting('insuranceExpiration', '');
        
        document.getElementById('isBonded').checked = Settings.getSetting('isBonded', false);
        document.getElementById('bondAmount').value = Settings.getSetting('bondAmount', '');
        document.getElementById('bondingCompany').value = Settings.getSetting('bondingCompany', '');
        document.getElementById('bondExpiration').value = Settings.getSetting('bondExpiration', '');
        
        this.loadCertifications();
    },
    
    loadCertifications() {
        const certifications = Settings.getSetting('certifications', []);
        const container = document.getElementById('certificationsList');
        
        container.innerHTML = certifications.map((cert, index) => 
            this.renderCertification(cert, index)
        ).join('');
        
        if (certifications.length === 0) {
            this.addCertification();
        }
    },
    
    renderCertification(cert = {}, index) {
        return `
            <div class="certification-item grid grid-cols-1 md:grid-cols-4 gap-4 p-4 border rounded-lg">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Certification Name</label>
                    <input type="text" class="form-input text-sm" 
                           value="${cert.name || ''}" 
                           placeholder="e.g., OSHA 30-Hour">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Issuing Organization</label>
                    <input type="text" class="form-input text-sm" 
                           value="${cert.issuer || ''}" 
                           placeholder="e.g., OSHA">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Expiration Date</label>
                    <input type="date" class="form-input text-sm" 
                           value="${cert.expiration || ''}">
                </div>
                <div class="flex items-end">
                    <button type="button" onclick="BusinessLicense.removeCertification(this)" 
                            class="btn-secondary text-sm text-red-600 hover:text-red-800">
                        <i data-lucide="trash-2" class="inline w-4 h-4"></i>
                    </button>
                </div>
            </div>
        `;
    },
    
    addCertification() {
        const container = document.getElementById('certificationsList');
        const index = container.children.length;
        container.insertAdjacentHTML('beforeend', this.renderCertification({}, index));
        lucide.createIcons();
    },
    
    removeCertification(button) {
        button.closest('.certification-item').remove();
    },
    
    collect() {
        // Collect certifications
        const certifications = [];
        document.querySelectorAll('.certification-item').forEach(item => {
            const inputs = item.querySelectorAll('input');
            if (inputs[0].value.trim()) {
                certifications.push({
                    name: inputs[0].value,
                    issuer: inputs[1].value,
                    expiration: inputs[2].value
                });
            }
        });
        
        return {
            licenseNumber: document.getElementById('licenseNumber').value,
            licenseType: document.getElementById('licenseType').value,
            licenseExpiration: document.getElementById('licenseExpiration').value,
            licenseState: document.getElementById('licenseState').value,
            insuranceCompany: document.getElementById('insuranceCompany').value,
            insurancePolicy: document.getElementById('insurancePolicy').value,
            insuranceCoverage: document.getElementById('insuranceCoverage').value,
            insuranceExpiration: document.getElementById('insuranceExpiration').value,
            isBonded: document.getElementById('isBonded').checked,
            bondAmount: document.getElementById('bondAmount').value,
            bondingCompany: document.getElementById('
// Certification manager component for T&J Field Services
const CertificationManager = {
    render() {
        return `
            <!-- Certifications -->
            <div>
                <h5 class="text-md font-medium mb-3">Professional Certifications</h5>
                <div class="space-y-3">
                    <div id="certificationsList">
                        <!-- Certifications will be loaded here -->
                    </div>
                    <button type="button" onclick="CertificationManager.addCertification()" 
                            class="btn-secondary text-sm">
                        <i data-lucide="plus" class="inline w-4 h-4 mr-2"></i>
                        Add Certification
                    </button>
                </div>
            </div>
        `;
    },
    
    load() {
        const certifications = Settings.getSetting('certifications', []);
        this.renderCertifications(certifications);
        
        if (certifications.length === 0) {
            this.addCertification();
        }
    },
    
    renderCertifications(certifications) {
        const container = document.getElementById('certificationsList');
        container.innerHTML = certifications.map((cert, index) => 
            this.renderCertification(cert, index)
        ).join('');
        lucide.createIcons();
    },
    
    renderCertification(cert = {}, index) {
        return `
            <div class="certification-item border rounded-lg p-4">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Certification Name</label>
                        <input type="text" class="cert-name form-input text-sm" 
                               value="${cert.name || ''}" 
                               placeholder="e.g., OSHA 30-Hour">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Issuing Organization</label>
                        <input type="text" class="cert-issuer form-input text-sm" 
                               value="${cert.issuer || ''}" 
                               placeholder="e.g., OSHA">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Issue Date</label>
                        <input type="date" class="cert-issued form-input text-sm" 
                               value="${cert.issued || ''}">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Expiration Date</label>
                        <input type="date" class="cert-expiration form-input text-sm" 
                               value="${cert.expiration || ''}"
                               onchange="CertificationManager.checkCertExpiration(this)">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Certificate Number</label>
                        <input type="text" class="cert-number form-input text-sm" 
                               value="${cert.number || ''}" 
                               placeholder="Certificate ID">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
                        <select class="cert-status form-select text-sm">
                            <option value="active" ${cert.status === 'active' ? 'selected' : ''}>Active</option>
                            <option value="expired" ${cert.status === 'expired' ? 'selected' : ''}>Expired</option>
                            <option value="pending" ${cert.status === 'pending' ? 'selected' : ''}>Pending Renewal</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button type="button" onclick="CertificationManager.removeCertification(this)" 
                                class="btn-secondary text-sm text-red-600 hover:text-red-800 mr-2">
                            <i data-lucide="trash-2" class="inline w-4 h-4 mr-1"></i>
                            Remove
                        </button>
                        <button type="button" onclick="CertificationManager.duplicateCertification(this)" 
                                class="btn-secondary text-sm text-blue-600 hover:text-blue-800">
                            <i data-lucide="copy" class="inline w-4 h-4 mr-1"></i>
                            Duplicate
                        </button>
                    </div>
                </div>
                
                <!-- Expiration Alert -->
                <div class="cert-alert mt-3"></div>
            </div>
        `;
    },
    
    addCertification() {
        const container = document.getElementById('certificationsList');
        container.insertAdjacentHTML('beforeend', this.renderCertification());
        lucide.createIcons();
    },
    
    removeCertification(button) {
        if (confirm('Are you sure you want to remove this certification?')) {
            button.closest('.certification-item').remove();
        }
    },
    
    duplicateCertification(button) {
        const item = button.closest('.certification-item');
        const cert = this.getCertificationData(item);
        
        // Clear some fields for the duplicate
        cert.number = '';
        cert.issued = '';
        cert.expiration = '';
        cert.status = 'pending';
        
        const container = document.getElementById('certificationsList');
        container.insertAdjacentHTML('beforeend', this.renderCertification(cert));
        lucide.createIcons();
    },
    
    getCertificationData(item) {
        return {
            name: item.querySelector('.cert-name').value,
            issuer: item.querySelector('.cert-issuer').value,
            issued: item.querySelector('.cert-issued').value,
            expiration: item.querySelector('.cert-expiration').value,
            number: item.querySelector('.cert-number').value,
            status: item.querySelector('.cert-status').value
        };
    },
    
    checkCertExpiration(input) {
        const expirationDate = input.value;
        const alertDiv = input.closest('.certification-item').querySelector('.cert-alert');
        
        if (!expirationDate) {
            alertDiv.innerHTML = '';
            return;
        }
        
        const expDate = new Date(expirationDate);
        const today = new Date();
        const daysUntilExpiration = Math.ceil((expDate - today) / (1000 * 60 * 60 * 24));
        
        if (daysUntilExpiration < 0) {
            alertDiv.innerHTML = `
                <div class="bg-red-50 border border-red-200 rounded-md p-2">
                    <div class="flex">
                        <i data-lucide="alert-circle" class="w-4 h-4 text-red-400 mt-0.5"></i>
                        <div class="ml-2">
                            <p class="text-xs text-red-800">This certification has expired</p>
                        </div>
                    </div>
                </div>
            `;
            // Auto-update status to expired
            input.closest('.certification-item').querySelector('.cert-status').value = 'expired';
        } else if (daysUntilExpiration <= 90) {
            alertDiv.innerHTML = `
                <div class="bg-yellow-50 border border-yellow-200 rounded-md p-2">
                    <div class="flex">
                        <i data-lucide="alert-triangle" class="w-4 h-4 text-yellow-400 mt-0.5"></i>
                        <div class="ml-2">
                            <p class="text-xs text-yellow-800">Expires in ${daysUntilExpiration} days</p>
                        </div>
                    </div>
                </div>
            `;
            // Auto-update status to pending if not already expired
            const statusSelect = input.closest('.certification-item').querySelector('.cert-status');
            if (statusSelect.value !== 'expired') {
                statusSelect.value = 'pending';
            }
        } else {
            alertDiv.innerHTML = '';
            // Auto-update status to active if not manually set otherwise
            const statusSelect = input.closest('.certification-item').querySelector('.cert-status');
            if (statusSelect.value === 'pending' || statusSelect.value === 'expired') {
                statusSelect.value = 'active';
            }
        }
        
        lucide.createIcons();
    },
    
    collect() {
        const certifications = [];
        document.querySelectorAll('.certification-item').forEach(item => {
            const cert = this.getCertificationData(item);
            if (cert.name.trim()) {
                certifications.push(cert);
            }
        });
        
        return {
            certifications: certifications
        };
    }
};// Notification types component for T&J Field Services
const NotificationTypes = {
    render() {
        return `
            <!-- Notification Types -->
            <div>
                <h4 class="text-lg font-medium mb-4">What to be notified about</h4>
                <div class="space-y-6">
                    <!-- Project Notifications -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3 flex items-center">
                            <i data-lucide="briefcase" class="w-5 h-5 text-blue-500 mr-2"></i>
                            Project Updates
                        </h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyNewProjects" class="form-checkbox">
                                <span class="ml-3">New project assignments</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyProjectStatusChange" class="form-checkbox">
                                <span class="ml-3">Project status changes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyProjectDeadlines" class="form-checkbox">
                                <span class="ml-3">Upcoming deadlines</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyProjectCompletion" class="form-checkbox">
                                <span class="ml-3">Project completions</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyProjectOverdue" class="form-checkbox">
                                <span class="ml-3">Overdue projects</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyProjectBudget" class="form-checkbox">
                                <span class="ml-3">Budget alerts</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Customer Notifications -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3 flex items-center">
                            <i data-lucide="users" class="w-5 h-5 text-green-500 mr-2"></i>
                            Customer Activity
                        </h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyNewCustomers" class="form-checkbox">
                                <span class="ml-3">New customer registrations</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyCustomerMessages" class="form-checkbox">
                                <span class="ml-3">Customer messages</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyCustomerReviews" class="form-checkbox">
                                <span class="ml-3">Customer reviews</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyCustomerPayments" class="form-checkbox">
                                <span class="ml-3">Payment updates</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Schedule Notifications -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3 flex items-center">
                            <i data-lucide="calendar" class="w-5 h-5 text-purple-500 mr-2"></i>
                            Schedule & Appointments
                        </h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyScheduleChanges" class="form-checkbox">
                                <span class="ml-3">Schedule changes</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyUpcomingAppointments" class="form-checkbox">
                                <span class="ml-3">Upcoming appointments</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyMissedAppointments" class="form-checkbox">
                                <span class="ml-3">Missed appointments</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyScheduleConflicts" class="form-checkbox">
                                <span class="ml-3">Schedule conflicts</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- System Notifications -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3 flex items-center">
                            <i data-lucide="settings" class="w-5 h-5 text-orange-500 mr-2"></i>
                            System & Security
                        </h5>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <label class="flex items-center">
                                <input type="checkbox" id="notifySystemUpdates" class="form-checkbox">
                                <span class="ml-3">System updates</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifySecurityAlerts" class="form-checkbox">
                                <span class="ml-3">Security alerts</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyBackupStatus" class="form-checkbox">
                                <span class="ml-3">Backup status</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notifyMaintenanceMode" class="form-checkbox">
                                <span class="ml-3">Maintenance notifications</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        // Project notifications
        document.getElementById('notifyNewProjects').checked = Settings.getSetting('notifyNewProjects', true);
        document.getElementById('notifyProjectStatusChange').checked = Settings.getSetting('notifyProjectStatusChange', true);
        document.getElementById('notifyProjectDeadlines').checked = Settings.getSetting('notifyProjectDeadlines', true);
        document.getElementById('notifyProjectCompletion').checked = Settings.getSetting('notifyProjectCompletion', true);
        document.getElementById('notifyProjectOverdue').checked = Settings.getSetting('notifyProjectOverdue', true);
        document.getElementById('notifyProjectBudget').checked = Settings.getSetting('notifyProjectBudget', false);
        
        // Customer notifications
        document.getElementById('notifyNewCustomers').checked = Settings.getSetting('notifyNewCustomers', true);
        document.getElementById('notifyCustomerMessages').checked = Settings.getSetting('notifyCustomerMessages', true);
        document.getElementById('notifyCustomerReviews').checked = Settings.getSetting('notifyCustomerReviews', true);
        document.getElementById('notifyCustomerPayments').checked = Settings.getSetting('notifyCustomerPayments', true);
        
        // Schedule notifications
        document.getElementById('notifyScheduleChanges').checked = Settings.getSetting('notifyScheduleChanges', true);
        document.getElementById('notifyUpcomingAppointments').checked = Settings.getSetting('notifyUpcomingAppointments', true);
        document.getElementById('notifyMissedAppointments').checked = Settings.getSetting('notifyMissedAppointments', true);
        document.getElementById('notifyScheduleConflicts').checked = Settings.getSetting('notifyScheduleConflicts', true);
        
        // System notifications
        document.getElementById('notifySystemUpdates').checked = Settings.getSetting('notifySystemUpdates', false);
        document.getElementById('notifySecurityAlerts').checked = Settings.getSetting('notifySecurityAlerts', true);
        document.getElementById('notifyBackupStatus').checked = Settings.getSetting('notifyBackupStatus', false);
        document.getElementById('notifyMaintenanceMode').checked = Settings.getSetting('notifyMaintenanceMode', true);
    },
    
    collect() {
        return {
            // Project notifications
            notifyNewProjects: document.getElementById('notifyNewProjects').checked,
            notifyProjectStatusChange: document.getElementById('notifyProjectStatusChange').checked,
            notifyProjectDeadlines: document.getElementById('notifyProjectDeadlines').checked,
            notifyProjectCompletion: document.getElementById('notifyProjectCompletion').checked,
            notifyProjectOverdue: document.getElementById('notifyProjectOverdue').checked,
            notifyProjectBudget: document.getElementById('notifyProjectBudget').checked,
            
            // Customer notifications
            notifyNewCustomers: document.getElementById('notifyNewCustomers').checked,
            notifyCustomerMessages: document.getElementById('notifyCustomerMessages').checked,
            notifyCustomerReviews: document.getElementById('notifyCustomerReviews').checked,
            notifyCustomerPayments: document.getElementById('notifyCustomerPayments').checked,
            
            // Schedule notifications
            notifyScheduleChanges: document.getElementById('notifyScheduleChanges').checked,
            notifyUpcomingAppointments: document.getElementById('notifyUpcomingAppointments').checked,
            notifyMissedAppointments: document.getElementById('notifyMissedAppointments').checked,
            notifyScheduleConflicts: document.getElementById('notifyScheduleConflicts').checked,
            
            // System notifications
            notifySystemUpdates: document.getElementById('notifySystemUpdates').checked,
            notifySecurityAlerts: document.getElementById('notifySecurityAlerts').checked,
            notifyBackupStatus: document.getElementById('notifyBackupStatus').checked,
            notifyMaintenanceMode: document.getElementById('notifyMaintenanceMode').checked
        };
    }
};id: tj-notification-schedule
name: T&J Notification Schedule
type: code.js
content: |-
// Notification schedule component for T&J Field Services
const NotificationSchedule = {
    render() {
        return `
            <!-- Notification Schedule -->
            <div>
                <h4 class="text-lg font-medium mb-4">Notification Schedule</h4>
                <div class="space-y-6">
                    <!-- Quiet Hours -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h5 class="font-medium">Quiet Hours</h5>
                                <p class="text-sm text-gray-500">Don't send notifications during these hours</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="enableQuietHours" class="sr-only peer">
                                <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                            </label>
                        </div>
                        
                        <div id="quietHoursSettings" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                                <input type="time" id="quietHoursStart" class="form-input" value="22:00">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                                <input type="time" id="quietHoursEnd" class="form-input" value="08:00">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Weekend Settings -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Weekend Notifications</h5>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="weekendNotifications" class="form-checkbox">
                                <span class="ml-3">Send notifications on weekends</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="urgentOnlyWeekends" class="form-checkbox">
                                <span class="ml-3">Only urgent notifications on weekends</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Frequency Settings -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Notification Frequency</h5>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email Digest Frequency</label>
                                <select id="emailDigestFrequency" class="form-select">
                                    <option value="immediate">Immediate (as they happen)</option>
                                    <option value="hourly">Hourly digest</option>
                                    <option value="daily">Daily digest</option>
                                    <option value="weekly">Weekly digest</option>
                                    <option value="never">Never send digest</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">SMS Frequency Limit</label>
                                <select id="smsFrequencyLimit" class="form-select">
                                    <option value="unlimited">No limit</option>
                                    <option value="5">Maximum 5 per hour</option>
                                    <option value="10">Maximum 10 per hour</option>
                                    <option value="urgent">Urgent only</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Daily Digest Time</label>
                                <input type="time" id="dailyDigestTime" class="form-input" value="08:00">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Reminder Settings -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Reminder Settings</h5>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Appointment Reminders</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="reminder24h" class="form-checkbox">
                                        <span class="ml-3">24 hours before</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="reminder2h" class="form-checkbox">
                                        <span class="ml-3">2 hours before</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="reminder30m" class="form-checkbox">
                                        <span class="ml-3">30 minutes before</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Project Deadline Reminders</label>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" id="deadlineReminder7d" class="form-checkbox">
                                        <span class="ml-3">7 days before deadline</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="deadlineReminder3d" class="form-checkbox">
                                        <span class="ml-3">3 days before deadline</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" id="deadlineReminder1d" class="form-checkbox">
                                        <span class="ml-3">1 day before deadline</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        document.getElementById('enableQuietHours').checked = Settings.getSetting('enableQuietHours', true);
        document.getElementById('quietHoursStart').value = Settings.getSetting('quietHoursStart', '22:00');
        document.getElementById('quietHoursEnd').value = Settings.getSetting('quietHoursEnd', '08:00');
        
        document.getElementById('weekendNotifications').checked = Settings.getSetting('weekendNotifications', false);
        document.getElementById('urgentOnlyWeekends').checked = Settings.getSetting('urgentOnlyWeekends', true);
        
        document.getElementById('emailDigestFrequency').value = Settings.getSetting('emailDigestFrequency', 'daily');
        document.getElementById('smsFrequencyLimit').value = Settings.getSetting('smsFrequencyLimit', '10');
        document.getElementById('dailyDigestTime').value = Settings.getSetting('dailyDigestTime', '08:00');
        
        // Appointment reminders
        document.getElementById('reminder24h').checked = Settings.getSetting('reminder24h', true);
        document.getElementById('reminder2h').checked = Settings.getSetting('reminder2h', true);
        document.getElementById('reminder30m').checked = Settings.getSetting('reminder30m', false);
        
        // Deadline reminders
        document.getElementById('deadlineReminder7d').checked = Settings.getSetting('deadlineReminder7d', true);
        document.getElementById('deadlineReminder3d').checked = Settings.getSetting('deadlineReminder3d', true);
        document.getElementById('deadlineReminder1d').checked = Settings.getSetting('deadlineReminder1d', true);
        
        // Add event listener for quiet hours toggle
        document.getElementById('enableQuietHours').addEventListener('change', this.toggleQuietHours);
        this.toggleQuietHours();
    },
    
    toggleQuietHours() {
        const enabled = document.getElementById('enableQu// Reminder settings component for T&J Field Services
const ReminderSettings = {
    render() {
        return `
            <!-- Reminder Settings -->
            <div class="border rounded-lg p-4">
                <h5 class="font-medium mb-3">Reminder Settings</h5>
                <div class="space-y-6">
                    <!-- Appointment Reminders -->
                    <div>
                        <h6 class="text-sm font-medium text-gray-700 mb-3">Appointment Reminders</h6>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <span class="flex items-center">
                                    <input type="checkbox" id="reminder24h" class="form-checkbox">
                                    <span class="ml-3">24 hours before</span>
                                </span>
                                <select id="reminder24hMethod" class="form-select text-sm w-32">
                                    <option value="email">Email</option>
                                    <option value="sms">SMS</option>
                                    <option value="both">Both</option>
                                </select>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="flex items-center">
                                    <input type="checkbox" id="reminder2h" class="form-checkbox">
                                    <span class="ml-3">2 hours before</span>
                                </span>
                                <select id="reminder2hMethod" class="form-select text-sm w-32">
                                    <option value="email">Email</option>
                                    <option value="sms">SMS</option>
                                    <option value="both">Both</option>
                                </select>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="flex items-center">
                                    <input type="checkbox" id="reminder30m" class="form-checkbox">
                                    <span class="ml-3">30 minutes before</span>
                                </span>
                                <select id="reminder30mMethod" class="form-select text-sm w-32">
                                    <option value="email">Email</option>
                                    <option value="sms">SMS</option>
                                    <option value="both">Both</option>
                                </select>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Project Deadline Reminders -->
                    <div>
                        <h6 class="text-sm font-medium text-gray-700 mb-3">Project Deadline Reminders</h6>
                        <div class="space-y-2">
                            <label class="flex items-center justify-between">
                                <span class="flex items-center">
                                    <input type="checkbox" id="deadlineReminder7d" class="form-checkbox">
                                    <span class="ml-3">7 days before deadline</span>
                                </span>
                                <select id="deadlineReminder7dMethod" class="form-select text-sm w-32">
                                    <option value="email">Email</option>
                                    <option value="sms">SMS</option>
                                    <option value="both">Both</option>
                                </select>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="flex items-center">
                                    <input type="checkbox" id="deadlineReminder3d" class="form-checkbox">
                                    <span class="ml-3">3 days before deadline</span>
                                </span>
                                <select id="deadlineReminder3dMethod" class="form-select text-sm w-32">
                                    <option value="email">Email</option>
                                    <option value="sms">SMS</option>
                                    <option value="both">Both</option>
                                </select>
                            </label>
                            <label class="flex items-center justify-between">
                                <span class="flex items-center">
                                    <input type="checkbox" id="deadlineReminder1d" class="form-checkbox">
                                    <span class="ml-3">1 day before deadline</span>
                                </span>
                                <select id="deadlineReminder1dMethod" class="form-select text-sm w-32">
                                    <option value="email">Email</option>
                                    <option value="sms">SMS</option>
                                    <option value="both">Both</option>
                                </select>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Follow-up Reminders -->
                    <div>
                        <h6 class="text-sm font-medium text-gray-700 mb-3">Follow-up Reminders</h6>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="followUpReminders" class="form-checkbox">
                                <span class="ml-3">Enable automatic follow-up reminders</span>
                            </label>
                            
                            <div id="followUpSettings" class="ml-6 space-y-2">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Follow up after project completion</label>
                                    <select id="followUpDelay" class="form-select text-sm">
                                        <option value="1">1 day</option>
                                        <option value="3">3 days</option>
                                        <option value="7">1 week</option>
                                        <option value="14">2 weeks</option>
                                        <option value="30">1 month</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Follow-up method</label>
                                    <select id="followUpMethod" class="form-select text-sm">
                                        <option value="email">Email only</option>
                                        <option value="sms">SMS only</option>
                                        <option value="both">Email and SMS</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        // Appointment reminders
        document.getElementById('reminder24h').checked = Settings.getSetting('reminder24h', true);
        document.getElementById('reminder24hMethod').value = Settings.getSetting('reminder24hMethod', 'email');
        document.getElementById('reminder2h').checked = Settings.getSetting('reminder2h', true);
        document.getElementById('reminder2hMethod').value = Settings.getSetting('reminder2hMethod', 'both');
        document.getElementById('reminder30m').checked = Settings.getSetting('reminder30m', false);
        document.getElementById('reminder30mMethod').value = Settings.getSetting('reminder30mMethod', 'sms');
        
        // Deadline reminders
        document.getElementById('deadlineReminder7d').checked = Settings.getSetting('deadlineReminder7d', true);
        document.getElementById('deadlineReminder7dMethod').value = Settings.getSetting('deadlineReminder7dMethod', 'email');
        document.getElementById('deadlineReminder3d').checked = Settings.getSetting('deadlineReminder3d', true);
        document.getElementById('deadlineReminder3dMethod').value = Settings.getSetting('deadlineReminder3dMethod', 'both');
        document.getElementById('deadlineReminder1d').checked = Settings.getSetting('deadlineReminder1d', true);
        document.getElementById('deadlineReminder1dMethod').value = Settings.getSetting('deadlineReminder1dMethod', 'both');
        
        // Follow-up reminders
        document.getElementById('followUpReminders').checked = Settings.getSetting('followUpReminders', true);
        document.getElementById('followUpDelay').value = Settings.getSetting('followUpDelay', '7');
        document.getElementById('followUpMethod').value = Settings.getSetting('followUpMethod', 'email');
        
        // Add event listener for follow-up toggle
        document.getElementById('followUpReminders').addEventListener('change', this.toggleFollowUpSettings);
        this.toggleFollowUpSettings();
    },
    
    toggleFollowUpSettings() {
        const enabled = document.getElementById('followUpReminders').checked;
        const settings = document.getElementById('followUpSettings');
        settings.style.opacity = enabled ? '1' : '0.5';
        settings.querySelectorAll('select').forEach(el => {
            el.disabled = !enabled;
        });
    },
    
    collect() {
        return {
            // Appointment reminders
            reminder24h: document.getElementById('reminder24h').checked,
            reminder24hMethod: document.getElementById('reminder24hMethod').value,
            reminder2h: document.getElementById('reminder2h').checked,
            reminder2hMethod: document.getElementById('reminder2hMethod').value,
            reminder30m: document.getElementById('reminder30m').checked,
            reminder30mMethod: document.getElementById('reminder30mMethod').value,
            
            // Deadline reminders
            deadlineReminder7d: document.getElementById('deadlineReminder7d').checked,
            deadlineReminder7dMethod: document.getElementById('deadlineReminder7dMethod').value,
            deadlineReminder3d: document.getElementById('deadlineReminder3d').checked,
            deadlineReminder3dMethod: document.getElementById('deadlineReminder3dMethod').value,
            deadlineReminder1d: document.getElementById('deadlineReminder1d').checked,
            deadlineReminder1dMethod: document.getElementById('deadlineReminder1dMethod').value,
            
            // Follow-up reminders
            followUpReminders: document.getElementById('followUpReminders').checked,
            followUpDelay: document.getElementById('followUpDelay').value,
            followUpMethod: document.getElementById('followUpMethod').value
        };
    }
};
// Two-factor authentication component for T&J Field Services
const TwoFactorAuth = {
    render() {
        return `
            <!-- Two-Factor Authentication -->
            <div>
                <h4 class="text-lg font-medium mb-4">Two-Factor Authentication</h4>
                <div class="space-y-6">
                    <!-- 2FA Status -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <div>
                                <h5 class="font-medium">Two-Factor Authentication Status</h5>
                                <p class="text-sm text-gray-500">Add an extra layer of security to your account</p>
                            </div>
                            <div id="twoFactorStatus" class="flex items-center">
                                <!-- Status will be loaded here -->
                            </div>
                        </div>
                        
                        <div id="twoFactorSetup" class="space-y-4">
                            <!-- Setup content will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- 2FA Methods -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Authentication Methods</h5>
                        <div class="space-y-4">
                            <!-- SMS Authentication -->
                            <div class="flex items-center justify-between p-3 border rounded-lg">
                                <div class="flex items-center">
                                    <i data-lucide="smartphone" class="w-5 h-5 text-green-500 mr-3"></i>
                                    <div>
                                        <h6 class="font-medium">SMS Authentication</h6>
                                        <p class="text-sm text-gray-500">Receive codes via text message</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span id="smsStatus" class="text-sm text-gray-500">Not configured</span>
                                    <button onclick="TwoFactorAuth.configureSMS()" class="btn-secondary text-sm">
                                        Configure
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Authenticator App -->
                            <div class="flex items-center justify-between p-3 border rounded-lg">
                                <div class="flex items-center">
                                    <i data-lucide="shield" class="w-5 h-5 text-blue-500 mr-3"></i>
                                    <div>
                                        <h6 class="font-medium">Authenticator App</h6>
                                        <p class="text-sm text-gray-500">Use Google Authenticator or similar apps</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span id="appStatus" class="text-sm text-gray-500">Not configured</span>
                                    <button onclick="TwoFactorAuth.configureApp()" class="btn-secondary text-sm">
                                        Configure
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Email Authentication -->
                            <div class="flex items-center justify-between p-3 border rounded-lg">
                                <div class="flex items-center">
                                    <i data-lucide="mail" class="w-5 h-5 text-purple-500 mr-3"></i>
                                    <div>
                                        <h6 class="font-medium">Email Authentication</h6>
                                        <p class="text-sm text-gray-500">Receive codes via email</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span id="emailAuthStatus" class="text-sm text-gray-500">Not configured</span>
                                    <button onclick="TwoFactorAuth.configureEmail()" class="btn-secondary text-sm">
                                        Configure
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backup Codes -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Backup Recovery Codes</h5>
                        <p class="text-sm text-gray-500 mb-4">
                            Generate backup codes that can be used if you lose access to your 2FA device
                        </p>
                        <div class="flex items-center space-x-4">
                            <button onclick="TwoFactorAuth.generateBackupCodes()" class="btn-secondary">
                                <i data-lucide="key" class="inline w-4 h-4 mr-2"></i>
                                Generate Backup Codes
                            </button>
                            <button onclick="TwoFactorAuth.viewBackupCodes()" class="btn-secondary">
                                <i data-lucide="eye" class="inline w-4 h-4 mr-2"></i>
                                View Existing Codes
                            </button>
                        </div>
                        <div id="backupCodesDisplay" class="mt-4"></div>
                    </div>
                    
                    <!-- 2FA Settings -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">2FA Preferences</h5>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="require2FALogin" class="form-checkbox">
                                <span class="ml-3">Require 2FA for all logins</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="require2FAAdmin" class="form-checkbox">
                                <span class="ml-3">Require 2FA for administrative actions</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="remember2FADevice" class="form-checkbox">
                                <span class="ml-3">Remember this device for 30 days</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="notify2FAChanges" class="form-checkbox">
                                <span class="ml-3">Notify me of 2FA configuration changes</span>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        const is2FAEnabled = Settings.getSetting('twoFactorEnabled', false);
        this.updateStatus(is2FAEnabled);
        
        document.getElementById('require2FALogin').checked = Settings.getSetting('require2FALogin', false);
        document.getElementById('require2FAAdmin').checked = Settings.getSetting('require2FAAdmin', true);
        document.getElementById('remember2FADevice').checked = Settings.getSetting('remember2FADevice', false);
        document.getElementById('notify2FAChanges').checked = Settings.getSetting('notify2FAChanges', true);
        
        // Load method statuses
        this.updateMethodStatus('sms', Settings.getSetting('smsAuthEnabled', false));
        this.updateMethodStatus('app', Settings.getSetting('appAuthEnabled', false));
        this.updateMethodStatus('email', Settings.getSetting('emailAuthEnabled', false));
    },
    
    updateStatus(enabled) {
        const statusDiv = document.getElementById('twoFactorStatus');
        const setupDiv = document.getElementById('twoFactorSetup');
        
        if (enabled) {
            statusDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                        <i data-lucide="check" class="w-3 h-3 mr-1"></i>
                        Enabled
                    </span>
                    <button onclick="TwoFactorAuth.disable2FA()" class="ml-3 btn-secondary text-sm">
                        Disable 2FA
                    </button>
                </div>
            `;
            setupDiv.innerHTML = `
                <div class="bg-green-50 border border-green-200 rounded-md p-3">
                    <div class="flex">
                        <i data-lucide="shield-check" class="w-5 h-5 text-green-400"></i>
                        <div class="ml-3">
                            <p class="text-sm text-green-800">
                                Two-factor authentication is active and protecting your account.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        } else {
            statusDiv.innerHTML = `
                <div class="flex items-center">
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                        <i data-lucide="x" class="w-3 h-3 mr-1"></i>
                        Disabled
                    </span>
                    <button onclick="TwoFactorAuth.enable2FA()" class="ml-3 btn-primary text-sm">
                        Enable 2FA
                    </button>
                </div>
            `;
            setupDiv.innerHTML = `
                <div class="bg-yellow-50 border border-yellow-200 rounded-md p-3">
                    <div class="flex">
                        <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-400"></i>
                        <div class="ml-3">
                            <p class="text-sm text-yellow-800">
                                Your account is not protected by two-factor authentication. Enable it now for better security.
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        lucide.createIcons();
    },
    
    updateMethodStatus(method, enabled) {
        const statusSpan = document.getElementById(`${method}Status`) || document.getElementById(`${method}AuthStatus`);
        if (statusSpan) {
            statusSpan.textContent = enabled ? 'Configured' : 'Not configured';
            statusSpan.className = enabled ? 'text-sm text-green-600' : 'text-sm text-gray-500';
        }
    },
    
    enable2FA() {
        UI.showAlert('2FA setup wizard would open here', 'info');
        Settings.updateSetting('twoFactorEnabled', true);
        this.updateStatus(true);
    },
    
    disable2FA() {
        if (confirm('Are you sure you want to disable two-factor authentication? This will make your account less secure.')) {
            Settings.updateSetting('twoFactorEnabled', false);
            this.updateStatus(false);
            UI.showAlert('Two-factor authentication disabled', 'warning');
        }
    },
    
    configureSMS() {
        UI.showAlert('SMS 2FA configuration would open here', 'info');
    },
    
    configureApp() {
        UI.showAlert('Authenticator app setup would open here', 'info');
    },
    
    configureEmail() {
        UI.showAlert('Email 2FA configuration would open here', 'info');
    },
    
    generateBackupCodes() {
        const codes = [];
        for (let i = 0; i < 10; i++) {
            codes.push(Math.random().toString(36).substr(2, 8).toUpperCase());
        }
        
        const display = document.getElementById('backupCodesDisplay');
        display.innerHTML = `
            <div class="bg-gray-50 border rounded-lg p-4">
                <h6 class="font-medium mb-2">Your Backup Codes</h6>
                <p class="text-sm text-gray-600 mb-3">Save these codes in a secure location. Each can only be used once.</p>
                <div class="grid grid-cols-2 gap-2 font-mono text-sm">
                    ${codes.map(code => `<div class="bg-white p-2 rounded border">${code}</div>`).join('')}
                </div>
                <div class="mt-3 flex space-x-2">
                    <button onclick="TwoFactorAuth.downloadCodes('${codes.join(',')}')" class="btn-secondary text-sm">
                        Download
                    </button>
                    <button onclick="TwoFactorAuth.printCodes()" class="btn-secondary text-sm">
                        Print
                    </button>
                </div>
            </div>
        `;
    },
    
    viewBackupCodes() {
        UI.showAlert('Existing backup codes would be displayed here', 'info');
    },
    
    downloadCodes(codes) {
        const blob = new Blob([`T&J Field Services Backup Codes\n\n${codes.split(',').join('\n')}`], 
                             { type: 'text/plain' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'tj-backup-codes.txt';
        a.click();
        window.URL.revokeObjectURL(url);
    },
    
    printCodes() {
        window.print();
    },
    
    collect() {
        return {
            twoFactorEnabled: Settings.getSetting('twoFactorEnabled', false),
            require2FALogin: document.getElementById('require2FALogin').checked,
            require2FAAdmin: document.getElementById('require2FAAdmin').checked,
            remember2FADevice: document.getElementById('remember2FADevice').checked,
            notify2FAChanges: document.getElementById('notify2FAChanges').checked
        };
    }
};id: tj-session-management
name: T&J Session Management Component
type: code.js
content: |-
// Session management component for T&J Field Services
const SessionManagement = {
    render() {
        return `
            <!-- Session Management -->
            <div>
                <h4 class="text-lg font-medium mb-4">Session Management</h4>
                <div class="space-y-6">
                    <!-- Active Sessions -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="font-medium">Active Sessions</h5>
                            <button onclick="SessionManagement.refreshSessions()" class="btn-secondary text-sm">
                                <i data-lucide="refresh-cw" class="inline w-4 h-4 mr-2"></i>
                                Refresh
                            </button>
                        </div>
                        <div id="activeSessions" class="space-y-3">
                            <!-- Sessions will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Session Settings -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Session Settings</h5>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Session Timeout</label>
                                <select id="sessionTimeout" class="form-select">
                                    <option value="15">15 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="60">1 hour</option>
                                    <option value="240">4 hours</option>
                                    <option value="480">8 hours</option>
                                    <option value="never">Never timeout</option>
                                </select>
                                <p class="text-xs text-gray-500 mt-1">Automatically log out after period of inactivity</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Maximum Concurrent Sessions</label>
                                <select id="maxSessions" class="form-select">
                                    <option value="1">1 session</option>
                                    <option value="3">3 sessions</option>
                                    <option value="5">5 sessions</option>
                                    <option value="10">10 sessions</option>
                                    <option value="unlimited">Unlimited</option>
                                </select>
                            </div>
                            
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="rememberMe" class="form-checkbox">
                                    <span class="ml-3">Allow "Remember Me" option</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="logoutOnClose" class="form-checkbox">
                                    <span class="ml-3">Logout when browser closes</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="notifyNewLogin" class="form-checkbox">
                                    <span class="ml-3">Notify me of new login attempts</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="requireReauth" class="form-checkbox">
                                    <span class="ml-3">Require re-authentication for
// Login history component for T&J Field Services
const LoginHistory = {
    render() {
        return `
            <!-- Login History -->
            <div class="border rounded-lg p-4">
                <div class="flex items-center justify-between mb-4">
                    <h5 class="font-medium">Recent Login Activity</h5>
                    <div class="flex space-x-2">
                        <select id="historyFilter" class="form-select text-sm" onchange="LoginHistory.filterHistory()">
                            <option value="all">All Activity</option>
                            <option value="successful">Successful Logins</option>
                            <option value="failed">Failed Attempts</option>
                            <option value="suspicious">Suspicious Activity</option>
                        </select>
                        <button onclick="LoginHistory.exportHistory()" class="btn-secondary text-sm">
                            <i data-lucide="download" class="inline w-4 h-4 mr-2"></i>
                            Export
                        </button>
                    </div>
                </div>
                
                <div id="loginHistory" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- History will be loaded here -->
                </div>
                
                <div class="mt-4 flex items-center justify-between text-sm text-gray-500">
                    <span>Showing last 50 entries</span>
                    <button onclick="LoginHistory.loadMore()" class="text-blue-600 hover:text-blue-800">
                        Load more
                    </button>
                </div>
            </div>
        `;
    },
    
    load() {
        this.loadHistory();
    },
    
    loadHistory() {
        // Simulate login history data
        const history = [
            {
                timestamp: '2024-01-15 09:30:15',
                status: 'successful',
                device: 'Chrome on Windows',
                location: 'Delmar, MD',
                ip: '192.168.1.100',
                method: '2FA'
            },
            {
                timestamp: '2024-01-15 08:45:22',
                status: 'successful',
                device: 'Safari on iPhone',
                location: 'Delmar, MD',
                ip: '192.168.1.101',
                method: 'Password'
            },
            {
                timestamp: '2024-01-14 16:20:33',
                status: 'failed',
                device: 'Chrome on Windows',
                location: 'Unknown',
                ip: '203.0.113.45',
                method: 'Password',
                reason: 'Invalid password'
            },
            {
                timestamp: '2024-01-14 14:15:10',
                status: 'successful',
                device: 'Chrome on Android',
                location: 'Salisbury, MD',
                ip: '10.0.0.50',
                method: '2FA'
            },
            {
                timestamp: '2024-01-14 09:00:05',
                status: 'suspicious',
                device: 'Unknown Browser',
                location: 'New York, NY',
                ip: '198.51.100.25',
                method: 'Password',
                reason: 'Unusual location'
            }
        ];
        
        this.renderHistory(history);
    },
    
    renderHistory(history) {
        const container = document.getElementById('loginHistory');
        container.innerHTML = history.map(entry => `
            <div class="flex items-center justify-between p-3 border rounded-lg ${this.getStatusColor(entry.status)}">
                <div class="flex items-center">
                    <div class="w-8 h-8 rounded-full ${this.getStatusBg(entry.status)} flex items-center justify-center mr-3">
                        <i data-lucide="${this.getStatusIcon(entry.status)}" class="w-4 h-4 ${this.getStatusIconColor(entry.status)}"></i>
                    </div>
                    <div>
                        <div class="flex items-center space-x-2">
                            <span class="text-sm font-medium">${entry.device}</span>
                            <span class="px-2 py-0.5 text-xs rounded-full ${this.getMethodBadge(entry.method)}">${entry.method}</span>
                        </div>
                        <p class="text-xs text-gray-500">${entry.location} â€¢ ${entry.ip}</p>
                        <p class="text-xs text-gray-400">${entry.timestamp}</p>
                        ${entry.reason ? `<p class="text-xs text-red-600">${entry.reason}</p>` : ''}
                    </div>
                </div>
                <div class="text-right">
                    <span class="text-xs px-2 py-1 rounded-full ${this.getStatusBadge(entry.status)}">
                        ${entry.status.charAt(0).toUpperCase() + entry.status.slice(1)}
                    </span>
                    ${entry.status === 'suspicious' ? `
                        <div class="mt-1">
                            <button onclick="LoginHistory.blockIP('${entry.ip}')" class="text-xs text-red-600 hover:text-red-800">
                                Block IP
                            </button>
                        </div>
                    ` : ''}
                </div>
            </div>
        `).join('');
        
        lucide.createIcons();
    },
    
    getStatusColor(status) {
        switch (status) {
            case 'successful': return 'bg-green-50 border-green-200';
            case 'failed': return 'bg-red-50 border-red-200';
            case 'suspicious': return 'bg-yellow-50 border-yellow-200';
            default: return 'bg-gray-50 border-gray-200';
        }
    },
    
    getStatusBg(status) {
        switch (status) {
            case 'successful': return 'bg-green-100';
            case 'failed': return 'bg-red-100';
            case 'suspicious': return 'bg-yellow-100';
            default: return 'bg-gray-100';
        }
    },
    
    getStatusIcon(status) {
        switch (status) {
            case 'successful': return 'check';
            case 'failed': return 'x';
            case 'suspicious': return 'alert-triangle';
            default: return 'info';
        }
    },
    
    getStatusIconColor(status) {
        switch (status) {
            case 'successful': return 'text-green-600';
            case 'failed': return 'text-red-600';
            case 'suspicious': return 'text-yellow-600';
            default: return 'text-gray-600';
        }
    },
    
    getStatusBadge(status) {
        switch (status) {
            case 'successful': return 'bg-green-100 text-green-800';
            case 'failed': return 'bg-red-100 text-red-800';
            case 'suspicious': return 'bg-yellow-100 text-yellow-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    },
    
    getMethodBadge(method) {
        switch (method) {
            case '2FA': return 'bg-blue-100 text-blue-800';
            case 'Password': return 'bg-gray-100 text-gray-800';
            default: return 'bg-gray-100 text-gray-800';
        }
    },
    
    filterHistory() {
        const filter = document.getElementById('historyFilter').value;
        UI.showAlert(`Filtering by: ${filter}`, 'info');
        // In a real app, this would filter the displayed history
    },
    
    exportHistory() {
        UI.showAlert('Login history exported to CSV', 'success');
    },
    
    loadMore() {
        UI.showAlert('Loading more history entries...', 'info');
    },
    
    blockIP(ip) {
        if (confirm(`Are you sure you want to block IP address ${ip}?`)) {
            UI.showAlert(`IP address ${ip} has been blocked`, 'success');
        }
    }
};// Security audit component for T&J Field Services
const SecurityAudit = {
    render() {
        return `
            <!-- Security Audit -->
            <div>
                <h4 class="text-lg font-medium mb-4">Security Audit & Monitoring</h4>
                <div class="space-y-6">
                    <!-- Security Score -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="font-medium">Security Score</h5>
                            <button onclick="SecurityAudit.runSecurityScan()" class="btn-secondary text-sm">
                                <i data-lucide="shield-check" class="inline w-4 h-4 mr-2"></i>
                                Run Security Scan
                            </button>
                        </div>
                        
                        <div id="securityScore" class="space-y-4">
                            <!-- Score will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Security Recommendations -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Security Recommendations</h5>
                        <div id="securityRecommendations" class="space-y-3">
                            <!-- Recommendations will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Audit Log -->
                    <div class="border rounded-lg p-4">
                        <div class="flex items-center justify-between mb-4">
                            <h5 class="font-medium">Security Audit Log</h5>
                            <div class="flex space-x-2">
                                <select id="auditFilter" class="form-select text-sm" onchange="SecurityAudit.filterAuditLog()">
                                    <option value="all">All Events</option>
                                    <option value="login">Login Events</option>
                                    <option value="settings">Settings Changes</option>
                                    <option value="data">Data Access</option>
                                    <option value="security">Security Events</option>
                                </select>
                                <button onclick="SecurityAudit.exportAuditLog()" class="btn-secondary text-sm">
                                    <i data-lucide="download" class="inline w-4 h-4 mr-2"></i>
                                    Export
                                </button>
                            </div>
                        </div>
                        
                        <div id="auditLog" class="space-y-2 max-h-64 overflow-y-auto">
                            <!-- Audit log will be loaded here -->
                        </div>
                    </div>
                    
                    <!-- Security Alerts -->
                    <div class="border rounded-lg p-4">
                        <h5 class="font-medium mb-3">Security Alert Settings</h5>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="alertFailedLogins" class="form-checkbox">
                                <span class="ml-3">Alert on multiple failed login attempts</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertNewDevice" class="form-checkbox">
                                <span class="ml-3">Alert on new device login</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertUnusualLocation" class="form-checkbox">
                                <span class="ml-3">Alert on unusual login location</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertDataExport" class="form-checkbox">
                                <span class="ml-3">Alert on data export requests</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="alertSettingsChange" class="form-checkbox">
                                <span class="ml-3">Alert on security settings changes</span>
                            </label>
                        </div>
                        
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Alert Threshold</label>
                            <select id="alertThreshold" class="form-select">
                                <option value="low">Low sensitivity</option>
                                <option value="medium">Medium sensitivity</option>
                                <option value="high">High sensitivity</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        this.loadSecurityScore();
        this.loadRecommendations();
        this.loadAuditLog();
        
        // Load alert settings
        document.getElementById('alertFailedLogins').checked = Settings.getSetting('alertFailedLogins', true);
        document.getElementById('alertNewDevice').checked = Settings.getSetting('alertNewDevice', true);
        document.getElementById('alertUnusualLocation').checked = Settings.getSetting('alertUnusualLocation', true);
        document.getElementById('alertDataExport').checked = Settings.getSetting('alertDataExport', true);
        document.getElementById('alertSettingsChange').checked = Settings.getSetting('alertSettingsChange', true);
        document.getElementById('alertThreshold').value = Settings.getSetting('alertThreshold', 'medium');
    },
    
    loadSecurityScore() {
        // Calculate security score based on current settings
        let score = 0;
        let maxScore = 100;
        
        // Check various security factors
        if (Settings.getSetting('twoFactorEnabled', false)) score += 25;
        if (Settings.getSetting('requireUppercase', false)) score += 10;
        if (Settings.getSetting('requireNumbers', false)) score += 10;
        if (Settings.getSetting('sessionTimeout', '60') !== 'never') score += 15;
        if (Settings.getSetting('notifyNewLogin', false)) score += 10;
        if (Settings.getSetting('enableIPRestrictions', false)) score += 20;
        if (Settings.getSetting('collectAnalytics', false)) score += 10;
        
        const percentage = Math.min(score, maxScore);
        const level = percentage >= 80 ? 'Excellent' : percentage >= 60 ? 'Good' : percentage >= 40 ? 'Fair' : 'Poor';
        const color = percentage >= 80 ? 'green' : percentage >= 60 ? 'blue' : percentage >= 40 ? 'yellow' : 'red';
        
        document.getElementById('securityScore').innerHTML = `
            <div class="flex items-center justify-between">
                <div>
                    <div class="text-2xl font-bold text-${color}-600">${percentage}/100</div>
                    <div class="text-sm text-gray-600">Security Level: ${level}</div>
                </div>
                <div class="w-24 h-24">
                    <svg class="transform -rotate-90 w-24 h-24">
                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" class="text-gray-200"/>
                        <circle cx="48" cy="48" r="40" stroke="currentColor" stroke-width="8" fill="transparent" 
                                stroke-dasharray="${2 * Math.PI * 40}" stroke-dashoffset="${2 * Math.PI * 40 * (1 - percentage / 100)}"
                                class="text-${color}-600"/>
                    </svg>
                    <div class="absolute inset-0 flex items-center justify-center">
                        <span class="text-xl font-bold text-${color}-600">${percentage}%</span>
                    </div>
                </div>
            </div>
            <div class="mt-4 text-sm text-gray-600">
                Last scan: ${new Date().toLocaleString()}
            </div>
        `;
    },
    
    loadRecommendations() {
        const recommendations = [];
        
        if (!Settings.getSetting('twoFactorEnabled', false)) {
            recommendations.push({
                type: 'critical',
                title: 'Enable Two-Factor Authentication',
                description: 'Add an extra layer of security to your account',
                action: 'Enable 2FA'
            });
        }
        
        if (Settings.getSetting('sessionTimeout', '60') === 'never') {
            recommendations.push({
                type: 'warning',
                title: 'Set Session Timeout',
                description: 'Automatically log out inactive sessions for better security',
                action: 'Configure Timeout'
            });
        }
        
        if (!Settings.getSetting('requireSpecialChars', false)) {
            recommendations.push({
                type: 'info',
                title: 'Strengthen Password Requirements',
                description: 'Require special characters in passwords',
                action: 'Update Policy'
            });
        }
        
        if (recommendations.length === 0) {
            recommendations.push({
                type: 'success',
                title: 'All Security Recommendations Met',
                description: 'Your security configuration looks good!',
                action: null
            });
        }
        
        document.getElementById('securityRecommendations').innerHTML = recommendations.map(rec => `
            <div class="flex items-start p-3 border rounded-lg ${this.getRecommendationColor(rec.type)}">
                <i data-lucide="${this.getRecommendationIcon(rec.type)}" 
                   class="w-5 h-5 mt-0.5 mr-3 ${this.getRecommendationIconColor(rec.type)}"></i>
                <div class="flex-1">
                    <h6 class="font-medium text-sm">${rec.title}</h6>
                    <p class="text-sm text-gray-600">${rec.description}</p>
                </div>
                ${rec.action ? `
                    <button onclick="SecurityAudit.handleRecommendation('${rec.type}')" 
                            class="btn-secondary text-sm">
                        ${rec.action}
                    </button>
                ` : ''}
            </div>
        `).join('');
        
        lucide.createIcons();
    },
    
    loadAuditLog() {
        const auditEvents = [
            {
                timestamp: '2024-01-15 10:30:15',
                type: 'login',
                event: 'Successful login',
                details: 'User logged in from Chrome on Windows',
                ip: '192.168.1.100'
            },
            {
                timestamp: '2024-01-15 09:45:22',
                type: 'settings',
                event: 'Security settings changed',
                details: 'Two-factor authentication enabled',
                ip: '192.168.1.100'
            },
            {
                timestamp: '2024-01-14 16:20:33',
                type: 'security',
                event: 'Failed login attempt',
                details: 'Multiple failed login attempts detected',
                ip: '203.0.113.45'
            },
            {
                timestamp: '2024-01-14 14:15:10',
                type: 'data',
                event: 'Data export requested',
                details: 'User requested data export',
                ip: '192.168.1.100'
            }
        ];
        
        document.getElementById('auditLog').innerHTML = auditEvents.map(event => `
            <div class="flex items-center justify-between p-2 border rounded text-sm">
                <div class="flex items-center">
                    <span class="w-2 h-2 rounded-full ${this.getEventColor(event.type)} mr-3"></span>
                    <div>
                        <div class="font-medium">${event.event}</div>
                        <div class="text-gray-500 text-xs">${event.details}</div>
                    </div>
                </div>
                <div class="text-right text-xs text-gray-400">
                    <div>${event.timestamp}</div>
                    <div>${event.ip}</div>
                </div>
            </div>
        `).join('');
    },
    
    getRecommendationColor(type) {
        switch (type) {
            case 'critical': return 'bg-red-50 border-red-200';
            case 'warning': return 'bg-yellow-50 border-yellow-200';
            case 'info': return 'bg-blue-50 border-blue-200';
            case 'success': return 'bg-green-50 border-green-200';
            default: return 'bg-gray-50 border-gray-200';
        }
    },
    
    getRecommendationIcon(type) {
        switch (type) {
            case 'critical': return 'alert-circle';
            case 'warning': return 'alert-triangle';
            case 'info': return 'info';
            case 'success': return 'check-circle';
            default: return 'info';
        }
    },
    
    getRecommendationIconColor(type) {
        switch (type) {
            case 'critical': return 'text-red-600';
            case 'warning': return 'text-yellow-600';
            case 'info': return 'text-blue-600';
            case 'success': return 'text-green-600';
            default: return 'text-gray-600';
        }
    },
    
    getEventColor(type) {
        switch (type) {
            case 'login': return 'bg-blue-500';
            case 'settings': return 'bg-green-500';
            case 'data': return 'bg-purple-500';
            case 'security': return 'bg-red-500';
            default: return 'bg-gray-500';
        }
    },
    
    runSecurityScan() {
        UI.showAlert('Running security scan...', 'info');
        setTimeout(() => {
            this.loadSecurityScore();
            this.loadRecommendations();
            UI.showAlert('Security scan completed!', 'success');
        }, 2000);
    },
    
    handleRecommendation(type) {
        switch (type) {
            case 'critical':
                UI.showAlert('Redirecting to Two-Factor Authentication setup...', 'info');
                break;
            case 'warning':
                UI.showAlert('Redirecting to Session Management settings...', 'info');
                break;
            case 'info':
                UI.showAlert('Redirecting to Password Policy settings...', 'info');
                break;
        }
    },
    
    filterAuditLog() {
        const filter = document.getElementById('auditFilter').value;
        UI.showAlert(`Filtering audit log by: ${filter}`, 'info');
    },
    
    exportAuditLog() {
        UI.showAlert('Audit log exported to CSV', 'success');
    },
    
    collect() {
        return {
            alertFailedLogins: document.getElementById('alertFailedLogins').checked,
            alertNewDevice: document.getElementById('alertNewDevice').checked,
            alertUnusualLocation: document.getElementById('alertUnusualLocation').checked,
            alertDataExport: document.getElementById('alertDataExport').checked,
            alertSettingsChange: document.getElementById('alertSettingsChange').checked,
            alertThreshold: document.getElementById('alertThreshold').value
        };
    }
};// Integration overview component for T&J Field Services
const IntegrationOverview = {
    render() {
        return `
            <div class="space-y-6">
                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-white border rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-green-600" id="activeIntegrations">0</div>
                                <div class="text-sm text-gray-600">Active</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="grid-3x3" class="w-5 h-5 text-blue-600"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-blue-600" id="availableIntegrations">0</div>
                                <div class="text-sm text-gray-600">Available</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="zap" class="w-5 h-5 text-purple-600"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-purple-600" id="automations">0</div>
                                <div class="text-sm text-gray-600">Automations</div>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white border rounded-lg p-4">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="activity" class="w-5 h-5 text-orange-600"></i>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-orange-600" id="apiCalls">0</div>
                                <div class="text-sm text-gray-600">API Calls Today</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Active Integrations -->
                <div class="bg-white border rounded-lg p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium">Active Integrations</h3>
                        <button onclick="IntegrationOverview.manageAll()" class="btn-secondary text-sm">
                            Manage All
                        </button>
                    </div>
                    <div id="activeIntegrationsList" class="space-y-3">
                        <!-- Active integrations will be loaded here -->
                    </div>
                </div>
                
                <!-- Popular Integrations -->
                <div class="bg-white border rounded-lg p-6">
                    <h3 class="text-lg font-medium mb-4">Popular Integrations</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="popularIntegrations">
                        <!-- Popular integrations will be loaded here -->
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="bg-white border rounded-lg p-6">
                    <h3 class="text-lg font-medium mb-4">Recent Integration Activity</h3>
                    <div id="recentActivity" class="space-y-3">
                        <!-- Recent activity will be loaded here -->
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        this.loadStats();
        this.loadActiveIntegrations();
        this.loadPopularIntegrations();
        this.loadRecentActivity();
    },
    
    loadStats() {
        // Simulate loading stats
        setTimeout(() => {
            document.getElementById('activeIntegrations').textContent = '7';
            document.getElementById('availableIntegrations').textContent = '25';
            document.getElementById('automations').textContent = '12';
            document.getElementById('apiCalls').textContent = '1,247';
        }, 500);
    },
    
    loadActiveIntegrations() {
        const activeIntegrations = [
            {
                name: 'QuickBooks Online',
                category: 'Accounting',
                status: 'connected',
                lastSync: '2 minutes ago',
                icon: 'calculator',
                color: 'green'
            },
            {
                name: 'Gmail',
                category: 'Communication',
                status: 'connected',
                lastSync: '5 minutes ago',
                icon: 'mail',
                color: 'blue'
            },
            {
                name: 'Google Drive',
                category: 'Storage',
                status: 'connected',
                lastSync: '1 hour ago',
                icon: 'cloud',
                color: 'purple'
            },
            {
                name: 'Mailchimp',
                category: 'Marketing',
                status: 'warning',
                lastSync: 'Authentication needed',
                icon: 'megaphone',
                color: 'yellow'
            }
        ];
        
        document.getElementById('activeIntegrationsList').innerHTML = activeIntegrations.map(integration => `
            <div class="flex items-center justify-between p-3 border rounded-lg">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-${integration.color}-100 rounded-lg flex items-center justify-center mr-3">
                        <i data-lucide="${integration.icon}" class="w-5 h-5 text-${integration.color}-600"></i>
                    </div>
                    <div>
                        <div class="font-medium">${integration.name}</div>
                        <div class="text-sm text-gray-500">${integration.category}</div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <div class="text-right">
                        <div class="flex items-center">
                            <span class="w-2 h-2 rounded-full ${integration.status === 'connected' ? 'bg-green-500' : 'bg-yellow-500'} mr-2"></span>
                            <span class="text-sm ${integration.status === 'connected' ? 'text-green-600' : 'text-yellow-600'}">
                                ${integration.status === 'connected' ? 'Connected' : 'Needs Attention'}
                            </span>
                        </div>
                        <div class="text-xs text-gray-400">${integration.lastSync}</div>
                    </div>
                    <button onclick="IntegrationOverview.configureIntegration('${integration.name}')" 
                            class="btn-secondary text-sm">
                        Configure
                    </button>
                </div>
            </div>
        `).join('');
        
        lucide.createIcons();
    },
    
    loadPopularIntegrations() {
        const popularIntegrations = [
            {
                name: 'Stripe',
                description: 'Accept payments online',
                category: 'Payments',
                icon: 'credit-card',
                color: 'indigo',
                installed: false
            },
            {
                name: 'Slack',
                description: 'Team communication',
                category: 'Communication',
                icon: 'message-square',
                color: 'purple',
                installed: false
            },
            {
                name: 'Zapier',
                description: 'Automate workflows',
                category: 'Automation',
                icon: 'zap',
                color: 'orange',
                installed: false
            },
            {
                name: 'Dropbox',
                description: 'Cloud file storage',
                category: 'Storage',
                icon: 'cloud',
                color: 'blue',
                installed: false
            },
            {
                name: 'Twilio',
                description: 'SMS and voice calls',
                category: 'Communication',
                icon: 'phone',
                color: 'red',
                installed: false
            },
            {
                name: 'Square',
                description: 'Point of sale system',
                category: 'Payments',
                icon: 'square',
                color: 'gray',
                installed: false
            }
        ];
        
        document.getElementById('popularIntegrations').innerHTML = popularIntegrations.map(integration => `
            <div class="border rounded-lg p-4 hover:shadow-md transition-shadow">
                <div class="flex items-start justify-between mb-3">
                    <div class="w-12 h-12 bg-${integration.color}-100 rounded-lg flex items-center justify-center">
                        <i data-lucide="${integration.icon}" class="w-6 h-6 text-${integration.color}-600"></i>
                    </div>
                    <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full">
                        ${integration.category}
                    </span>
                </div>
                <h4 class="font-medium mb-1">${integration.name}</h4>
                <p class="text-sm text-gray-600 mb-3">${integration.description}</p>
                <button onclick="IntegrationOverview.installIntegration('${integration.name}')" 
                        class="w-full btn-primary text-sm">
                    ${integration.installed ? 'Configure' : 'Install'}
                </button>
            </div>
        `).join('');
        
        lucide.createIcons();
    },
    
    loadRecentActivity() {
        const recentActivity = [
            {
                type: 'sync',
                integration: 'QuickBooks Online',
                action: 'Synced 3 new invoices',
                timestamp: '2 minutes ago',
                icon: 'refresh-cw',
                color: 'blue'
            },
            {
                type: 'connect',
                integration: 'Google Drive',
                action: 'Successfully connected',
                timestamp: '1 hour ago',
                icon: 'link',
                color: 'green'
            },
            {
                type: 'error',
                integration: 'Mailchimp',
                action: 'Authentication failed',
                timestamp: '2 hours ago',
                icon: 'alert-triangle',
                color: 'red'
            },
            {
                type: 'automation',
                integration: 'Zapier',
                action: 'New automation triggered',
                timestamp: '3 hours ago',
                icon: 'zap',
                color: 'purple'
            }
        ];
        
        document.getElementById('recentActivity').innerHTML = recentActivity.map(activity => `
            <div class="flex items-center p-3 border rounded-lg">
                <div class="w-8 h-8 bg-${activity.color}-100 rounded-lg flex items-center justify-center mr-3">
                    <i data-lucide="${activity.icon}" class="w-4 h-4 text-${activity.color}-600"></i>
                </div>
                <div class="flex-1">
                    <div class="font-medium text-sm">${activity.integration}</div>
                    <div class="text-sm text-gray-600">${activity.action}</div>
                </div>
                <div class="text-xs text-gray-400">${activity.timestamp}</div>
            </div>
        `).join('');
        
        lucide.createIcons();
    },
    
    configureIntegration(name) {
        UI.showAlert(`Opening ${name} configuration...`, 'info');
    },
    
    installIntegration(name) {
        UI.showAlert(`Installing ${name} integration...`, 'info');
    },
    
    manageAll() {
        UI.showAlert('Opening integration management panel...', 'info');
    }
};id: tj-accounting-integrations
name: T&J Accounting Integrations
type: code.js
content: |-
// Accounting integrations component for T&J Field Services
const AccountingIntegrations = {
    render() {
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium">Accounting Integrations</h3>
                    <button onclick="AccountingIntegrations.syncAll()" class="btn-primary">
                        <i data-lucide="refresh-cw" class="inline w-4 h-4 mr-2"></i>
                        Sync All
                    </button>
                </div>
                
                <!-- Connected Accounting Services -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div id="connectedAccounting" class="space-y-4">
                        <!-- Connected services will be loaded here -->
                    </div>
                    <div id="availableAccounting" class="space-y-4">
                        <!-- Available services will be loaded here -->
                    </div>
                </div>
                
                <!-- Sync Settings -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">Sync Settings</h4>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Auto Sync Frequency</label>
                                <select id="autoSyncFrequency" class="form-select">
                                    <option value="realtime">Real-time</option>
                                    <option value="hourly">Every hour</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="manual">Manual only</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sync Direction</label>
                                <select id="syncDirection" class="form-select">
                                    <option value="bidirectional">Two-way sync</option>
                                    <option value="to_accounting">T&J â†’ Accounting</option>
                                    <option value="from_accounting">Accounting â†’ T&J</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <h5 class="font-medium">What to Sync</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncCustomers" class="form-checkbox" checked>
                                    <span class="ml-2 text-sm">Customers</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncInvoices" class="form-checkbox" checked>
                                    <span class="ml-2 text-sm">Invoices</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncPayments" class="form-checkbox" checked>
                                    <span class="ml-2 text-sm">Payments</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncExpenses" class="form-checkbox">
                                    <span class="ml-2 text-sm">Expenses</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncItems" class="form-checkbox" checked>
                                    <span class="ml-2 text-sm">Items/Services</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncTaxes" class="form-checkbox" checked>
                                    <span class="ml-2 text-sm">Tax Rates</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncReports" class="form-checkbox">
                                    <span class="ml-2 text-sm">Reports</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="syncBankData" class="form-checkbox">
                                    <span class="ml-2 text-sm">Bank Data</span>
                                </label>
                            </div>
                        </div>
                        
                        <button onclick="AccountingIntegrations.saveSettings()" class="btn-primary">
                            Save Settings
                        </button>
                    </div>
                </div>
                
                <!-- Sync History -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">Recent Sync Activity</h4>
                    <div id="syncHistory" class="space-y-3">
                        <!-- Sync history will be loaded here -->
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        this.loadConnectedServices();
        this.loadAvailableServices();
        this.loadSyncHistory();
        this.loadSettings();
    },
    
    loadConnectedServices() {
        const connectedServices = [
            {
                name: 'QuickBooks Online',
                status: 'connected',
                lastSync: '2 minutes ago',
                syncedItems: '247 customers, 156 invoices',
                icon: 'calculator',
                color: 'green'
            }
        ];
        
        const connectedHtml = connectedServices.length > 0 ? `
            <h4 class="font-medium text-green-600 mb-3">
                <i data-lucide="check-circle" class="inline w-4 h-4 mr-2"></i>
                Connected Services
            </h4>
            ${connectedServices.map(service => `
                <div class="border border-green-200 bg-green-50 rounded-lg p-4">
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center mr-3">
                                <i data-lucide="${service.icon}" class="w-5 h-5 text-green-600"></i>
                            </div>
                            <div>
                                <h5 class="font-medium">${service.name}</h5>
                                <p class="text-sm text-green-600">Connected</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="AccountingIntegrations.syncNow('${service.name}')" class="btn-secondary text-sm">
                                <i data-lucide="refresh-cw" class="inline w-3 h-3 mr-1"></i>
                                Sync Now
                            </button>
                            <button onclick="AccountingIntegrations.configure('${service.name}')" class="btn-secondary text-sm">
                                Configure
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        <p>Last sync: ${service.lastSync}</p>
                        <p>${service.syncedItems}</p>
                    </div>
                </div>
            `).join('')}
        ` : `
            <div class="text-
// Accounting sync settings component for T&J Field Services
const AccountingSyncSettings = {
    render() {
        return `
            <div class="bg-white border rounded-lg p-6">
                <h4 class="text-lg font-medium mb-4">Sync Settings</h4>
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Auto Sync Frequency</label>
                            <select id="autoSyncFrequency" class="form-select">
                                <option value="realtime">Real-time</option>
                                <option value="hourly">Every hour</option>
                                <option value="daily">Daily</option>
                                <option value="weekly">Weekly</option>
                                <option value="manual">Manual only</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sync Direction</label>
                            <select id="syncDirection" class="form-select">
                                <option value="bidirectional">Two-way sync</option>
                                <option value="to_accounting">T&J â†’ Accounting</option>
                                <option value="from_accounting">Accounting â†’ T&J</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <h5 class="font-medium">What to Sync</h5>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="syncCustomers" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Customers</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncInvoices" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Invoices</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncPayments" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Payments</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncExpenses" class="form-checkbox">
                                <span class="ml-2 text-sm">Expenses</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncItems" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Items/Services</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncTaxes" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Tax Rates</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncReports" class="form-checkbox">
                                <span class="ml-2 text-sm">Reports</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncBankData" class="form-checkbox">
                                <span class="ml-2 text-sm">Bank Data</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="border-t pt-4">
                        <h5 class="font-medium mb-3">Advanced Settings</h5>
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="conflictResolution" class="form-checkbox">
                                <span class="ml-2 text-sm">Automatic conflict resolution (T&J data takes priority)</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncNotifications" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Send notifications on sync completion</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncErrors" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Alert on sync errors</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="flex space-x-2 pt-4">
                        <button onclick="AccountingSyncSettings.saveSettings()" class="btn-primary">
                            Save Settings
                        </button>
                        <button onclick="AccountingSyncSettings.resetDefaults()" class="btn-secondary">
                            Reset to Defaults
                        </button>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        // Load saved settings
        document.getElementById('autoSyncFrequency').value = Settings.getSetting('autoSyncFrequency', 'daily');
        document.getElementById('syncDirection').value = Settings.getSetting('syncDirection', 'bidirectional');
        
        // Load sync options
        document.getElementById('syncCustomers').checked = Settings.getSetting('syncCustomers', true);
        document.getElementById('syncInvoices').checked = Settings.getSetting('syncInvoices', true);
        document.getElementById('syncPayments').checked = Settings.getSetting('syncPayments', true);
        document.getElementById('syncExpenses').checked = Settings.getSetting('syncExpenses', false);
        document.getElementById('syncItems').checked = Settings.getSetting('syncItems', true);
        document.getElementById('syncTaxes').checked = Settings.getSetting('syncTaxes', true);
        document.getElementById('syncReports').checked = Settings.getSetting('syncReports', false);
        document.getElementById('syncBankData').checked = Settings.getSetting('syncBankData', false);
        
        // Load advanced settings
        document.getElementById('conflictResolution').checked = Settings.getSetting('conflictResolution', false);
        document.getElementById('syncNotifications').checked = Settings.getSetting('syncNotifications', true);
        document.getElementById('syncErrors').checked = Settings.getSetting('syncErrors', true);
    },
    
    saveSettings() {
        const settings = {
            autoSyncFrequency: document.getElementById('autoSyncFrequency').value,
            syncDirection: document.getElementById('syncDirection').value,
            syncCustomers: document.getElementById('syncCustomers').checked,
            syncInvoices: document.getElementById('syncInvoices').checked,
            syncPayments: document.getElementById('syncPayments').checked,
            syncExpenses: document.getElementById('syncExpenses').checked,
            syncItems: document.getElementById('syncItems').checked,
            syncTaxes: document.getElementById('syncTaxes').checked,
            syncReports: document.getElementById('syncReports').checked,
            syncBankData: document.getElementById('syncBankData').checked,
            conflictResolution: document.getElementById('conflictResolution').checked,
            syncNotifications: document.getElementById('syncNotifications').checked,
            syncErrors: document.getElementById('syncErrors').checked
        };
        
        Object.keys(settings).forEach(key => {
            Settings.updateSetting(key, settings[key]);
        });
        
        UI.showAlert('Sync settings saved successfully!', 'success');
    },
    
    resetDefaults() {
        if (confirm('Are you sure you want to reset all sync settings to defaults?')) {
            // Reset to default values
            document.getElementById('autoSyncFrequency').value = 'daily';
            document.getElementById('syncDirection').value = 'bidirectional';
            
            document.getElementById('syncCustomers').checked = true;
            document.getElementById('syncInvoices').checked = true;
            document.getElementById('syncPayments').checked = true;
            document.getElementById('syncExpenses').checked = false;
            document.getElementById('syncItems').checked = true;
            document.getElementById('syncTaxes').checked = true;
            document.getElementById('syncReports').checked = false;
            document.getElementById('syncBankData').checked = false;
            
            document.getElementById('conflictResolution').checked = false;
            document.getElementById('syncNotifications').checked = true;
            document.getElementById('syncErrors').checked = true;
            
            UI.showAlert('Settings reset to defaults', 'success');
        }
    }
};// Communication integrations component for T&J Field Services
const CommunicationIntegrations = {
    render() {
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium">Communication Integrations</h3>
                    <button onclick="CommunicationIntegrations.testAll()" class="btn-primary">
                        <i data-lucide="send" class="inline w-4 h-4 mr-2"></i>
                        Test All
                    </button>
                </div>
                
                <!-- Email Services -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="mail" class="inline w-5 h-5 mr-2"></i>
                        Email Services
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderEmailServices()}
                    </div>
                </div>
                
                <!-- SMS Services -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="message-square" class="inline w-5 h-5 mr-2"></i>
                        SMS Services
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderSMSServices()}
                    </div>
                </div>
                
                <!-- Chat & Messaging -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="message-circle" class="inline w-5 h-5 mr-2"></i>
                        Chat & Messaging
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderChatServices()}
                    </div>
                </div>
                
                <!-- Communication Settings -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">Communication Settings</h4>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Default Email Template</label>
                                <select id="defaultEmailTemplate" class="form-select">
                                    <option value="professional">Professional</option>
                                    <option value="friendly">Friendly</option>
                                    <option value="minimal">Minimal</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">SMS Character Limit Warning</label>
                                <select id="smsCharLimit" class="form-select">
                                    <option value="160">160 characters</option>
                                    <option value="320">320 characters</option>
                                    <option value="480">480 characters</option>
                                    <option value="none">No limit</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="autoResponders" class="form-checkbox" checked>
                                <span class="ml-3">Enable automatic response messages</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="readReceipts" class="form-checkbox">
                                <span class="ml-3">Request read receipts for emails</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="unsubscribeLinks" class="form-checkbox" checked>
                                <span class="ml-3">Include unsubscribe links in marketing emails</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="deliveryReports" class="form-checkbox" checked>
                                <span class="ml-3">Enable delivery reports for SMS</span>
                            </label>
                        </div>
                        
                        <button onclick="CommunicationIntegrations.saveSettings()" class="btn-primary">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        `;
    },
    
    renderEmailServices() {
        const emailServices = [
            {
                name: 'Gmail',
                status: 'connected',
                description: 'Google email service',
                icon: 'mail',
                color: 'red',
                features: ['Send emails', 'Read receipts', 'Templates']
            },
            {
                name: 'Outlook',
                status: 'available',
                description: 'Microsoft email service',
                icon: 'mail',
                color: 'blue',
                features: ['Send emails', 'Calendar sync', 'Contacts']
            },
            {
                name: 'SendGrid',
                status: 'available',
                description: 'Email delivery service',
                icon: 'send',
                color: 'blue',
                features: ['Bulk emails', 'Analytics', 'Templates']
            },
            {
                name: 'Mailgun',
                status: 'available',
                description: 'Email API service',
                icon: 'zap',
                color: 'orange',
                features: ['API emails', 'Validation', 'Analytics']
            }
        ];
        
        return emailServices.map(service => this.renderServiceCard(service, 'email')).join('');
    },
    
    renderSMSServices() {
        const smsServices = [
            {
                name: 'Twilio',
                status: 'available',
                description: 'SMS and voice service',
                icon: 'phone',
                color: 'red',
                features: ['SMS', 'Voice calls', 'WhatsApp']
            },
            {
                name: 'TextMagic',
                status: 'available',
                description: 'Business SMS service',
                icon: 'message-square',
                color: 'green',
                features: ['Bulk SMS', 'Two-way SMS', 'Templates']
            },
            {
                name: 'Vonage',
                status: 'available',
                description: 'Communication APIs',
                icon: 'phone-call',
                color: 'purple',
                features: ['SMS', 'Voice', 'Video']
            },
            {
                name: 'AWS SNS',
                status: 'available',
                description: 'Amazon notification service',
                icon: 'cloud',
                color: 'orange',
                features: ['SMS', 'Push notifications', 'Email']
            }
        ];
        
        return smsServices.map(service => this.renderServiceCard(service, 'sms')).join('');
    },
    
    renderChatServices() {
        const chatServices = [
            {
                name: 'Slack',
                status: 'available',
                description: 'Team communication',
                icon: 'message-circle',
                color: 'purple',
                features: ['Team chat', 'File sharing', 'Integrations']
            },
            {
                name: 'Microsoft Teams',
                status: 'available',
                description: 'Business communication',
                icon: 'users',
                color: 'blue',
                features: ['Video calls', 'Chat', 'File sharing']
            },
            {
                name: 'Discord',
                status: 'available',
                description: 'Community platform',
                icon: 'message-square',
                color: 'indigo',
                features: ['Voice chat', 'Text chat', 'Communities']
            },
            {
                name: 'WhatsApp Business',
                status: 'available',
                description: 'Business messaging',
                icon: 'phone',
                color: 'green',
                features: ['Customer chat', 'Broadcast', 'Automation']
            }
        ];
        
        return chatServices.map(service => this.renderServiceCard(service, 'chat')).join('');
    },
    
    renderServiceCard(service, type) {
        const isConnected = service.status === 'connected';
        return `
            <div class="border rounded-lg p-4 ${isConnected ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-${service.color}-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="${service.icon}" class="w-5 h-5 text-${service.color}-600"></i>
                        </div>
                        <div>
                            <h5 class="font-medium">${service.name}</h5>
                            <p class="text-sm text-gray-600">${service.description}</p>
                        </div>
                    </div>
                    <span class="w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-gray-400'}"></span>
                </div>
                
                <div class="mb-3">
                    <div class="flex flex-wrap gap-1">
                        ${service.features.map(feature => `
                            <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full">${feature}</span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    ${isConnected ? `
                        <button onclick="CommunicationIntegrations.configure('${service.name}', '${type}')" 
                                class="btn-secondary text-sm flex-1">
                            Configure
                        </button>
                        <button onclick="CommunicationIntegrations.test('${service.name}', '${type}')" 
                                class="btn-secondary text-sm">
                            Test
                        </button>
                    ` : `
                        <button onclick="CommunicationIntegrations.connect('${service.name}', '${type}')" 
                                class="btn-primary text-sm flex-1">
                            Connect
                        </button>
                        <button onclick="CommunicationIntegrations.learnMore('${service.name}', '${type}')" 
                                class="btn-secondary text-sm">
                            Info
                        </button>
                    `}
                </div>
            </div>
        `;
    },
    
    load() {
        // Load communication settings
        document.getElementById('defaultEmailTemplate').value = Settings.getSetting('defaultEmailTemplate', 'professional');
        document.getElementById('smsCharLimit').value = Settings.getSetting('smsCharLimit', '160');
        document.getElementById('autoResponders').checked = Settings.getSetting('autoResponders', true);
        document.getElementById('readReceipts').checked = Settings.getSetting('readReceipts', false);
        document.getElementById('unsubscribeLinks').checked = Settings.getSetting('unsubscribeLinks', true);
        document.getElementById('deliveryReports').checked = Settings.getSetting('deliveryReports', true);
        
        lucide.createIcons();
    },
    
    connect(serviceName, type) {
        UI.showAlert(`Connecting to ${serviceName}...`, 'info');
        setTimeout(() => {
            UI.showAlert(`${serviceName} connected successfully!`, 'success');
            this.load();
        }, 2000);
    },
    
    configure(serviceName, type) {
        UI.showAlert(`Opening ${serviceName} configuration...`, 'info');
    },
    
    test(serviceName, type) {
        UI.showAlert(`Testing ${serviceName} connection...`, 'info');
        setTimeout(() => {
            UI.showAlert(`${serviceName} test successful!`, 'success');
        }, 1500);
    },
    
    testAll() {
        UI.showAlert('Testing all communication services...', 'info');
        setTimeout(() => {
            UI.showAlert('All communication tests completed!', 'success');
        }, 3000);
    },
    
    learnMore(serviceName, type) {
        UI.showAlert(`Opening ${serviceName} information...`, 'info');
    },
    
    saveSettings() {
        const settings = {
            defaultEmailTemplate: document.getElementById('defaultEmailTemplate').value,
            smsCharLimit: document.getElementById('smsCharLimit').value,
            autoResponders: document.getElementById('autoResponders').checked,
            readReceipts: document.getElementById('readReceipts').checked,
            unsubscribeLinks: document.getElementById('unsubscribeLinks').checked,
            deliveryReports: document.getElementById('deliveryReports').checked
        };
        
        Object.keys(settings).forEach(key => {
            Settings.updateSetting(key, settings[key]);
        });
        
        UI.showAlert('Communication settings saved successfully!', 'success');
    }
};// Marketing integrations component for T&J Field Services
const MarketingIntegrations = {
    render() {
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium">Marketing Integrations</h3>
                    <button onclick="MarketingIntegrations.syncAllCampaigns()" class="btn-primary">
                        <i data-lucide="refresh-cw" class="inline w-4 h-4 mr-2"></i>
                        Sync Campaigns
                    </button>
                </div>
                
                <!-- Email Marketing -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="mail" class="inline w-5 h-5 mr-2"></i>
                        Email Marketing
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderEmailMarketing()}
                    </div>
                </div>
                
                <!-- Social Media -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="share-2" class="inline w-5 h-5 mr-2"></i>
                        Social Media
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderSocialMedia()}
                    </div>
                </div>
                
                <!-- Review Management -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="star" class="inline w-5 h-5 mr-2"></i>
                        Review Management
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderReviewPlatforms()}
                    </div>
                </div>
                
                <!-- Marketing Automation -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">Marketing Automation Settings</h4>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Lead Follow-up Delay</label>
                                <select id="leadFollowupDelay" class="form-select">
                                    <option value="immediate">Immediate</option>
                                    <option value="1hour">1 hour</option>
                                    <option value="24hours">24 hours</option>
                                    <option value="3days">3 days</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Campaign Sync Frequency</label>
                                <select id="campaignSyncFreq" class="form-select">
                                    <option value="realtime">Real-time</option>
                                    <option value="hourly">Every hour</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="autoLeadCapture" class="form-checkbox" checked>
                                <span class="ml-3">Automatically capture leads from marketing campaigns</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="autoSegmentation" class="form-checkbox">
                                <span class="ml-3">Enable automatic customer segmentation</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="reviewRequests" class="form-checkbox" checked>
                                <span class="ml-3">Send automatic review requests after job completion</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="socialPosting" class="form-checkbox">
                                <span class="ml-3">Auto-post completed projects to social media</span>
                            </label>
                        </div>
                        
                        <button onclick="MarketingIntegrations.saveSettings()" class="btn-primary">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        `;
    },
    
    renderEmailMarketing() {
        const emailServices = [
            {
                name: 'Mailchimp',
                status: 'connected',
                description: 'Email marketing platform',
                icon: 'mail',
                color: 'yellow',
                metrics: { subscribers: '1,247', campaigns: '23', open_rate: '24.5%' }
            },
            {
                name: 'Constant Contact',
                status: 'available',
                description: 'Email & digital marketing',
                icon: 'send',
                color: 'blue',
                metrics: null
            },
            {
                name: 'ConvertKit',
                status: 'available',
                description: 'Creator marketing platform',
                icon: 'zap',
                color: 'pink',
                metrics: null
            },
            {
                name: 'ActiveCampaign',
                status: 'available',
                description: 'Customer experience automation',
                icon: 'activity',
                color: 'blue',
                metrics: null
            }
        ];
        
        return emailServices.map(service => this.renderMarketingCard(service, 'email')).join('');
    },
    
    renderSocialMedia() {
        const socialServices = [
            {
                name: 'Facebook Business',
                status: 'available',
                description: 'Facebook & Instagram marketing',
                icon: 'facebook',
                color: 'blue',
                metrics: null
            },
            {
                name: 'Google My Business',
                status: 'available',
                description: 'Local business presence',
                icon: 'map-pin',
                color: 'red',
                metrics: null
            },
            {
                name: 'LinkedIn Business',
                status: 'available',
                description: 'Professional networking',
                icon: 'linkedin',
                color: 'blue',
                metrics: null
            },
            {
                name: 'Hootsuite',
                status: 'available',
                description: 'Social media management',
                icon: 'share-2',
                color: 'orange',
                metrics: null
            }
        ];
        
        return socialServices.map(service => this.renderMarketingCard(service, 'social')).join('');
    },
    
    renderReviewPlatforms() {
        const reviewServices = [
            {
                name: 'Google Reviews',
                status: 'available',
                description: 'Google business reviews',
                icon: 'star',
                color: 'yellow',
                metrics: null
            },
            {
                name: 'Yelp Business',
                status: 'available',
                description: 'Yelp review management',
                icon: 'message-square',
                color: 'red',
                metrics: null
            },
            {
                name: 'Angie\'s List',
                status: 'available',
                description: 'Home services reviews',
                icon: 'home',
                color: 'green',
                metrics: null
            },
            {
                name: 'Better Business Bureau',
                status: 'available',
                description: 'BBB accreditation',
                icon: 'shield',
                color: 'blue',
                metrics: null
            }
        ];
        
        return reviewServices.map(service => this.renderMarketingCard(service, 'review')).join('');
    },
    
    renderMarketingCard(service, type) {
        const isConnected = service.status === 'connected';
        return `
            <div class="border rounded-lg p-4 ${isConnected ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-${service.color}-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="${service.icon}" class="w-5 h-5 text-${service.color}-600"></i>
                        </div>
                        <div>
                            <h5 class="font-medium">${service.name}</h5>
                            <p class="text-sm text-gray-600">${service.description}</p>
                        </div>
                    </div>
                    <span class="w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-gray-400'}"></span>
                </div>
                
                ${service.metrics ? `
                    <div class="mb-3 p-2 bg-white rounded border">
                        <div class="grid grid-cols-3 gap-2 text-xs">
                            <div class="text-center">
                                <div class="font-medium text-gray-900">${service.metrics.subscribers}</div>
                                <div class="text-gray-500">Subscribers</div>
                            </div>
                            <div class="text-center">
                                <div class="font-medium text-gray-900">${service.metrics.campaigns}</div>
                                <div class="text-gray-500">Campaigns</div>
                            </div>
                            <div class="text-center">
                                <div class="font-medium text-gray-900">${service.metrics.open_rate}</div>
                                <div class="text-gray-500">Open Rate</div>
                            </div>
                        </div>
                    </div>
                ` : ''}
                
                <div class="flex space-x-2">
                    ${isConnected ? `
                        <button onclick="MarketingIntegrations.viewCampaigns('${service.name}')" 
                                class="btn-secondary text-sm flex-1">
                            View Campaigns
                        </button>
                        <button onclick="MarketingIntegrations.configure('${service.name}', '${type}')" 
                                class="btn-secondary text-sm">
                            Settings
                        </button>
                    ` : `
                        <button onclick="MarketingIntegrations.connect('${service.name}', '${type}')" 
                                class="btn-primary text-sm flex-1">
                            Connect
                        </button>
                        <button onclick="MarketingIntegrations.learnMore('${service.name}', '${type}')" 
                                class="btn-secondary text-sm">
                            Info
                        </button>
                    `}
                </div>
            </div>
        `;
    },
    
    load() {
        // Load marketing settings
        document.getElementById('leadFollowupDelay').value = Settings.getSetting('leadFollowupDelay', '24hours');
        document.getElementById('campaignSyncFreq').value = Settings.getSetting('campaignSyncFreq', 'daily');
        document.getElementById('autoLeadCapture').checked = Settings.getSetting('autoLeadCapture', true);
        document.getElementById('autoSegmentation').checked = Settings.getSetting('autoSegmentation', false);
        document.getElementById('reviewRequests').checked = Settings.getSetting('reviewRequests', true);
        document.getElementById('socialPosting').checked = Settings.getSetting('socialPosting', false);
        
        lucide.createIcons();
    },
    
    connect(serviceName, type) {
        UI.showAlert(`Connecting to ${serviceName}...`, 'info');
        setTimeout(() => {
            UI.showAlert(`${serviceName} connected successfully!`, 'success');
            this.load();
        }, 2000);
    },
    
    configure(serviceName, type) {
        const configModal = `
            <div class="space-y-4">
                <h4 class="text-lg font-medium">${serviceName} Settings</h4>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Sync Frequency</label>
                        <select class="form-select">
                            <option value="realtime">Real-time</option>
                            <option value="hourly">Every hour</option>
                            <option value="daily">Daily</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox" checked>
                            <span class="ml-3 text-sm">Sync customer lists</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox">
                            <span class="ml-3 text-sm">Auto-tag customers by service type</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" class="form-checkbox" checked>
                            <span class="ml-3 text-sm">Send campaign performance reports</span>
                        </label>
                    </div>
                </div>
                <div class="flex space-x-2 pt-4">
                    <button onclick="UI.closeModal()" class="btn-secondary">Cancel</button>
                    <button onclick="MarketingIntegrations.saveServiceSettings('${serviceName}')" class="btn-primary">
                        Save Settings
                    </button>
                </div>
            </div>
        `;
        
        UI.showModal(`${serviceName} Configuration`, configModal);
    },
    
    viewCampaigns(serviceName) {
        const campaignsModal = `
            <div class="space-y-4">
                <h4 class="text-lg font-medium">${serviceName} Campaigns</h4>
                <div class="space-y-3 max-h-64 overflow-y-auto">
                    <div class="border rounded p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-medium">Spring Deck Special</h5>
                            <span class="text-xs px-2 py-1 bg-green-100 text-green-800 rounded-full">Active</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            <p>Sent: 1,247 | Opens: 306 (24.5%) | Clicks: 42 (3.4%)</p>
                        </div>
                    </div>
                    <div class="border rounded p-3">
                        <div class="flex items-center justify-between mb-2">
                            <h5 class="font-medium">Winter Maintenance Tips</h5>
                            <span class="text-xs px-2 py-1 bg-gray-100 text-gray-800 rounded-full">Completed</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            <p>Sent: 1,180 | Opens: 354 (30.0%) | Clicks: 67 (5.7%)</p>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-2 pt-4">
                    <button onclick="UI.closeModal()" class="btn-secondary">Close</button>
                    <button onclick="MarketingIntegrations.createCampaign('${serviceName}')" class="btn-primary">
                        Create Campaign
                    </button>
                </div>
            </div>
        `;
        
        UI.showModal(`${serviceName} Campaigns`, campaignsModal);
    },
    
    createCampaign(serviceName) {
        UI.closeModal();
        UI.showAlert(`Opening ${serviceName} campaign creator...`, 'info');
    },
    
    syncAllCampaigns() {
        UI.showAlert('Syncing all marketing campaigns...', 'info');
        setTimeout(() => {
            UI.showAlert('All campaigns synced successfully!', 'success');
        }, 2000);
    },
    
    learnMore(serviceName, type) {
        UI.showAlert(`Opening ${serviceName} information...`, 'info');
    },
    
    saveServiceSettings(serviceName) {
        UI.closeModal();
        UI.showAlert(`${serviceName} settings saved successfully!`, 'success');
    },
    
    saveSettings() {
        const settings = {
            leadFollowupDelay: document.getElementById('leadFollowupDelay').value,
            campaignSyncFreq: document.getElementById('campaignSyncFreq').value,
            autoLeadCapture: document.getElementById('autoLeadCapture').checked,
            autoSegmentation: document.getElementById('autoSegmentation').checked,
            reviewRequests: document.getElementById('reviewRequests').checked,
            socialPosting: document.getElementById('socialPosting').checked
        };
        
        Object.keys(settings).forEach(key => {
            Settings.updateSetting(key, settings[key]);
        });
        
        UI.showAlert('Marketing settings saved successfully!', 'success');
    }
};id: tj-storage-integrations
name: T&J Storage Integrations
type: code.js
content: |-
// Storage integrations component for T&J Field Services
const StorageIntegrations = {
    render() {
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium">Storage Integrations</h3>
                    <button onclick="StorageIntegrations.syncAllFiles()" class="btn-primary">
                        <i data-lucide="refresh-cw" class="inline w-4 h-4 mr-2"></i>
                        Sync All Files
                    </button>
                </div>
                
                <!-- Cloud Storage -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="cloud" class="inline w-5 h-5 mr-2"></i>
                        Cloud Storage
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderCloudStorage()}
                    </div>
                </div>
                
                <!-- Document Management -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="file-text" class="inline w-5 h-5 mr-2"></i>
                        Document Management
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderDocumentSystems()}
                    </div>
                </div>
                
                <!-- Photo & Media Storage -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="image" class="inline w-5 h-5 mr-2"></i>
                        Photo & Media Storage
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderMediaStorage()}
                    </div>
                </div>
                
                <!-- Storage Settings -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">Storage Settings</h4>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Default Storage Location</label>
                                <select id="defaultStorage" class="form-select">
                                    <option value="local">Local Storage</option>
                                    <option value="google_drive">Google Drive</option>
                                    <option value="dropbox">Dropbox</option>
                                    <option value="onedrive">OneDrive</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Auto-Backup Frequency</label>
                                <select id="backupFrequency" class="form-select">
                                    <option value="realtime">Real-time</option>
                                    <option value="hourly">Every hour</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Photo Quality</label>
                                <select id="photoQuality" class="form-select">
                                    <option value="original">Original Quality</option>
                                    <option value="high">High Quality</option>
                                    <option value="medium">Medium Quality</option>
                                    <option value="compressed">Compressed</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">File Retention</label>
                                <select id="fileRetention" class="form-select">
                                    <option value="forever">Keep Forever</option>
                                    <option value="5years">5 Years</option>
                                    <option value="3years">3 Years</option>
                                    <option value="1year">1 Year</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="autoSync" class="form-checkbox" checked>
                                <span class="ml-3">Enable automatic file synchronization</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="duplicateDetection" class="form-checkbox" checked>
                                <span class="ml-3">Detect and prevent duplicate files</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="versionControl" class="form-checkbox">
                                <span class="ml-3">Enable file version control</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="encryptFiles" class="form-checkbox" checked>
                                <span class="ml-3">Encrypt files during storage and transfer</span>
                            </label>
                        </div>
                        
                        <button onclick="StorageIntegrations.saveSettings()" class="btn-primary">
                            Save Settings
                        </button>
                    </div>
                </div>
                
                <!-- Storage Usage -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">Storage Usage</h4>
                    <div id="storageUsage">
                        <!-- Storage usage will be loaded here -->
                    </div>
                </div>
            </div>
        `;
    },
    
    renderCloudStorage() {
        const cloudServices = [
            {
                name: 'Google Drive',
                status: 'connected',
                description: 'Google cloud storage',
                icon: 'cloud',
                color: 'blue',
                usage: { used: '15.2 GB', total: '100 GB', percentage: 15 }
            },
            {
                name: 'Dropbox',
                status: 'available',
                description: 'File sync and sharing',
                icon: 'cloud',
                color: 'blue',
                usage: null
            },
            {
                name: 'OneDrive',
                status: 'available',
                description: 'Microsoft cloud storage',
                icon: 'cloud',
                color: 'blue',
                usage: null
            },
            {
                name: 'Amazon S3',
                status: 'available',
                description: 'Scalable cloud storage',
                icon: 'server',
                color: 'orange',
                usage: null
            }
        ];
        
        return cloudServices.map(service => this.renderStorageCard(service, 'cloud')).join('');
    },
    
    renderDocumentSystems() {
        const docServices = [
            {
                name: 'SharePoint',
                status: 'available',
                description: 'Microsoft document management',
                icon: 'file-text',
                color: 'blue',
                usage: null
            },
            {
                name: 'Box',
                status: 'available',
                description: 'Enterprise content management',
                icon: 'archive',
                color: 'blue',
                usage: null
            },
            {
                name: 'DocuSign',
                status: 'available',
                description: 'Digital signature platform',
                icon: 'edit-3',
                color: 'yellow',
                usage: null
            },
            {
                name: 'Adobe Document Cloud',
                status: 'available',
                description: 'PDF and document services',
                icon: 'file',
                color: 'red',
                usage: null
            }
        ];
        
        return docServices.map(service => this.renderStorageCard(service, 'document')).join('');
    },
    
    renderMediaStorage() {
        const mediaServices = [
            {
                name: 'Google Photos',
                status: 'available',
                description: 'Photo storage and organization',
                icon: 'image',
                color: 'green',
                usage: null
            },
            {
                name: 'Flickr',
                status: 'available',
                description: 'Photo sharing platform',
                icon: 'camera',
                color: 'pink',
                usage: null
            },
            {
                name: 'Cloudinary',
                status: 'available',
                description: 'Image and video management',
                icon: 'image',
                color: 'blue',
                usage: null
            },
            {
                name: 'Vimeo',
                status: 'available',
                description: 'Video hosting platform',
                icon: 'video',
                color: 'blue',
                usage: null
            }
        ];
        
        return mediaServices.map(service => this.renderStorageCard(service, 'media')).join('');
    },
    
    renderStorageCard(service, type) {
        const isConnected = service.status === 'connected';
        return `
            <div class="border rounded-lg p-4 ${isConnected ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-${service.color}-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="${service.icon}" class="w-5 h-5 text-${service.color}-600"></i>
                        </div>
                        <div>
                            <h5 class="font-medium">${service.name}</h5>
                            <p class="text-sm text-gray-600">${service.description}</p>
                        </div>
                    </div>
                    <span class="w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-gray-400'}"></span>
                </div>
                
                ${service.usage ? `
                    <div class="mb-3">
                        <div class="flex items-center justify-between text-sm mb-1">
                            <span>Storage Used</span>
                            <span>${service.usage.used} / ${service.usage.total}</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${service.usage.percentage}%"></div>
                        </div>
                    </div>
                ` : ''}
                
                <div class="flex space-x-2">
                    ${isConnected ? `
                        <button onclick="StorageIntegrations.manageFiles('${service.name}')" 
                                class="btn-secondary text-sm flex-1">
                            Manage Files
                        </button>
                        <button onclick="StorageIntegrations.configure('${service.name}', '${type}')" 
                                class="btn-secondary text-sm">
                            Settings
                        </button>
                    ` : `
                        <button onclick="StorageIntegrations.connect('${service.name}', '${type}')" 
                                class="btn-primary text-sm flex-1">
                            Connect
                        </button>
                        <button onclick="StorageIntegrations.learnMore('${service.name}', '${type}')" 
                                class="btn-secondary text-sm">
                            Info
                        </button>
                    `}
                </div>
            </div>
        `;
    },
    
    load() {
        // Load storage settings
        document.getElementById('defaultStorage').value = Settings.getSetting('defaultStorage', 'google_drive');
        document.getElementById('backupFrequency').value = Settings.getSetting('backupFrequency', 'daily');
        document.getElementById('photoQuality').value = Settings.getSetting('photoQuality', 'high');
        document.getElementById('fileRetention').value = Settings.getSetting('fileRetention', 'forever');
        document.getElementById('autoSync').checke
// Media services component for T&J Field Services
const MediaServices = {
    load() {
        const mediaServices = [
            {
                name: 'Google Photos',
                status: 'available',
                description: 'Photo storage and organization',
                icon: 'image',
                color: 'green'
            },
            {
                name: 'Flickr',
                status: 'available',
                description: 'Photo sharing platform',
                icon: 'camera',
                color: 'pink'
            },
            {
                name: 'Cloudinary',
                status: 'available',
                description: 'Image and video management',
                icon: 'image',
                color: 'blue'
            },
            {
                name: 'Vimeo',
                status: 'available',
                description: 'Video hosting platform',
                icon: 'video',
                color: 'blue'
            }
        ];
        
        document.getElementById('mediaServices').innerHTML = 
            mediaServices.map(service => this.renderMediaCard(service)).join('');
        
        lucide.createIcons();
    },
    
    renderMediaCard(service) {
        const isConnected = service.status === 'connected';
        return `
            <div class="border rounded-lg p-4 ${isConnected ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-${service.color}-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="${service.icon}" class="w-5 h-5 text-${service.color}-600"></i>
                        </div>
                        <div>
                            <h5 class="font-medium">${service.name}</h5>
                            <p class="text-sm text-gray-600">${service.description}</p>
                        </div>
                    </div>
                    <span class="w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-gray-400'}"></span>
                </div>
                
                <div class="flex space-x-2">
                    ${isConnected ? `
                        <button onclick="MediaServices.manageMedia('${service.name}')" 
                                class="btn-secondary text-sm flex-1">
                            Manage Media
                        </button>
                        <button onclick="MediaServices.configure('${service.name}')" 
                                class="btn-secondary text-sm">
                            Settings
                        </button>
                    ` : `
                        <button onclick="MediaServices.connect('${service.name}')" 
                                class="btn-primary text-sm flex-1">
                            Connect
                        </button>
                        <button onclick="MediaServices.learnMore('${service.name}')" 
                                class="btn-secondary text-sm">
                            Info
                        </button>
                    `}
                </div>
            </div>
        `;
    },
    
    connect(serviceName) {
        UI.showAlert(`Connecting to ${serviceName}...`, 'info');
        setTimeout(() => {
            UI.showAlert(`${serviceName} connected successfully!`, 'success');
            this.load();
        }, 2000);
    },
    
    configure(serviceName) {
        const configModal = `
            <div class="space-y-4">
                <h4 class="text-lg font-medium">${serviceName} Configuration</h4>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Upload Quality</label>
                        <select class="form-select">
                            <option value="original">Original Quality</option>
                            <option value="high">High Quality</option>
                            <option value="medium">Medium Quality</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Auto-Upload</label>
                        <div class="space-y-2">
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">Before photos</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox" checked>
                                <span class="ml-2 text-sm">After photos</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" class="form-checkbox">
                                <span class="ml-2 text-sm">Progress videos</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-2 pt-4">
                    <button onclick="UI.closeModal()" class="btn-secondary">Cancel</button>
                    <button onclick="MediaServices.saveConfig('${serviceName}')" class="btn-primary">
                        Save Configuration
                    </button>
                </div>
            </div>
        `;
        
        UI.showModal(`${serviceName} Settings`, configModal);
    },
    
    manageMedia(serviceName) {
        UI.showAlert(`Opening ${serviceName} media manager...`, 'info');
    },
    
    learnMore(serviceName) {
        UI.showAlert(`Opening ${serviceName} information...`, 'info');
    },
    
    saveConfig(serviceName) {
        UI.closeModal();
        UI.showAlert(`${serviceName} configuration saved!`, 'success');
    }
};// Storage usage component for T&J Field Services
const StorageUsage = {
    render() {
        return `
            <div class="bg-white border rounded-lg p-6">
                <h4 class="text-lg font-medium mb-4">Storage Usage</h4>
                <div id="storageUsageContent">
                    <!-- Storage usage content will be loaded here -->
                </div>
            </div>
        `;
    },
    
    load() {
        this.renderUsage();
    },
    
    renderUsage() {
        const usageData = {
            total: '100 GB',
            used: '42.3 GB',
            available: '57.7 GB',
            percentage: 42,
            breakdown: [
                { type: 'Photos', size: '28.5 GB', percentage: 67, color: 'blue' },
                { type: 'Documents', size: '8.2 GB', percentage: 19, color: 'green' },
                { type: 'Videos', size: '4.1 GB', percentage: 10, color: 'purple' },
                { type: 'Other', size: '1.5 GB', percentage: 4, color: 'gray' }
            ],
            services: [
                { name: 'Google Drive', used: '15.2 GB', total: '100 GB', percentage: 15 },
                { name: 'Local Storage', used: '27.1 GB', total: '500 GB', percentage: 5 }
            ]
        };
        
        document.getElementById('storageUsageContent').innerHTML = `
            <!-- Overall Usage -->
            <div class="mb-6">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-sm font-medium">Total Storage Used</span>
                    <span class="text-sm text-gray-600">${usageData.used} / ${usageData.total}</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-3 mb-2">
                    <div class="bg-blue-600 h-3 rounded-full transition-all duration-300" 
                         style="width: ${usageData.percentage}%"></div>
                </div>
                <div class="flex justify-between text-xs text-gray-500">
                    <span>Used: ${usageData.used}</span>
                    <span>Available: ${usageData.available}</span>
                </div>
            </div>
            
            <!-- Usage Breakdown -->
            <div class="mb-6">
                <h5 class="font-medium mb-3">Storage Breakdown</h5>
                <div class="space-y-3">
                    ${usageData.breakdown.map(item => `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-${item.color}-500 rounded-full mr-3"></div>
                                <span class="text-sm">${item.type}</span>
                            </div>
                            <div class="flex items-center space-x-3">
                                <span class="text-sm text-gray-600">${item.size}</span>
                                <div class="w-16 bg-gray-200 rounded-full h-2">
                                    <div class="bg-${item.color}-500 h-2 rounded-full" 
                                         style="width: ${item.percentage}%"></div>
                                </div>
                                <span class="text-xs text-gray-500 w-8">${item.percentage}%</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Service Usage -->
            <div class="mb-6">
                <h5 class="font-medium mb-3">Usage by Service</h5>
                <div class="space-y-3">
                    ${usageData.services.map(service => `
                        <div class="border rounded-lg p-3">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-medium text-sm">${service.name}</span>
                                <span class="text-sm text-gray-600">${service.used} / ${service.total}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" 
                                     style="width: ${service.percentage}%"></div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <!-- Storage Actions -->
            <div class="flex flex-wrap gap-2">
                <button onclick="StorageUsage.optimizeStorage()" class="btn-secondary text-sm">
                    <i data-lucide="zap" class="inline w-4 h-4 mr-2"></i>
                    Optimize Storage
                </button>
                <button onclick="StorageUsage.cleanupFiles()" class="btn-secondary text-sm">
                    <i data-lucide="trash-2" class="inline w-4 h-4 mr-2"></i>
                    Cleanup Files
                </button>
                <button onclick="StorageUsage.exportUsage()" class="btn-secondary text-sm">
                    <i data-lucide="download" class="inline w-4 h-4 mr-2"></i>
                    Export Report
                </button>
                <button onclick="StorageUsage.upgradeStorage()" class="btn-primary text-sm">
                    <i data-lucide="arrow-up" class="inline w-4 h-4 mr-2"></i>
                    Upgrade Storage
                </button>
            </div>
        `;
        
        lucide.createIcons();
    },
    
    optimizeStorage() {
        UI.showAlert('Optimizing storage usage...', 'info');
        setTimeout(() => {
            UI.showAlert('Storage optimization completed! Freed up 2.1 GB', 'success');
            this.refresh();
        }, 3000);
    },
    
    cleanupFiles() {
        const cleanupModal = `
            <div class="space-y-4">
                <h4 class="text-lg font-medium">Cleanup Files</h4>
                <div class="space-y-3">
                    <p class="text-sm text-gray-600">Select file types to clean up:</p>
                    <div class="space-y-2">
                        <label class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input type="checkbox" class="form-checkbox">
                                <span class="ml-3 text-sm">Duplicate files</span>
                            </div>
                            <span class="text-sm text-gray-500">~1.2 GB</span>
                        </label>
                        <label class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input type="checkbox" class="form-checkbox">
                                <span class="ml-3 text-sm">Old temporary files</span>
                            </div>
                            <span class="text-sm text-gray-500">~0.8 GB</span>
                        </label>
                        <label class="flex items-center justify-between">
                            <div class="flex items-center">
                                <input type="checkbox" class="form-checkbox">
                                <span class="ml-3 text-sm">Cached thumbnails</span>
                            </div>
                            <span class="text-sm text-gray-500">~0.3 GB</span>
                        </label>
                    </div>
                </div>
                <div class="flex space-x-2 pt-4">
                    <button onclick="UI.closeModal()" class="btn-secondary">Cancel</button>
                    <button onclick="StorageUsage.performCleanup()" class="btn-primary">
                        Start Cleanup
                    </button>
                </div>
            </div>
        `;
        
        UI.showModal('Cleanup Files', cleanupModal);
    },
    
    performCleanup() {
        UI.closeModal();
        UI.showAlert('Cleaning up selected files...', 'info');
        setTimeout(() => {
            UI.showAlert('Cleanup completed! Freed up 2.3 GB', 'success');
            this.refresh();
        }, 4000);
    },
    
    exportUsage() {
        UI.showAlert('Exporting storage usage report...', 'info');
        setTimeout(() => {
            UI.showAlert('Storage usage report exported successfully!', 'success');
        }, 1500);
    },
    
    upgradeStorage() {
        const upgradeModal = `
            <div class="space-y-4">
                <h4 class="text-lg font-medium">Upgrade Storage</h4>
                <div class="space-y-3">
                    <div class="grid grid-cols-1 gap-3">
                        <div class="border rounded-lg p-3 cursor-pointer hover:border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="font-medium">200 GB Plan</h5>
                                    <p class="text-sm text-gray-600">Double your current storage</p>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium">$9.99/month</div>
                                    <div class="text-sm text-gray-500">+$5/month</div>
                                </div>
                            </div>
                        </div>
                        <div class="border rounded-lg p-3 cursor-pointer hover:border-blue-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="font-medium">500 GB Plan</h5>
                                    <p class="text-sm text-gray-600">5x your current storage</p>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium">$19.99/month</div>
                                    <div class="text-sm text-gray-500">+$15/month</div>
                                </div>
                            </div>
                        </div>
                        <div class="border rounded-lg p-3 cursor-pointer hover:border-blue-500 border-blue-200 bg-blue-50">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h5 class="font-medium text-blue-900">1 TB Plan</h5>
                                    <p class="text-sm text-blue-700">Unlimited for most businesses</p>
                                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">Recommended</span>
                                </div>
                                <div class="text-right">
                                    <div class="font-medium text-blue-900">$29.99/month</div>
                                    <div class="text-sm text-blue-600">+$25/month</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="flex space-x-2 pt-4">
                    <button onclick="UI.closeModal()" class="btn-secondary">Cancel</button>
                    <button onclick="StorageUsage.selectPlan()" class="btn-primary">
                        Upgrade Now
                    </button>
                </div>
            </div>
        `;
        
        UI.showModal('Upgrade Storage', upgradeModal);
    },
    
    selectPlan() {
        UI.closeModal();
        UI.showAlert('Redirecting to upgrade page...', 'info');
    },
    
    refresh() {
        this.renderUsage();
    }
};id: tj-tools-integrations
name: T&J Tools Integrations
type: code.js
content: |-
// Tools integrations component for T&J Field Services
const ToolsIntegrations = {
    render() {
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium">Tools Integrations</h3>
                    <button onclick="ToolsIntegrations.testAllConnections()" class="btn-primary">
                        <i data-lucide="zap" class="inline w-4 h-4 mr-2"></i>
                        Test All
                    </button>
                </div>
                
                <!-- Project Management Tools -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="clipboard" class="inline w-5 h-5 mr-2"></i>
                        Project Management
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderProjectTools()}
                    </div>
                </div>
                
                <!-- Design & CAD Tools -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="pen-tool" class="inline w-5 h-5 mr-2"></i>
                        Design & CAD Tools
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderDesignTools()}
                    </div>
                </div>
                
                <!-- Measurement & Estimation -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="ruler" class="inline w-5 h-5 mr-2"></i>
                        Measurement & Estimation
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderMeasurementTools()}
                    </div>
                </div>
                
                <!-- Productivity Tools -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="briefcase" class="inline w-5 h-5 mr-2"></i>
                        Productivity Tools
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${this.renderProductivityTools()}
                    </div>
                </div>
                
                <!-- Tools Settings -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">Tools Integration Settings</h4>
                    <div class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Data Sync Frequency</label>
                                <select id="toolsSyncFreq" class="form-select">
                                    <option value="realtime">Real-time</option>
                                    <option value="hourly">Every hour</option>
                                    <option value="daily">Daily</option>
                                    <option value="manual">Manual only</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Default Export Format</label>
                                <select id="exportFormat" class="form-select">
                                    <option value="pdf">PDF</option>
                                    <option value="dwg">DWG</option>
                                    <option value="csv">CSV</option>
                                    <option value="json">JSON</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <label class="flex items-center">
                                <input type="checkbox" id="autoImportProjects" class="form-checkbox" checked>
                                <span class="ml-3">Automatically import projects from connected tools</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="syncMeasurements" class="form-checkbox" checked>
                                <span class="ml-3">Sync measurements and estimates automatically</span>
                            </label>
                            <label class="flex items-center">
                                <input type="checkbox" id="shareDesigns" class="form-checkbox">
                                <span class="ml-3">Share design files with customers automatically</span>
                            </label>
                        </div>
                        
                        <button onclick="ToolsIntegrations.saveSettings()" class="btn-primary">
                            Save Settings
                        </button>
                    </div>
                </div>
            </div>
        `;
    },
    
    renderProjectTools() {
        const projectTools = [
            {
                name: 'Trello',
                status: 'available',
                description: 'Visual project management',
                icon: 'trello',
                color: 'blue',
                features: ['Kanban boards', 'Task tracking', 'Team collaboration']
            },
            {
                name: 'Asana',
                status: 'available',
                description: 'Team project management',
                icon: 'check-circle',
                color: 'pink',
                features: ['Project timelines', 'Task dependencies', 'Progress tracking']
            },
            {
                name: 'Monday.com',
                status: 'available',
                description: 'Work operating system',
                icon: 'calendar',
                color: 'orange',
                features: ['Custom workflows', 'Automation', 'Time tracking']
            },
            {
                name: 'Basecamp',
                status: 'available',
                description: 'Project organization',
                icon: 'mountain',
                color: 'green',
                features: ['Message boards', 'To-do lists', 'File sharing']
            }
        ];
        
        return projectTools.map(tool => this.renderToolCard(tool, 'project')).join('');
    },
    
    renderDesignTools() {
        const designTools = [
            {
                name: 'AutoCAD',
                status: 'available',
                description: 'Professional CAD software',
                icon: 'pen-tool',
                color: 'red',
                features: ['2D/3D design', 'Technical drawings', 'Precision tools']
            },
            {
                name: 'SketchUp',
                status: 'available',
                description: '3D modeling software',
                icon: 'box',
                color: 'blue',
                features: ['3D modeling', 'Deck design', 'Material visualization']
            },
            {
                name: 'Deck Designer',
                status: 'connected',
                description: 'Specialized deck design tool',
                icon: 'home',
                color: 'brown',
                features: ['Deck layouts', 'Material lists', 'Cost estimates']
            },
            {
                name: 'Chief Architect',
                status: 'available',
                description: 'Home design software',
                icon: 'layout',
                color: 'purple',
                features: ['Home design', '3D rendering', 'Construction docs']
            }
        ];
        
        return designTools.map(tool => this.renderToolCard(tool, 'design')).join('');
    },
    
    renderMeasurementTools() {
        const measurementTools = [
            {
                name: 'MagicPlan',
                status: 'available',
                description: 'Floor plan measurement',
                icon: 'ruler',
                color: 'blue',
                features: ['AR measurement', 'Floor plans', 'Area calculation']
            },
            {
                name: 'RoofSnap',
                status: 'available',
                description: 'Aerial measurement',
                icon: 'map',
                color: 'green',
                features: ['Satellite imagery', 'Roof measurement', 'Reports']
            },
            {
                name: 'PlanSwift',
                status: 'available',
                description: 'Digital takeoff software',
                icon: 'calculator',
                color: 'orange',
                features: ['Digital takeoffs', 'Cost estimation', 'Bid preparation']
            },
            {
                name: 'Measure Square',
                status: 'available',
                description: 'Flooring measurement',
                icon: 'square',
                color: 'purple',
                features: ['Floor measurement', 'Material calculation', 'Waste factors']
            }
        ];
        
        return measurementTools.map(tool => this.renderToolCard(tool, 'measurement')).join('');
    },
    
    renderProductivityTools() {
        const productivityTools = [
            {
                name: 'Zapier',
                status: 'available',
                description: 'Workflow automation',
                icon: 'zap',
                color: 'orange',
                features: ['App connections', 'Automation', 'Workflow triggers']
            },
            {
                name: 'IFTTT',
                status: 'available',
                description: 'Simple automation',
                icon: 'link',
                color: 'blue',
                features: ['Simple triggers', 'Device integration', 'Notifications']
            },
            {
                name: 'Microsoft Power Automate',
                status: 'available',
                description: 'Business process automation',
                icon: 'workflow',
                color: 'blue',
                features: ['Business workflows', 'Data integration', 'Approvals']
            },
            {
                name: 'Integromat',
                status: 'available',
                description: 'Advanced automation',
                icon: 'settings',
                color: 'purple',
                features: ['Complex scenarios', 'Data transformation', 'Error handling']
            }
        ];
        
        return productivityTools.map(tool => this.renderToolCard(tool, 'productivity')).join('');
    },
    
    renderToolCard(tool, category) {
        const isConnected = tool.status === 'connected';
        return `
            <div class="border rounded-lg p-4 ${isConnected ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-${tool.color}-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="${tool.icon}" class="w-5 h-5 text-${tool.color}-600"></i>
                        </div>
                        <div>
                            <h5 class="font-medium">${tool.name}</h5>
                            <p class="text-sm text-gray-600">${tool.description}</p>
                        </div>
                    </div>
                    <span class="w-2 h-2 rounded-full ${isConnected ? 'bg-green
// Measurement tools component for T&J Field Services
const MeasurementTools = {
    load() {
        const measurementTools = [
            {
                name: 'MagicPlan',
                status: 'available',
                description: 'Floor plan measurement',
                icon: 'ruler',
                color: 'blue',
                features: ['AR measurement', 'Floor plans', 'Area calculation']
            },
            {
                name: 'RoofSnap',
                status: 'available',
                description: 'Aerial measurement',
                icon: 'map',
                color: 'green',
                features: ['Satellite imagery', 'Roof measurement', 'Reports']
            },
            {
                name: 'PlanSwift',
                status: 'available',
                description: 'Digital takeoff software',
                icon: 'calculator',
                color: 'orange',
                features: ['Digital takeoffs', 'Cost estimation', 'Bid preparation']
            },
            {
                name: 'Measure Square',
                status: 'available',
                description: 'Flooring measurement',
                icon: 'square',
                color: 'purple',
                features: ['Floor measurement', 'Material calculation', 'Waste factors']
            }
        ];
        
        document.getElementById('measurementTools').innerHTML = 
            measurementTools.map(tool => this.renderToolCard(tool)).join('');
        
        lucide.createIcons();
    },
    
    renderToolCard(tool) {
        const isConnected = tool.status === 'connected';
        return `
            <div class="border rounded-lg p-4 ${isConnected ? 'border-green-200 bg-green-50' : 'border-gray-200'}">
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-${tool.color}-100 rounded-lg flex items-center justify-center mr-3">
                            <i data-lucide="${tool.icon}" class="w-5 h-5 text-${tool.color}-600"></i>
                        </div>
                        <div>
                            <h5 class="font-medium">${tool.name}</h5>
                            <p class="text-sm text-gray-600">${tool.description}</p>
                        </div>
                    </div>
                    <span class="w-2 h-2 rounded-full ${isConnected ? 'bg-green-500' : 'bg-gray-400'}"></span>
                </div>
                
                <div class="mb-3">
                    <div class="flex flex-wrap gap-1">
                        ${tool.features.map(feature => `
                            <span class="text-xs px-2 py-1 bg-gray-100 text-gray-600 rounded-full">${feature}</span>
                        `).join('')}
                    </div>
                </div>
                
                <div class="flex space-x-2">
                    ${isConnected ? `
                        <button onclick="MeasurementTools.startMeasurement('${tool.name}')" 
                                class="btn-secondary text-sm flex-1">
                            Start Measuring
                        </button>
                        <button onclick="MeasurementTools.configure('${tool.name}')" 
                                class="btn-secondary text-sm">
                            Settings
                        </button>
                    ` : `
                        <button onclick="MeasurementTools.connect('${tool.name}')" 
                                class="btn-primary text-sm flex-1">
                            Connect
                        </button>
                        <button onclick="MeasurementTools.learnMore('${tool.name}')" 
                                class="btn-secondary text-sm">
                            Info
                        </button>
                    `}
                </div>
            </div>
        `;
    },
    
    connect(toolName) {
        UI.showAlert(`Connecting to ${toolName}...`, 'info');
        setTimeout(() => {
            UI.showAlert(`${toolName} connected successfully!`, 'success');
            this.load();
        }, 2000);
    },
    
    configure(toolName) {
        UI.showAlert(`Opening ${toolName} configuration...`, 'info');
    },
    
    startMeasurement(toolName) {
        UI.showAlert(`Starting measurement with ${toolName}...`, 'info');
    },
    
    learnMore(toolName) {
        UI.showAlert(`Opening ${toolName} information...`, 'info');
    }
};// API integrations main component for T&J Field Services
const APIIntegrations = {
    render() {
        return `
            <div class="space-y-6">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-medium">API Integrations</h3>
                    <button onclick="APIIntegrations.testAllAPIs()" class="btn-primary">
                        <i data-lucide="zap" class="inline w-4 h-4 mr-2"></i>
                        Test All APIs
                    </button>
                </div>
                
                <!-- REST APIs -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="globe" class="inline w-5 h-5 mr-2"></i>
                        REST APIs
                    </h4>
                    <div class="grid grid-cols-1 gap-4" id="restAPIs">
                        <!-- REST APIs will be loaded here -->
                    </div>
                </div>
                
                <!-- Webhooks -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="webhook" class="inline w-5 h-5 mr-2"></i>
                        Webhooks
                    </h4>
                    <div class="space-y-4" id="webhooks">
                        <!-- Webhooks will be loaded here -->
                    </div>
                </div>
                
                <!-- Custom APIs -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="code" class="inline w-5 h-5 mr-2"></i>
                        Custom APIs
                    </h4>
                    <div class="space-y-4" id="customAPIs">
                        <!-- Custom APIs will be loaded here -->
                    </div>
                </div>
                
                <!-- API Settings -->
                ${APISettings.render()}
                
                <!-- API Documentation -->
                <div class="bg-white border rounded-lg p-6">
                    <h4 class="text-lg font-medium mb-4">
                        <i data-lucide="book-open" class="inline w-5 h-5 mr-2"></i>
                        API Documentation
                    </h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="border rounded-lg p-4">
                            <h5 class="font-medium mb-2">T&J Field Services API</h5>
                            <p class="text-sm text-gray-600 mb-3">Complete API documentation for integrating with our system</p>
                            <div class="flex space-x-2">
                                <button onclick="APIIntegrations.viewDocs('internal')" class="btn-secondary text-sm">
                                    View Docs
                                </button>
                                <button onclick="APIIntegrations.downloadSDK()" class="btn-secondary text-sm">
                                    Download SDK
                                </button>
                            </div>
                        </div>
                        <div class="border rounded-lg p-4">
                            <h5 class="font-medium mb-2">Integration Examples</h5>
                            <p class="text-sm text-gray-600 mb-3">Code examples and tutorials for common integrations</p>
                            <div class="flex space-x-2">
                                <button onclick="APIIntegrations.viewExamples()" class="btn-secondary text-sm">
                                    View Examples
                                </button>
                                <button onclick="APIIntegrations.openPlayground()" class="btn-secondary text-sm">
                                    API Playground
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    },
    
    load() {
        RestAPIs.load();
        WebhookManager.load();
        CustomAPIs.load();
        APISettings.load();
        lucide.createIcons();
    },
    
    testAllAPIs() {
        UI.showAlert('Testing all API connections...', 'info');
        setTimeout(() => {
            UI.showAlert('All API connections tested successfully!', 'success');
        }, 3000);
    },
    
    viewDocs(type) {
        UI.showAlert('Opening API documentation...', 'info');
    },
    
    downloadSDK() {
        UI.showAlert('Downloading SDK package...', 'info');
        setTimeout(() => {
            UI.showAlert('SDK downloaded successfully!', 'success');
        }, 2000);
    },
    
    viewExamples() {
        UI.showAlert('Opening integration examples...', 'info');
    },
    
    openPlayground() {
        UI.showAlert('Opening API playground...', 'info');
    }
};// Custom APIs component for T&J Field Services
const CustomAPIs = {
    load() {
        const customAPIs = [
            {
                name: 'Material Supplier API',
                endpoint: 'https://api.supplier.com/v1',
                type: 'External',
                status: 'connected',
                description: 'Integration with material supplier for pricing and availability',
                lastSync: '15 minutes ago',
                dataPoints: '2,341'
            },
            {
                name: 'Weather Service API',
                endpoint: 'https://api.weather.com/v1',
                type: 'External',
                status: 'connected',
                description: 'Weather data for project scheduling',
                lastSync: '1 hour ago',
                dataPoints: '156'
            },
            {
                name: 'Custom CRM Integration',
                endpoint: 'https://custom.crm.com/api',
                type: 'Custom',
                status: 'development',
                description: 'Custom integration with legacy CRM system',
                lastSync: 'Never',
                dataPoints: '0'
            }
        ];
        
        document.getElementById('customAPIs').innerHTML = `
            <div class="flex justify-between items-center mb-4">
                <span class="text-sm text-gray-600">${customAPIs.length} custom integrations</span>
                <button onclick="CustomAPIs.createCustomAPI()" class="btn-primary text-sm">
                    <i data-lucide="plus" class="inline w-4 h-4 mr-2"></i>
                    Add Custom API
                </button>
            </div>
            ${customAPIs.map(api => this.renderCustomAPICard(api)).join('')}
        `;
        
        lucide.createIcons();
    },
    
    renderCustomAPICard(api) {
        const statusColors = {
            'connected': 'green',
            'development': 'yellow',
            'error': 'red',
            'paused': 'gray'
        };
        
        const statusColor = statusColors[api.status] || 'gray';
        
        return `
            <div class="border rounded-lg p-4 mb-3">
                <div class="flex items-center justify-between mb-3">
                    <div>
                        <div class="flex items-center mb-1">
                            <h5 class="font-medium mr-2">${api.name}</h5>
                            <span class="text-xs px-2 py-1 bg-${statusColor === 'yellow' ? 'orange' : 'blue'}-100 text-${statusColor === 'yellow' ? 'orange' : 'blue'}-800 rounded">${api.type}</span>
                        </div>
                        <p class="text-sm text-gray-600">${api.description}</p>
                        <code class="text-xs bg-gray-100 px-2 py-1 rounded mt-1 inline-block">${api.endpoint}</code>
                    </div>
                    <div class="text-right">
                        <span class="w-2 h-2 rounded-full bg-${statusColor}-500 inline-block mr-2"></span>
                        <span class="text-xs text-${statusColor}-600">${api.status}</span>
                    </div>
                </div>
                
                <div class="flex items-center justify-between mb-3 text-xs text-gray-500">
                    <span>Last sync: ${api.lastSync}</span>
                    <span>Data points: ${api.dataPoints}</span>
                </div>
                
                <div class="flex space-x-2">
                    <button onclick="CustomAPIs.testConnection('${api.name}')" class="btn-secondary text-sm">
                        Test Connection
                    </button>
                    <button onclick="CustomAPIs.configure('${api.name}')" class="btn-secondary text-sm">
                        Configure
                    </button>
                    <button onclick="CustomAPIs.syncNow('${api.name}')" class="btn-secondary text-sm">
                        Sync Now
                    </button>
                    <button onclick="CustomAPIs.viewData('${api.name}')" class="btn-secondary text-sm">
                        View Data
                    </button>
                </div>
            </div>
        `;
    },
    
    createCustomAPI() {
        const createModal = `
            <div class="space-y-4">
                <h4 class="text-lg font-medium">Create Custom API Integration</h4>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Integration Name</label>
                        <input type="text" id="customAPIName" class="form-input" placeholder="Enter integration name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">API Endpoint</label>
                        <input type="url" id="customAPIEndpoint" class="form-input" placeholder="https://api.example.com/v1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Authentication Type</label>
                        <select id="authType" class="form-select">
                            <option value="none">No Authentication</option>
                            <option value="api_key">API Key</option>
                            <option value="bearer">Bearer Token</option>
                            <option value="oauth">OAuth 2.0</option>
                            <option value="basic">Basic Auth</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                        <textarea id="customAPIDescription" class="form-textarea" rows="3" placeholder="Describe what this integration does"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Data Sync Frequency</label>
                        <select id="syncFrequency" class="form-select">
                            <option value="realtime">Real-time</option>
                            <option value="hourly">Every hour</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="manual">Manual only</option>
                        </select>
                    </div>
                </div>
                <div class="flex space-x-2 pt-4">
                    <button onclick="UI.closeModal()" class="btn-secondary">Cancel</button>
                    <button onclick="CustomAPIs.saveCustomAPI()" class="btn-primary">
                        Create Integration
                    </button>
                </div>
            </div>
        `;
        
        UI.showModal('Create Custom API', createModal);
    },
    
    testConnection(apiName) {
        UI.showAlert(`Testing connection to ${apiName}...`, 'info');
        setTimeout(() => {
            const success = Math.random() > 0.3; // 70% success rate
            if (success) {
                UI.showAlert(`${apiName} connection successful!`, 'success');
            } else {
                UI.showAlert(`${apiName} connection failed! Check configuration.`, 'error');
            }
        }, 2000);
    },
    
    configure(apiName) {
        UI.showAlert(`Opening ${apiName} configuration...`, 'info');
    },
    
    syncNow(apiName) {
        UI.showAlert(`Starting sync with ${apiName}...`, 'info');
        setTimeout(() => {
            UI.showAlert(`${apiName} sync completed!`, 'success');
            this.load();
        }, 3000);
    },
    
    viewData(apiName) {
        UI.showAlert(`Opening ${apiName} data viewer...`, 'info');
    },
    
    saveCustomAPI() {
        UI.closeModal();
        UI.showAlert('Custom API integration created successfully!', 'success');
        this.load();
    }
};
};